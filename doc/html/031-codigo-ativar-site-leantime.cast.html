]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ nano tasks/tasks.yml 
[?2004h[?1049h[?7h[?1h=[?1h=[?25l<span style="background-color: #AAAAAA; color: #000000">[ A ler... ]</span><span style="background-color: #AAAAAA; color: #000000">[ 157 linhas lidas ]</span><span style="background-color: #AAAAAA; color: #000000">  GNU nano 4.8                                                tasks/tasks.yml                                                             </span>
<span style="background-color: #AAAAAA; color: #000000">^G</span> Ajuda<span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar<span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor    <span style="background-color: #AAAAAA; color: #000000">M-U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt
<span style="background-color: #AAAAAA; color: #000000">^X</span> Sair<span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer<span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
---- name: Atualiza a cache (equivalente a apt update)apt:update_cache: truecache_valid_time: 3600- name: "Atualiza o sistema operativo"apt:upgrade: safe- name: "Instalar as dependencias necess√°ria ao programa leantime"apt:pkg:- mc- screen- git- apache2- mysql-server- php- php-mysql- php-ldap- php-cli- php-soap- php-json- graphviz- php-xml- php-gd- php-zip- libapache2-mod-php- php-dev- libmcrypt-dev- gcc- make- autoconf- libc-dev
[?12l[?25h[?25l - autoconf    - libc-dev  - pkg-config- pwgen- curl- unzip    - zip  - php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurl
<span style="color: #00aaaa">   # Fonte de inspira√ß√£o: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.html</span>- name: "Instala o servi√ßo apache2 no arranque do sistema"service:name: apache2state: startedenabled: true
<span style="color: #00aaaa">   # Fonte: https://www.mydailytutorials.com/using-ansible-find-module-search-filesfolder</span>- name: "Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurse: trueregister: caminho_php_ini
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.html</span>- name: "Ativa v√°rias op√ß√µes no ficheiro php.ini, utilizando o m√≥dulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"
[?12l[?25h[?25lregexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:regexp: "^file_uploads"  line: "file_uploads = 1"regexp: "^upload_max_filesize"  line: "upload_max_filesize = 1G"regexp: "^max_file_uploads"  line: "max_file_uploads = 20"regexp: "^post_max_size"  line: "post_max_size = 2G"regexp: "^memory_limit"  line: "memory_limit = 2G"- regexp: "^max_input_time" line: "max_input_time = 3600"
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/2.7/modules/file_module.html</span>- name: Cria a directoria tempor√°ria leantime e a directoria de apache leantimefile:path: "{{ item.path }}"state: directory mode: 0755    owner: www-data  group: www-datawith_items:- path: "/tmp/leantime"- path: "/var/www/leantime"
<span style="color: #00aaaa">   # Fonte: Ansible for DevOps - Server and configuration management for humans de Jeff Geerling, p√°gina 98
</span>   - name: "Cria a base de dados de mysql para o leantime"  mysql_db: "db=leantime_database state=present"
- name: "Cria o utilizador para a base de dados leantime"mysql_user:namlogin_leantime }}"
[?12l[?25h[?25lmysql_user:namlogin_leantime }}"  password: "{{ password_leantime }}"priv: "leantime_database.*:ALL"host: localhoststate: present
- name: "Faz o download do software leantime a partir do reposit√≥rio git"get_url:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipdest: /tmp/leantimemode: 0755
<span style="color: #00aaaa">   # O ficheiro Leantime-versao.zip necessita de ser descomprimido</span>- name: Descomprime o software leantimeunarchive: src: "/tmp/leantime/Leantime-{{ versao_leantime }}.zip"    dest: "/var/www/leantime"  owner: www-datagroup: www-datamode: 0755remote_src: true
<span style="color: #00aaaa">   # Ap√≥s a descompress√£o, se o ficheiro configuration.php n√£o existir, este necessita de ser
   # criado a partir do ficheiro configuration.sample.php
   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html</span>- name: Copia o ficheiro de configura√ß√£o configuration.sample.phpansible.builtin.copy: src: /var/www/leantime/config/configuration.sample.php    dest: /var/www/leantime/config/configuration.php  owner: www-datagroup: www-data    mode: '0755'  remote_src: trueforce: false
[?12l[?25h[?25l  remote_src: trueforce: false
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html</span>- name: Altera as vari√°veis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o m√≥dulo replace.ansible.builtin.replace:path: /var/www/leantime/config/configuration.php    regexp: "{{ item.regexp  }}"  replace: "{{ item.line }}"with_items:- regexp: 'dbUser=""'  line: 'dbUser="{{ login_leantime }}"'- regexp: 'dbDatabase=""' line: 'dbDatabase="leantime_database"'    - regexp: 'dbPassword=""'    line: 'dbPassword="{{ password_leantime }}"'
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html</span>- name: Copia o template do site para a p√°sta /etc/apache2/sites-availableansible.builtin.template:src: leantime.template.j2dest: /etc/apache2/sites-available/leantime.confowner: root group: www-data mode: 0755
[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l<span style="background-color: #AAAAAA; color: #000000">Modificado</span>
[?12l[?25h[?25l[?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l
<span style="color: #00aaaa">  #</span>[?12l[?25h[?25l<span style="color: #00aaaa"> </span>[?12l[?25h[?25l<span style="color: #00aaaa">F</span>[?12l[?25h[?25l<span style="color: #00aaaa">o
</span>[?12l[?25h[?25l<span style="color: #00aaaa">n</span>[?12l[?25h[?25l<span style="color: #00aaaa">t</span>[?12l[?25h[?25l<span style="color: #00aaaa">e</span>[?12l[?25h[?25l<span style="color: #00aaaa">:</span>[?12l[?25h[?25l<span style="color: #00aaaa"> </span>[?12l[?25h[?25l<span style="color: #00aaaa">h</span>[?12l[?25h[?25l<span style="color: #00aaaa">t</span>[?12l[?25h[?25l<span style="color: #00aaaa">t</span>[?12l[?25h[?25l<span style="color: #00aaaa">p</span>[?12l[?25h[?25l<span style="color: #00aaaa">s</span>[?12l[?25h[?25l<span style="color: #00aaaa">:</span>[?12l[?25h[?25l<span style="color: #00aaaa">/</span>[?12l[?25h[?25l<span style="color: #00aaaa">/</span>[?12l[?25h[?25l<span style="color: #00aaaa">d</span>[?12l[?25h[?25l<span style="color: #00aaaa">o</span>[?12l[?25h[?25l<span style="color: #00aaaa">c</span>[?12l[?25h[?25l<span style="color: #00aaaa">s</span>[?12l[?25h[?25l<span style="color: #00aaaa">.</span>[?12l[?25h[?25l<span style="color: #00aaaa">a</span>[?12l[?25h[?25l<span style="color: #00aaaa">n</span>[?12l[?25h[?25l<span style="color: #00aaaa">s</span>[?12l[?25h[?25l<span style="color: #00aaaa">i</span>[?12l[?25h[?25l<span style="color: #00aaaa">b</span>[?12l[?25h[?25l<span style="color: #00aaaa">l</span>[?12l[?25h[?25l<span style="color: #00aaaa">e</span>[?12l[?25h[?25l<span style="color: #00aaaa">.</span>[?12l[?25h[?25l<span style="color: #00aaaa">c</span>[?12l[?25h[?25l<span style="color: #00aaaa">o</span>[?12l[?25h[?25l<span style="color: #00aaaa">m</span>[?12l[?25h[?25l<span style="color: #00aaaa">/</span>[?12l[?25h[?25l<span style="color: #00aaaa">a</span>[?12l[?25h[?25l<span style="color: #00aaaa">n</span>[?12l[?25h[?25l<span style="color: #00aaaa">s</span>[?12l[?25h[?25l<span style="color: #00aaaa">i</span>[?12l[?25h[?25l<span style="color: #00aaaa">b</span>[?12l[?25h[?25l<span style="color: #00aaaa">l</span>[?12l[?25h[?25l<span style="color: #00aaaa">e</span>[?12l[?25h[?25l<span style="color: #00aaaa">/</span>[?12l[?25h[?25l<span style="color: #00aaaa">l</span>[?12l[?25h[?25l<span style="color: #00aaaa">a</span>[?12l[?25h[?25l<span style="color: #00aaaa">t</span>[?12l[?25h[?25l<span style="color: #00aaaa">e</span>[?12l[?25h[?25l<span style="color: #00aaaa">s</span>[?12l[?25h[?25l<span style="color: #00aaaa">t</span>[?12l[?25h[?25l<span style="color: #00aaaa">/</span>[?12l[?25h[?25l<span style="color: #00aaaa">c</span>[?12l[?25h[?25l<span style="color: #00aaaa">o</span>[?12l[?25h[?25l<span style="color: #00aaaa">l</span>[?12l[?25h[?25l<span style="color: #00aaaa">l</span>[?12l[?25h[?25l<span style="color: #00aaaa">e</span>[?12l[?25h[?25l<span style="color: #00aaaa">c</span>[?12l[?25h[?25l<span style="color: #00aaaa">t</span>[?12l[?25h[?25l<span style="color: #00aaaa">i</span>[?12l[?25h[?25l<span style="color: #00aaaa">o</span>[?12l[?25h[?25l<span style="color: #00aaaa">n</span>[?12l[?25h[?25l<span style="color: #00aaaa">s</span>[?12l[?25h[?25l<span style="color: #00aaaa">/</span>[?12l[?25h[?25l<span style="color: #00aaaa">a</span>[?12l[?25h[?25l<span style="color: #00aaaa">n</span>[?12l[?25h[?25l<span style="color: #00aaaa">s</span>[?12l[?25h[?25l<span style="color: #00aaaa">i</span>[?12l[?25h[?25l<span style="color: #00aaaa">b</span>[?12l[?25h[?25l<span style="color: #00aaaa">l</span>[?12l[?25h[?25l<span style="color: #00aaaa">e</span>[?12l[?25h[?25l<span style="color: #00aaaa">/</span>[?12l[?25h[?25l<span style="color: #00aaaa">b</span>[?12l[?25h[?25l<span style="color: #00aaaa">u</span>[?12l[?25h[?25l<span style="color: #00aaaa">i</span>[?12l[?25h[?25l<span style="color: #00aaaa">l</span>[?12l[?25h[?25l<span style="color: #00aaaa">t</span>[?12l[?25h[?25l<span style="color: #00aaaa">i</span>[?12l[?25h[?25l<span style="color: #00aaaa">n</span>[?12l[?25h[?25l<span style="color: #00aaaa">/</span>[?12l[?25h[?25l<span style="color: #00aaaa">f</span>[?12l[?25h[?25l<span style="color: #00aaaa">i</span>[?12l[?25h[?25l<span style="color: #00aaaa">l</span>[?12l[?25h[?25l<span style="color: #00aaaa">e</span>[?12l[?25h[?25l<span style="color: #00aaaa">_</span>[?12l[?25h[?25l<span style="color: #00aaaa">m</span>[?12l[?25h[?25l<span style="color: #00aaaa">o</span>[?12l[?25h[?25l<span style="color: #00aaaa">d</span>[?12l[?25h[?25l<span style="color: #00aaaa">u</span>[?12l[?25h[?25l<span style="color: #00aaaa">l</span>[?12l[?25h[?25l<span style="color: #00aaaa">e</span>[?12l[?25h[?25l<span style="color: #00aaaa">.</span>[?12l[?25h[?25l<span style="color: #00aaaa">h</span>[?12l[?25h[?25l<span style="color: #00aaaa">t</span>[?12l[?25h[?25l<span style="color: #00aaaa">m</span>[?12l[?25h[?25l<span style="color: #00aaaa">l</span>[?12l[?25h[?25l
[?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l-[?12l[?25h[?25l [?12l[?25h[?25ln[?12l[?25h[?25la[?12l[?25h[?25lm[?12l[?25h[?25le[?12l[?25h[?25l:[?12l[?25h[?25l [?12l[?25h[?25l"[?12l[?25h[?25lC[?12l[?25h[?25lr[?12l[?25h[?25li[?12l[?25h[?25la[?12l[?25h[?25l [?12l[?25h[?25lu[?12l[?25h[?25lm[?12l[?25h[?25l [?12l[?25h[?25ll[?12l[?25h[?25li[?12l[?25h[?25ln[?12l[?25h[?25lk[?12l[?25h[?25l [?12l[?25h[?25ls[?12l[?25h[?25li[?12l[?25h[?25lm[?12l[?25h[?25lb[?12l[?25h[?25l√≥[?12l[?25h[?25ll[?12l[?25h[?25li[?12l[?25h[?25lc[?12l[?25h[?25lo[?12l[?25h[?25l [?12l[?25h[?25lp[?12l[?25h[?25la[?12l[?25h[?25lr[?12l[?25h[?25la[?12l[?25h[?25l [?12l[?25h[?25lo[?12l[?25h[?25l [?12l[?25h[?25lf[?12l[?25h[?25li[?12l[?25h[?25lc[?12l[?25h[?25lh[?12l[?25h[?25le[?12l[?25h[?25li[?12l[?25h[?25lr[?12l[?25h[?25lo[?12l[?25h[?25l [?12l[?25h[?25ll[?12l[?25h[?25le[?12l[?25h[?25la[?12l[?25h[?25ln[?12l[?25h[?25lt[?12l[?25h[?25li[?12l[?25h[?25lm[?12l[?25h[?25le[?12l[?25h[?25l.[?12l[?25h[?25lc[?12l[?25h[?25lo[?12l[?25h[?25ln[?12l[?25h[?25lf[?12l[?25h[?25l [?12l[?25h[?25ln[?12l[?25h[?25la[?12l[?25h[?25l [?12l[?25h[?25lp[?12l[?25h[?25ls[?12l[?25h[?25lt[?12l[?25h[?25la[?12l[?25h[?25l [?12l[?25h[?25l/[?12l[?25h[?25le[?12l[?25h[?25lt[?12l[?25h[?25lc[?12l[?25h[?25l/[?12l[?25h[?25la[?12l[?25h[?25lp[?12l[?25h[?25la[?12l[?25h[?25lc[?12l[?25h[?25lh[?12l[?25h[?25le[?12l[?25h[?25l/[?12l[?25h[?25ls[?12l[?25h[?25li[?12l[?25h[?25lt[?12l[?25h[?25le[?12l[?25h[?25ls[?12l[?25h[?25l-[?12l[?25h[?25le[?12l[?25h[?25ln[?12l[?25h[?25la[?12l[?25h[?25lb[?12l[?25h[?25ll[?12l[?25h[?25le[?12l[?25h[?25ld[?12l[?25h[?25l"[?12l[?25h[?25l
[?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25la[?12l[?25h[?25ln[?12l[?25h[?25ls[?12l[?25h[?25li[?12l[?25h[?25lb[?12l[?25h[?25ll[?12l[?25h[?25le[?12l[?25h[?25l.[?12l[?25h[?25lb[?12l[?25h[?25lu[?12l[?25h[?25li[?12l[?25h[?25ll[?12l[?25h[?25lt[?12l[?25h[?25li[?12l[?25h[?25ln[?12l[?25h[?25l.[?12l[?25h[?25lf[?12l[?25h[?25li[?12l[?25h[?25ll[?12l[?25h[?25le[?12l[?25h[?25l:[?12l[?25h[?25l
[?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25ls[?12l[?25h[?25lr[?12l[?25h[?25lc[?12l[?25h[?25l:[?12l[?25h[?25l [?12l[?25h[?25l/[?12l[?25h[?25le[?12l[?25h[?25lt[?12l[?25h[?25lc[?12l[?25h[?25l/[?12l[?25h[?25la[?12l[?25h[?25lp[?12l[?25h[?25la[?12l[?25h[?25lc[?12l[?25h[?25lh[?12l[?25h[?25le[?12l[?25h[?25l2[?12l[?25h[?25l/[?12l[?25h[?25ls[?12l[?25h[?25li[?12l[?25h[?25lt[?12l[?25h[?25le[?12l[?25h[?25ls[?12l[?25h[?25l-[?12l[?25h[?25la[?12l[?25h[?25lv[?12l[?25h[?25la[?12l[?25h[?25li[?12l[?25h[?25ll[?12l[?25h[?25la[?12l[?25h[?25lb[?12l[?25h[?25ll[?12l[?25h[?25le[?12l[?25h[?25l/[?12l[?25h[?25ll[?12l[?25h[?25le[?12l[?25h[?25la[?12l[?25h[?25ln[?12l[?25h[?25lt[?12l[?25h[?25li[?12l[?25h[?25lm[?12l[?25h[?25le[?12l[?25h[?25l.[?12l[?25h[?25lc[?12l[?25h[?25lo[?12l[?25h[?25ln[?12l[?25h[?25lf[?12l[?25h[?25l
[?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25ld[?12l[?25h[?25le[?12l[?25h[?25ls[?12l[?25h[?25lt[?12l[?25h[?25l:[?12l[?25h[?25l [?12l[?25h[?25l/[?12l[?25h[?25le[?12l[?25h[?25lt[?12l[?25h[?25lc[?12l[?25h[?25l/[?12l[?25h[?25la[?12l[?25h[?25lp[?12l[?25h[?25la[?12l[?25h[?25lc[?12l[?25h[?25lh[?12l[?25h[?25le[?12l[?25h[?25l2[?12l[?25h[?25l/[?12l[?25h[?25ls[?12l[?25h[?25li[?12l[?25h[?25lt[?12l[?25h[?25le[?12l[?25h[?25ls[?12l[?25h[?25l-[?12l[?25h[?25le[?12l[?25h[?25ln[?12l[?25h[?25la[?12l[?25h[?25lb[?12l[?25h[?25ll[?12l[?25h[?25le[?12l[?25h[?25ld[?12l[?25h[?25l
[?12l[?25h[?25l  [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25lo[?12l[?25h[?25lw[?12l[?25h[?25ln[?12l[?25h[?25le[?12l[?25h[?25lr[?12l[?25h[?25l:[?12l[?25h[?25l [?12l[?25h[?25lr[?12l[?25h[?25lo[?12l[?25h[?25lo[?12l[?25h[?25lt[?12l[?25h[?25l
[?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25lg[?12l[?25h[?25lr[?12l[?25h[?25lo[?12l[?25h[?25lu[?12l[?25h[?25lp[?12l[?25h[?25l:[?12l[?25h[?25l [?12l[?25h[?25lr[?12l[?25h[?25lo[?12l[?25h[?25lo[?12l[?25h[?25lt[?12l[?25h[?25l
[?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25lm[?12l[?25h[?25lo[?12l[?25h[?25ld[?12l[?25h[?25le[?12l[?25h[?25l:[?12l[?25h[?25l [?12l[?25h[?25l'[?12l[?25h[?25l0[?12l[?25h[?25l7[?12l[?25h[?25l7[?12l[?25h[?25l7[?12l[?25h[?25l'[?12l[?25h[?25l
[?12l[?25h[?25l[?12l[?25h[?25lm[?12l[?25h[?25l [?12l[?25h[?25ll[?12l[?25h[?25li[?12l[?25h[?25ln[?12l[?25h[?25lk[?12l[?25h[?25l [?12l[?25h[?25ls[?12l[?25h[?25li[?12l[?25h[?25lm[?12l[?25h[?25lb[?12l[?25h[?25l[?12l[?25h[?25ll[?12l[?25h[?25li[?12l[?25h[?25lc[?12l[?25h[?25lo[?12l[?25h[?25l [?12l[?25h[?25lp[?12l[?25h[?25la[?12l[?25h[?25lr[?12l[?25h[?25la[?12l[?25h[?25l [?12l[?25h[?25lo[?12l[?25h[?25l [?12l[?25h[?25lf[?12l[?25h[?25li[?12l[?25h[?25lc[?12l[?25h[?25lh[?12l[?25h[?25le[?12l[?25h[?25li[?12l[?25h[?25lr[?12l[?25h[?25lo[?12l[?25h[?25l [?12l[?25h[?25ll[?12l[?25h[?25le[?12l[?25h[?25la[?12l[?25h[?25ln[?12l[?25h[?25lt[?12l[?25h[?25li[?12l[?25h[?25lm[?12l[?25h[?25le[?12l[?25h[?25l.[?12l[?25h[?25lc[?12l[?25h[?25lo[?12l[?25h[?25ln[?12l[?25h[?25lf[?12l[?25h[?25l [?12l[?25h[?25ln[?12l[?25h[?25la[?12l[?25h[?25l [?12l[?25h[?25lp[?12l[?25h[?25lasta /etc/apache/sites-enabled"[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l'[?12l[?25h[?25l[?12l[?25h[?25l78

[?12l[?25h[?25l[?12l[?25h[?25l         <span style="background-color: #AAAAAA; color: #000000">M-D</span> Formato DOS<span style="background-color: #AAAAAA; color: #000000">M-A</span> Anexar<span style="background-color: #AAAAAA; color: #000000">B</span> Seguran√ßa<span style="background-color: #AAAAAA; color: #000000">C</span> Cancelar           <span style="background-color: #AAAAAA; color: #000000">M-M</span> Formato Mac<span style="background-color: #AAAAAA; color: #000000">M-P</span> Prepor<span style="background-color: #AAAAAA; color: #000000">^T</span> P/ ficheiros
[?12l[?25h[?25l[?12l[?25h[?1049l
[?1l&gt;[?2004l]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ molecule lint
<span style="color: #0000aa">INFO    </span> default scenario test matrix: dependency, lint
<span style="color: #0000aa">INFO    </span> Performing prerun<span style="color: #aa5500">...</span>
<span style="color: #0000aa">INFO    </span> Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
<span style="color: #0000aa">INFO    </span> Added <span style="color: #aa5500">ANSIBLE_ROLES_PATH</span>=~<span style="color: #E850A8">/.ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/usr/share/ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/etc/ansible/</span><span style="color: #ff90e8">roles</span>:.<span style="color: #E850A8">/.cache/</span><span style="color: #ff90e8">roles</span>
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">dependency</span>
<span style="color: #aa0000">WARNING </span> Skipping, missing the requirements file.
<span style="color: #aa0000">WARNING </span> Skipping, missing the requirements file.
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">lint</span>
COMMAND: set -e
yamllint .
ansible-lint

./tasks/tasks.yml
  160:3     error    syntax error: expected '&lt;document start&gt;', but found '&lt;block sequence start&gt;' (syntax)

<span style="font-weight: bold; color: #aa0000">CRITICAL</span> Lint failed with error code <span style="font-weight: bold; color: #00aaaa">1</span>
]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ molecule lintnano tasks/tasks.yml 
[?2004h[?1049h[?7h[?1h=[?1h=[?25l<span style="background-color: #AAAAAA; color: #000000">[ A ler... ]</span><span style="background-color: #AAAAAA; color: #000000">[ 167 linhas lidas ]</span><span style="background-color: #AAAAAA; color: #000000">  GNU nano 4.8                                                tasks/tasks.yml                                                             </span>
<span style="background-color: #AAAAAA; color: #000000">^G</span> Ajuda<span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar<span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor    <span style="background-color: #AAAAAA; color: #000000">M-U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt
<span style="background-color: #AAAAAA; color: #000000">^X</span> Sair<span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer<span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
---- name: Atualiza a cache (equivalente a apt update)apt:update_cache: truecache_valid_time: 3600- name: "Atualiza o sistema operativo"apt:upgrade: safe- name: "Instalar as dependencias necess√°ria ao programa leantime"apt:pkg:- mc- screen- git- apache2- mysql-server- php- php-mysql- php-ldap- php-cli- php-soap- php-json- graphviz- php-xml- php-gd- php-zip- libapache2-mod-php- php-dev- libmcrypt-dev- gcc- make- autoconf- libc-dev
[?12l[?25h[?25l         In. par√°g<span style="background-color: #AAAAAA; color: #000000">^Y</span> Prim.linha<span style="background-color: #AAAAAA; color: #000000">^T</span> Ir para txt<span style="background-color: #AAAAAA; color: #000000">C</span> Cancelar           <span style="background-color: #AAAAAA; color: #000000">O</span> Fim par√°g<span style="background-color: #AAAAAA; color: #000000">V</span> √ölt. linha
<span style="background-color: #AAAAAA; color: #000000">Insira n¬∫ da linha, n¬∫ da coluna:                                                                                                         </span>[?12l[?25h[?25l<span style="background-color: #AAAAAA; color: #000000">1
</span>[?12l[?25h[?25l<span style="background-color: #AAAAAA; color: #000000">6
</span>[?12l[?25h[?25l<span style="background-color: #AAAAAA; color: #000000">0
</span>[?12l[?25h[?25l<span style="background-color: #AAAAAA; color: #000000">,
</span>[?12l[?25h[?25l<span style="background-color: #AAAAAA; color: #000000">3
</span>[?12l[?25h[?25l
<span style="background-color: #AAAAAA; color: #000000">^O</span> GravarProcurar      <span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor    <span style="background-color: #AAAAAA; color: #000000">M-U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt<span style="background-color: #AAAAAA; color: #000000">X</span> Sair    <span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt<span style="background-color: #AAAAAA; color: #000000">T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer<span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
 - regexp: 'dbUser=""' line: 'dbUser="{{ login_leantime }}"'  - regexp: 'dbDatabase=""'  line: 'dbDatabase="leantime_database"'- regexp: 'dbPassword=""'line: 'dbPassword="{{ password_leantime }}"'
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html</span>- name: Copia o template do site para a p√°sta /etc/apache2/sites-availableansible.builtin.template:    src: leantime.template.j2  dest: /etc/apache2/sites-available/leantime.confowner: rootgroup: www-datamode: 0755
<span style="color: #00aaaa">  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html</span>- name: "Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"ansible.builtin.file:src: /etc/apache2/sites-available/leantime.confdest: /etc/apache2/sites-enabledowner: rootgroup: rootmode: '0777'state: link
  [?12l[?25h[?25l<span style="background-color: #AAAAAA; color: #000000">Modificado</span>
[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l
[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html
   </span>[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l
     ansible.builtin.file:[?12l[?25h[?25l[?12l[?25h[?25l
 src: /etc/apache2/sites-available/leantime.conf[?12l[?25h[?25l[?12l[?25h[?25l
 dest: /etc/apache2/sites-enabled[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l
 owner: root[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l
 group: root[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l
 mode: '0777'[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l
 state: link[?12l[?25h[?25l
[?12l[?25h[?25l[?12l[?25h[?25l         <span style="background-color: #AAAAAA; color: #000000">M-D</span> Formato DOS<span style="background-color: #AAAAAA; color: #000000">M-A</span> Anexar<span style="background-color: #AAAAAA; color: #000000">B</span> Seguran√ßa<span style="background-color: #AAAAAA; color: #000000">C</span> Cancelar           <span style="background-color: #AAAAAA; color: #000000">M-M</span> Formato Mac<span style="background-color: #AAAAAA; color: #000000">M-P</span> Prepor<span style="background-color: #AAAAAA; color: #000000">^T</span> P/ ficheiros
<span style="background-color: #AAAAAA; color: #000000">Nome do ficheiro onde escrever: tasks/tasks.yml                                                                                           </span>[?12l[?25h[?25l <span style="background-color: #AAAAAA; color: #000000">[ A escrever... ]</span><span style="background-color: #AAAAAA; color: #000000">          </span><span style="background-color: #AAAAAA; color: #000000">[ 167 linhas escritas ]</span><span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar      <span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor<span style="background-color: #AAAAAA; color: #000000">U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt<span style="background-color: #AAAAAA; color: #000000">X</span> Sair    <span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer      <span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
[?12l[?25h[?25l[?12l[?25h[?1049l
[?1l&gt;[?2004l]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ nano tasks/tasks.yml molecule lint
<span style="color: #0000aa">INFO    </span> default scenario test matrix: dependency, lint
<span style="color: #0000aa">INFO    </span> Performing prerun<span style="color: #aa5500">...</span>
<span style="color: #0000aa">INFO    </span> Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
<span style="color: #0000aa">INFO    </span> Added <span style="color: #aa5500">ANSIBLE_ROLES_PATH</span>=~<span style="color: #E850A8">/.ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/usr/share/ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/etc/ansible/</span><span style="color: #ff90e8">roles</span>:.<span style="color: #E850A8">/.cache/</span><span style="color: #ff90e8">roles</span>
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">dependency</span>
<span style="color: #aa0000">WARNING </span> Skipping, missing the requirements file.
<span style="color: #aa0000">WARNING </span> Skipping, missing the requirements file.
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">lint</span>
COMMAND: set -e
yamllint .
ansible-lint

Loading custom .yamllint config file, this extends our internal yamllint config.
]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ molecule converge
<span style="color: #0000aa">INFO    </span> default scenario test matrix: dependency, create, prepare, converge
<span style="color: #0000aa">INFO    </span> Performing prerun<span style="color: #aa5500">...</span>
<span style="color: #0000aa">INFO    </span> Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
<span style="color: #0000aa">INFO    </span> Added <span style="color: #aa5500">ANSIBLE_ROLES_PATH</span>=~<span style="color: #E850A8">/.ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/usr/share/ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/etc/ansible/</span><span style="color: #ff90e8">roles</span>:.<span style="color: #E850A8">/.cache/</span><span style="color: #ff90e8">roles</span>
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">dependency</span>
<span style="color: #aa0000">WARNING </span> Skipping, missing the requirements file.
<span style="color: #aa0000">WARNING </span> Skipping, missing the requirements file.
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">create</span>
<span style="color: #aa0000">WARNING </span> Skipping, instances already created.
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">prepare</span>
<span style="color: #aa0000">WARNING </span> Skipping, instances already prepared.
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">converge</span>

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
<span style="color: #aa5500">changed: [ubuntu-20.04]</span>

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instalar as dependencias necess√°ria ao programa leantime] *******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instala o servi√ßo apache2 no arranque do sistema] ***************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Ativa v√°rias op√ß√µes no ficheiro php.ini, utilizando o m√≥dulo lineinfile.] ***************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})</span>

TASK [leantime_ansible : Cria a directoria tempor√°ria leantime e a directoria de apache leantime] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/tmp/leantime'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/var/www/leantime'})</span>

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
<span style="font-weight: bold; color: #E850A8">[WARNING]: Module did not set no_log for update_password</span>
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Faz o download do software leantime a partir do reposit√≥rio git] ************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Copia o ficheiro de configura√ß√£o configuration.sample.php] ******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Altera as vari√°veis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o m√≥dulo replace.] ***
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})</span>

TASK [leantime_ansible : Copia o template do site para a p√°sta /etc/apache2/sites-available] *********************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
<span style="color: #aa0000">fatal: [ubuntu-20.04]: FAILED! =&gt; {"changed": false, "gid": 0, "group": "root", "mode": "0755", "msg": "refusing to convert from directory to symlink for /etc/apache2/sites-enabled", "owner": "root", "path": "/etc/apache2/sites-enabled", "size": 4096, "state": "directory", "uid": 0}</span>

PLAY RECAP *******************************************************************************************************************************
<span style="color: #aa0000">ubuntu-20.04</span>               : <span style="color: #00aa00">ok=15  </span> <span style="color: #aa5500">changed=1   </span> unreachable=0    <span style="color: #aa0000">failed=1   </span> skipped=0    rescued=0    ignored=0


<span style="font-weight: bold; color: #aa0000">CRITICAL</span> Ansible return code was <span style="font-weight: bold; color: #00aaaa">2</span>, command was: ansible-playbook --inventory <span style="color: #E850A8">/home/admlocal/.cache/molecule/leantime_ansible/default/</span><span style="color: #ff90e8">inventory</span> --skip-tags molecule-notest,notest <span style="color: #E850A8">/home/admlocal/leantime_ansible/molecule/default/</span><span style="color: #ff90e8">converge.yml</span>
]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ molecule convergelintnano tasks/tasks.yml 
[?2004h[?1049h[?7h[?1h=[?1h=[?25l<span style="background-color: #AAAAAA; color: #000000">[ A ler... ]</span><span style="background-color: #AAAAAA; color: #000000">[ 167 linhas lidas ]</span><span style="background-color: #AAAAAA; color: #000000">  GNU nano 4.8                                                tasks/tasks.yml                                                             </span>
<span style="background-color: #AAAAAA; color: #000000">^G</span> Ajuda<span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar<span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor    <span style="background-color: #AAAAAA; color: #000000">M-U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt
<span style="background-color: #AAAAAA; color: #000000">^X</span> Sair<span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer<span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
---- name: Atualiza a cache (equivalente a apt update)apt:update_cache: truecache_valid_time: 3600- name: "Atualiza o sistema operativo"apt:upgrade: safe- name: "Instalar as dependencias necess√°ria ao programa leantime"apt:pkg:- mc- screen- git- apache2- mysql-server- php- php-mysql- php-ldap- php-cli- php-soap- php-json- graphviz- php-xml- php-gd- php-zip- libapache2-mod-php- php-dev- libmcrypt-dev- gcc- make- autoconf- libc-dev
[?12l[?25h[?25l - autoconf    - libc-dev  - pkg-config- pwgen- curl- unzip    - zip  - php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurl
<span style="color: #00aaaa">   # Fonte de inspira√ß√£o: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.html</span>- name: "Instala o servi√ßo apache2 no arranque do sistema"service:name: apache2state: startedenabled: true
<span style="color: #00aaaa">   # Fonte: https://www.mydailytutorials.com/using-ansible-find-module-search-filesfolder</span>- name: "Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurse: trueregister: caminho_php_ini
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.html</span>- name: "Ativa v√°rias op√ß√µes no ficheiro php.ini, utilizando o m√≥dulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"
[?12l[?25h[?25lregexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:regexp: "^file_uploads"  line: "file_uploads = 1"regexp: "^upload_max_filesize"  line: "upload_max_filesize = 1G"regexp: "^max_file_uploads"  line: "max_file_uploads = 20"regexp: "^post_max_size"  line: "post_max_size = 2G"regexp: "^memory_limit"  line: "memory_limit = 2G"- regexp: "^max_input_time" line: "max_input_time = 3600"
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/2.7/modules/file_module.html</span>- name: Cria a directoria tempor√°ria leantime e a directoria de apache leantimefile:path: "{{ item.path }}"state: directory mode: 0755    owner: www-data  group: www-datawith_items:- path: "/tmp/leantime"- path: "/var/www/leantime"
<span style="color: #00aaaa">   # Fonte: Ansible for DevOps - Server and configuration management for humans de Jeff Geerling, p√°gina 98
</span>   - name: "Cria a base de dados de mysql para o leantime"  mysql_db: "db=leantime_database state=present"
- name: "Cria o utilizador para a base de dados leantime"mysql_user:namlogin_leantime }}"
[?12l[?25h[?25lmysql_user:namlogin_leantime }}"  password: "{{ password_leantime }}"priv: "leantime_database.*:ALL"host: localhoststate: present
- name: "Faz o download do software leantime a partir do reposit√≥rio git"get_url:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipdest: /tmp/leantimemode: 0755
<span style="color: #00aaaa">   # O ficheiro Leantime-versao.zip necessita de ser descomprimido</span>- name: Descomprime o software leantimeunarchive: src: "/tmp/leantime/Leantime-{{ versao_leantime }}.zip"    dest: "/var/www/leantime"  owner: www-datagroup: www-datamode: 0755remote_src: true
<span style="color: #00aaaa">   # Ap√≥s a descompress√£o, se o ficheiro configuration.php n√£o existir, este necessita de ser
   # criado a partir do ficheiro configuration.sample.php
   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html</span>- name: Copia o ficheiro de configura√ß√£o configuration.sample.phpansible.builtin.copy: src: /var/www/leantime/config/configuration.sample.php    dest: /var/www/leantime/config/configuration.php  owner: www-datagroup: www-data    mode: '0755'  remote_src: trueforce: false
[?12l[?25h[?25l  remote_src: trueforce: false
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html</span>- name: Altera as vari√°veis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o m√≥dulo replace.ansible.builtin.replace:path: /var/www/leantime/config/configuration.php    regexp: "{{ item.regexp  }}"  replace: "{{ item.line }}"with_items:- regexp: 'dbUser=""'  line: 'dbUser="{{ login_leantime }}"'- regexp: 'dbDatabase=""' line: 'dbDatabase="leantime_database"'    - regexp: 'dbPassword=""'    line: 'dbPassword="{{ password_leantime }}"'
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html</span>- name: Copia o template do site para a p√°sta /etc/apache2/sites-availableansible.builtin.template:src: leantime.template.j2dest: /etc/apache2/sites-available/leantime.confowner: root group: www-data mode: 0755
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html</span>- name: "Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"ansible.builtin.file:src: /etc/apache2/sites-available/leantime.confdest: /etc/apache2/sites-enabledowner: rootgroup: rootmode: '0777'state: link
[?12l[?25h[?25lmode: '0777'state: link
[?12l[?25h[?25l78Mgroup: root
[?12l[?25h[?25l78Mowner: root
[?12l[?25h[?25l78Mdest: /etc/apache2/sites-enabled
[?12l[?25h[?25l78Msrc: /etc/apache2/sites-available/leantime.conf
[?12l[?25h[?25l78Mansible.builtin.file:
[?12l[?25h[?25l78M- name: "Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"
[?12l[?25h[?25l78M<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html
</span>[?12l[?25h[?25l78M[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l
[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l<span style="background-color: #AAAAAA; color: #000000">Modificado</span>M
leantime.conf
[?12l[?25h[?25l
[?12l[?25h[?25l[?12l[?25h[?25l78
Mleantime.conf
[?12l[?25h[?25l
[?12l[?25h[?25l[?12l[?25h[?25l/[?12l[?25h[?25l78
Mleantime.conf
[?12l[?25h[?25l
[?12l[?25h[?25l         <span style="background-color: #AAAAAA; color: #000000">M-D</span> Formato DOS<span style="background-color: #AAAAAA; color: #000000">M-A</span> Anexar<span style="background-color: #AAAAAA; color: #000000">B</span> Seguran√ßa<span style="background-color: #AAAAAA; color: #000000">C</span> Cancelar           <span style="background-color: #AAAAAA; color: #000000">M-M</span> Formato Mac<span style="background-color: #AAAAAA; color: #000000">M-P</span> Prepor<span style="background-color: #AAAAAA; color: #000000">^T</span> P/ ficheiros
<span style="background-color: #AAAAAA; color: #000000">Nome do ficheiro onde escrever: tasks/tasks.yml                                                                                           </span>[?12l[?25h[?25l <span style="background-color: #AAAAAA; color: #000000">[ A escrever... ]</span><span style="background-color: #AAAAAA; color: #000000">          </span><span style="background-color: #AAAAAA; color: #000000">[ 167 linhas escritas ]</span><span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar      <span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor<span style="background-color: #AAAAAA; color: #000000">U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt<span style="background-color: #AAAAAA; color: #000000">X</span> Sair    <span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer      <span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
[?12l[?25h[?25l
[?12l[?25h[?1049l
[?1l&gt;[?2004l]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ nano tasks/tasks.yml molecule converge
<span style="color: #0000aa">INFO    </span> default scenario test matrix: dependency, create, prepare, converge
<span style="color: #0000aa">INFO    </span> Performing prerun<span style="color: #aa5500">...</span>
<span style="color: #0000aa">INFO    </span> Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
<span style="color: #0000aa">INFO    </span> Added <span style="color: #aa5500">ANSIBLE_ROLES_PATH</span>=~<span style="color: #E850A8">/.ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/usr/share/ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/etc/ansible/</span><span style="color: #ff90e8">roles</span>:.<span style="color: #E850A8">/.cache/</span><span style="color: #ff90e8">roles</span>
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">dependency</span>
<span style="color: #aa0000">WARNING </span> Skipping, missing the requirements file.
<span style="color: #aa0000">WARNING </span> Skipping, missing the requirements file.
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">create</span>
<span style="color: #aa0000">WARNING </span> Skipping, instances already created.
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">prepare</span>
<span style="color: #aa0000">WARNING </span> Skipping, instances already prepared.
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">converge</span>

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instalar as dependencias necess√°ria ao programa leantime] *******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instala o servi√ßo apache2 no arranque do sistema] ***************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Ativa v√°rias op√ß√µes no ficheiro php.ini, utilizando o m√≥dulo lineinfile.] ***************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})</span>

TASK [leantime_ansible : Cria a directoria tempor√°ria leantime e a directoria de apache leantime] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/tmp/leantime'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/var/www/leantime'})</span>

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
<span style="font-weight: bold; color: #E850A8">[WARNING]: Module did not set no_log for update_password</span>
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Faz o download do software leantime a partir do reposit√≥rio git] ************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Copia o ficheiro de configura√ß√£o configuration.sample.php] ******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Altera as vari√°veis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o m√≥dulo replace.] ***
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})</span>

TASK [leantime_ansible : Copia o template do site para a p√°sta /etc/apache2/sites-available] *********************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
<span style="color: #aa5500">changed: [ubuntu-20.04]</span>

PLAY RECAP *******************************************************************************************************************************
<span style="color: #aa5500">ubuntu-20.04</span>               : <span style="color: #00aa00">ok=16  </span> <span style="color: #aa5500">changed=1   </span> unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ molecule convergeidempotence
<span style="color: #0000aa">INFO    </span> default scenario test matrix: idempotence
<span style="color: #0000aa">INFO    </span> Performing prerun<span style="color: #aa5500">...</span>
<span style="color: #0000aa">INFO    </span> Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
<span style="color: #0000aa">INFO    </span> Added <span style="color: #aa5500">ANSIBLE_ROLES_PATH</span>=~<span style="color: #E850A8">/.ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/usr/share/ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/etc/ansible/</span><span style="color: #ff90e8">roles</span>:.<span style="color: #E850A8">/.cache/</span><span style="color: #ff90e8">roles</span>
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">idempotence</span>

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instalar as dependencias necess√°ria ao programa leantime] *******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instala o servi√ßo apache2 no arranque do sistema] ***************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Ativa v√°rias op√ß√µes no ficheiro php.ini, utilizando o m√≥dulo lineinfile.] ***************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})</span>

TASK [leantime_ansible : Cria a directoria tempor√°ria leantime e a directoria de apache leantime] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/tmp/leantime'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/var/www/leantime'})</span>

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
<span style="font-weight: bold; color: #E850A8">[WARNING]: Module did not set no_log for update_password</span>
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Faz o download do software leantime a partir do reposit√≥rio git] ************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Copia o ficheiro de configura√ß√£o configuration.sample.php] ******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Altera as vari√°veis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o m√≥dulo replace.] ***
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})</span>

TASK [leantime_ansible : Copia o template do site para a p√°sta /etc/apache2/sites-available] *********************************************
<span style="color: #aa5500">changed: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
<span style="color: #aa5500">changed: [ubuntu-20.04]</span>

PLAY RECAP *******************************************************************************************************************************
<span style="color: #aa5500">ubuntu-20.04</span>               : <span style="color: #00aa00">ok=16  </span> <span style="color: #aa5500">changed=2   </span> unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


<span style="font-weight: bold; color: #aa0000">CRITICAL</span> Idempotence test failed because of the following tasks:
*  =&gt; leantime_ansible : Copia o template do site para a p√°sta <span style="color: #E850A8">/etc/apache2/</span><span style="color: #ff90e8">sites-available</span>
*  =&gt; leantime_ansible : Cria um link simb√≥lico para o ficheiro leantime.conf na pasta <span style="color: #E850A8">/etc/apache/</span><span style="color: #ff90e8">sites-enabled</span>
]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ nano tasks/
[?2004h[?1049h[?7h[?1h=[?1h=[?25l<span style="font-weight: bold"></span><span style="font-weight: bold; color: #F5F1DE"></span><span style="font-weight: bold; color: #F5F1DE; background-color: #aa0000">[ "tasks/" √© uma pasta ]</span><span style="font-weight: bold"></span><span style="background-color: #AAAAAA; color: #000000">  GNU nano 4.8                                                  Novo buffer                                                               </span>
<span style="background-color: #AAAAAA; color: #000000">^G</span> Ajuda<span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar<span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor    <span style="background-color: #AAAAAA; color: #000000">M-U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt
<span style="background-color: #AAAAAA; color: #000000">^X</span> Sair<span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer<span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?1049l
[?1l&gt;[?2004l]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ nano tasks/tasks.yml 
[?2004h[?1049h[?7h[?1h=[?1h=[?25l<span style="background-color: #AAAAAA; color: #000000">[ A ler... ]</span><span style="background-color: #AAAAAA; color: #000000">[ 167 linhas lidas ]</span><span style="background-color: #AAAAAA; color: #000000">  GNU nano 4.8                                                tasks/tasks.yml                                                             </span>
<span style="background-color: #AAAAAA; color: #000000">^G</span> Ajuda<span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar<span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor    <span style="background-color: #AAAAAA; color: #000000">M-U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt
<span style="background-color: #AAAAAA; color: #000000">^X</span> Sair<span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer<span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
---- name: Atualiza a cache (equivalente a apt update)apt:update_cache: truecache_valid_time: 3600- name: "Atualiza o sistema operativo"apt:upgrade: safe- name: "Instalar as dependencias necess√°ria ao programa leantime"apt:pkg:- mc- screen- git- apache2- mysql-server- php- php-mysql- php-ldap- php-cli- php-soap- php-json- graphviz- php-xml- php-gd- php-zip- libapache2-mod-php- php-dev- libmcrypt-dev- gcc- make- autoconf- libc-dev
[?12l[?25h[?25l - autoconf    - libc-dev  - pkg-config- pwgen- curl- unzip    - zip  - php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurl
<span style="color: #00aaaa">   # Fonte de inspira√ß√£o: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.html</span>- name: "Instala o servi√ßo apache2 no arranque do sistema"service:name: apache2state: startedenabled: true
<span style="color: #00aaaa">   # Fonte: https://www.mydailytutorials.com/using-ansible-find-module-search-filesfolder</span>- name: "Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurse: trueregister: caminho_php_ini
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.html</span>- name: "Ativa v√°rias op√ß√µes no ficheiro php.ini, utilizando o m√≥dulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"
[?12l[?25h[?25lregexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:regexp: "^file_uploads"  line: "file_uploads = 1"regexp: "^upload_max_filesize"  line: "upload_max_filesize = 1G"regexp: "^max_file_uploads"  line: "max_file_uploads = 20"regexp: "^post_max_size"  line: "post_max_size = 2G"regexp: "^memory_limit"  line: "memory_limit = 2G"- regexp: "^max_input_time" line: "max_input_time = 3600"
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/2.7/modules/file_module.html</span>- name: Cria a directoria tempor√°ria leantime e a directoria de apache leantimefile:path: "{{ item.path }}"state: directory mode: 0755    owner: www-data  group: www-datawith_items:- path: "/tmp/leantime"- path: "/var/www/leantime"
<span style="color: #00aaaa">   # Fonte: Ansible for DevOps - Server and configuration management for humans de Jeff Geerling, p√°gina 98
</span>   - name: "Cria a base de dados de mysql para o leantime"  mysql_db: "db=leantime_database state=present"
- name: "Cria o utilizador para a base de dados leantime"mysql_user:namlogin_leantime }}"
[?12l[?25h[?25lmysql_user:namlogin_leantime }}"  password: "{{ password_leantime }}"priv: "leantime_database.*:ALL"host: localhoststate: present
- name: "Faz o download do software leantime a partir do reposit√≥rio git"get_url:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipdest: /tmp/leantimemode: 0755
<span style="color: #00aaaa">   # O ficheiro Leantime-versao.zip necessita de ser descomprimido</span>- name: Descomprime o software leantimeunarchive: src: "/tmp/leantime/Leantime-{{ versao_leantime }}.zip"    dest: "/var/www/leantime"  owner: www-datagroup: www-datamode: 0755remote_src: true
<span style="color: #00aaaa">   # Ap√≥s a descompress√£o, se o ficheiro configuration.php n√£o existir, este necessita de ser
   # criado a partir do ficheiro configuration.sample.php
   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html</span>- name: Copia o ficheiro de configura√ß√£o configuration.sample.phpansible.builtin.copy: src: /var/www/leantime/config/configuration.sample.php    dest: /var/www/leantime/config/configuration.php  owner: www-datagroup: www-data    mode: '0755'  remote_src: trueforce: false
[?12l[?25h[?25l  remote_src: trueforce: false
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html</span>- name: Altera as vari√°veis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o m√≥dulo replace.ansible.builtin.replace:path: /var/www/leantime/config/configuration.php    regexp: "{{ item.regexp  }}"  replace: "{{ item.line }}"with_items:- regexp: 'dbUser=""'  line: 'dbUser="{{ login_leantime }}"'- regexp: 'dbDatabase=""' line: 'dbDatabase="leantime_database"'    - regexp: 'dbPassword=""'    line: 'dbPassword="{{ password_leantime }}"'
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html</span>- name: Copia o template do site para a p√°sta /etc/apache2/sites-availableansible.builtin.template:src: leantime.template.j2dest: /etc/apache2/sites-available/leantime.confowner: root group: www-data mode: 0755
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html</span>- name: "Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"ansible.builtin.file:src: /etc/apache2/sites-available/leantime.confdest: /etc/apache2/sites-enabled/leantime.confowner: rootgroup: rootmode: '0777'state: link
[?12l[?25h[?25lmode: '0777'state: link
[?12l[?25h[?25l78Mgroup: root
[?12l[?25h[?25l78Mowner: root
[?12l[?25h[?25l78Mdest: /etc/apache2/sites-enabled/leantime.conf
[?12l[?25h[?25l78Msrc: /etc/apache2/sites-available/leantime.conf
[?12l[?25h[?25l78Mansible.builtin.file:
[?12l[?25h[?25l78M- name: "Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"
[?12l[?25h[?25l78M<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html
</span>[?12l[?25h[?25l78M[?12l[?25h[?25l78Mmode: 0755
[?12l[?25h[?25l78Mgroup: www-data
[?12l[?25h[?25l78Mowner: root
[?12l[?25h[?25l78Mdest: /etc/apache2/sites-available/leantime.conf
[?12l[?25h[?25l78Msrc: leantime.template.j2
[?12l[?25h[?25l78Mansible.builtin.template:
[?12l[?25h[?25l78M- name: Copia o template do site para a p√°sta /etc/apache2/sites-available
[?12l[?25h[?25l78M<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html
</span>[?12l[?25h[?25l78M[?12l[?25h[?25l78Mline: 'dbPassword="{{ password_leantime }}"'
[?12l[?25h[?25l78M- regexp: 'dbPassword=""'
[?12l[?25h[?25l78Mline: 'dbDatabase="leantime_database"'
[?12l[?25h[?25l78M- regexp: 'dbDatabase=""'
[?12l[?25h[?25l78Mline: 'dbUser="{{ login_leantime }}"'
[?12l[?25h[?25l78M- regexp: 'dbUser=""'
[?12l[?25h[?25l78Mwith_items:
[?12l[?25h[?25l78Mreplace: "{{ item.line }}"
[?12l[?25h[?25l78Mregexp: "{{ item.regexp  }}"
[?12l[?25h[?25l78Mpath: /var/www/leantime/config/configuration.php
[?12l[?25h[?25l78Mansible.builtin.replace:
[?12l[?25h[?25l78M- name: Altera as vari√°veis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o m√≥dulo replace.
[?12l[?25h[?25l78M<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html
</span>[?12l[?25h[?25l78M[?12l[?25h[?25l78Mforce: false
[?12l[?25h[?25l78Mremote_src: true
[?12l[?25h[?25l78Mmode: '0755'
[?12l[?25h[?25l78Mgroup: www-data
[?12l[?25h[?25l78Mowner: www-data
[?12l[?25h[?25l78Mdest: /var/www/leantime/config/configuration.php
[?12l[?25h[?25l78Msrc: /var/www/leantime/config/configuration.sample.php
[?12l[?25h[?25l78Mansible.builtin.copy:
[?12l[?25h[?25l78M- name: Copia o ficheiro de configura√ß√£o configuration.sample.php
[?12l[?25h[?25l78M<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html
</span>[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l<span style="background-color: #AAAAAA; color: #000000">Modificado</span>
- name: "Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"
[?12l[?25h[?25l78Mforce: false
[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l78
- name: "Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"
[?12l[?25h[?25l78
ansible.builtin.file:
[?12l[?25h[?25l78
src: /etc/apache2/sites-available/leantime.conf
[?12l[?25h[?25l78
dest: /etc/apache2/sites-enabled/leantime.conf
[?12l[?25h[?25l78
owner: root
[?12l[?25h[?25l78
group: root
[?12l[?25h[?25l78
mode: '0777'
[?12l[?25h[?25l78
state: link
[?12l[?25h[?25l78
[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l78Mforce: false
[?12l[?25h[?25l         <span style="background-color: #AAAAAA; color: #000000">M-D</span> Formato DOS<span style="background-color: #AAAAAA; color: #000000">M-A</span> Anexar<span style="background-color: #AAAAAA; color: #000000">B</span> Seguran√ßa<span style="background-color: #AAAAAA; color: #000000">C</span> Cancelar           <span style="background-color: #AAAAAA; color: #000000">M-M</span> Formato Mac<span style="background-color: #AAAAAA; color: #000000">M-P</span> Prepor<span style="background-color: #AAAAAA; color: #000000">^T</span> P/ ficheiros
<span style="background-color: #AAAAAA; color: #000000">Nome do ficheiro onde escrever: tasks/tasks.yml                                                                                           </span>[?12l[?25h[?25l <span style="background-color: #AAAAAA; color: #000000">[ A escrever... ]</span><span style="background-color: #AAAAAA; color: #000000">          </span><span style="background-color: #AAAAAA; color: #000000">[ 168 linhas escritas ]</span><span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar      <span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor<span style="background-color: #AAAAAA; color: #000000">U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt<span style="background-color: #AAAAAA; color: #000000">X</span> Sair    <span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer      <span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
[?12l[?25h[?25l[?12l[?25h[?1049l
[?1l&gt;[?2004l]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ nano tasks/tasks.yml molecule idempotenceconverge
<span style="color: #0000aa">INFO    </span> default scenario test matrix: dependency, create, prepare, converge
<span style="color: #0000aa">INFO    </span> Performing prerun<span style="color: #aa5500">...</span>
<span style="color: #0000aa">INFO    </span> Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
<span style="color: #0000aa">INFO    </span> Added <span style="color: #aa5500">ANSIBLE_ROLES_PATH</span>=~<span style="color: #E850A8">/.ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/usr/share/ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/etc/ansible/</span><span style="color: #ff90e8">roles</span>:.<span style="color: #E850A8">/.cache/</span><span style="color: #ff90e8">roles</span>
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">dependency</span>
<span style="color: #aa0000">WARNING </span> Skipping, missing the requirements file.
<span style="color: #aa0000">WARNING </span> Skipping, missing the requirements file.
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">create</span>
<span style="color: #aa0000">WARNING </span> Skipping, instances already created.
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">prepare</span>
<span style="color: #aa0000">WARNING </span> Skipping, instances already prepared.
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">converge</span>

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instalar as dependencias necess√°ria ao programa leantime] *******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instala o servi√ßo apache2 no arranque do sistema] ***************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Ativa v√°rias op√ß√µes no ficheiro php.ini, utilizando o m√≥dulo lineinfile.] ***************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})</span>

TASK [leantime_ansible : Cria a directoria tempor√°ria leantime e a directoria de apache leantime] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/tmp/leantime'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/var/www/leantime'})</span>

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
<span style="font-weight: bold; color: #E850A8">[WARNING]: Module did not set no_log for update_password</span>
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Faz o download do software leantime a partir do reposit√≥rio git] ************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Copia o ficheiro de configura√ß√£o configuration.sample.php] ******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Altera as vari√°veis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o m√≥dulo replace.] ***
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})</span>

TASK [leantime_ansible : Copia o template do site para a p√°sta /etc/apache2/sites-available] *********************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

PLAY RECAP *******************************************************************************************************************************
<span style="color: #00aa00">ubuntu-20.04</span>               : <span style="color: #00aa00">ok=16  </span> changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ molecule convergeidempotence
<span style="color: #0000aa">INFO    </span> default scenario test matrix: idempotence
<span style="color: #0000aa">INFO    </span> Performing prerun<span style="color: #aa5500">...</span>
<span style="color: #0000aa">INFO    </span> Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
<span style="color: #0000aa">INFO    </span> Added <span style="color: #aa5500">ANSIBLE_ROLES_PATH</span>=~<span style="color: #E850A8">/.ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/usr/share/ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/etc/ansible/</span><span style="color: #ff90e8">roles</span>:.<span style="color: #E850A8">/.cache/</span><span style="color: #ff90e8">roles</span>
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">idempotence</span>

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instalar as dependencias necess√°ria ao programa leantime] *******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instala o servi√ßo apache2 no arranque do sistema] ***************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Ativa v√°rias op√ß√µes no ficheiro php.ini, utilizando o m√≥dulo lineinfile.] ***************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})</span>

TASK [leantime_ansible : Cria a directoria tempor√°ria leantime e a directoria de apache leantime] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/tmp/leantime'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/var/www/leantime'})</span>

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
<span style="font-weight: bold; color: #E850A8">[WARNING]: Module did not set no_log for update_password</span>
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Faz o download do software leantime a partir do reposit√≥rio git] ************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Copia o ficheiro de configura√ß√£o configuration.sample.php] ******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Altera as vari√°veis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o m√≥dulo replace.] ***
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})</span>

TASK [leantime_ansible : Copia o template do site para a p√°sta /etc/apache2/sites-available] *********************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

PLAY RECAP *******************************************************************************************************************************
<span style="color: #00aa00">ubuntu-20.04</span>               : <span style="color: #00aa00">ok=16  </span> changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


<span style="color: #0000aa">INFO    </span> Idempotence completed successfully.
]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ molecule verify
<span style="color: #0000aa">INFO    </span> default scenario test matrix: verify
<span style="color: #0000aa">INFO    </span> Performing prerun<span style="color: #aa5500">...</span>
<span style="color: #0000aa">INFO    </span> Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
<span style="color: #0000aa">INFO    </span> Added <span style="color: #aa5500">ANSIBLE_ROLES_PATH</span>=~<span style="color: #E850A8">/.ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/usr/share/ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/etc/ansible/</span><span style="color: #ff90e8">roles</span>:.<span style="color: #E850A8">/.cache/</span><span style="color: #ff90e8">roles</span>
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">verify</span>
<span style="color: #0000aa">INFO    </span> Running Ansible Verifier

PLAY [Infraestrutura conduzida por testes] ***********************************************************************************************

TASK [Vari√°veis] *************************************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Simula√ß√£o: Atualizar a cache do sistema] *******************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [teste: a cache encontra-se actualizada?] *******************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: A cache est√° atualizada"</span>
<span style="color: #00aa00">}</span>

TASK [Atualizar o sistema operativo (equivalente a apt upgrade)] *************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [teste: o sistema operativo encontra-se atualizado?] ********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O sistema operativo est√° atualizado"</span>
<span style="color: #00aa00">}</span>

TASK [Teste: a cache encontra-se atualizada?] ********************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: A cache est√° atualizada"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: testa se as aplica√ß√µes dependencia do software leantime se encontram instaladas] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: as dependencias encontra-se instaladas?] ************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: As dependencias estavam instaladas"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Testar se o servi√ßo apache2 se encontra instalado, iniciado e ativo no arranque] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O servi√ßo apache2 encontra-se ativo no arranque no sistema, e est√° iniciado?] ***********************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O servi√ßo apache2 est√° correctamente instalado e inicia com o arranque do sistema"</span>
<span style="color: #00aa00">}</span>

TASK [Rotina Auxiliar&gt; Procura o caminho do ficheiro php.ini do servidor apache2] ********************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Simula√ß√£o: Ativa a op√ß√£o file_uploads no ficheiro php.ini, utilizando o m√≥dulo lineinfile.] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})</span>

TASK [Teste: As linhas do php.ini encontram-se alteradas ?] ******************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O ficheiro php.ini foi alterado com sucesso"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Obtem informa√ß√£o sobre a pastas /var/www/leantime] **********************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: A pasta /var/www/leantime existe e tem as permiss√µes certas?] ***************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: Permiss√µes correctas no site leantime"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Verifica se √© necess√°rio criar a base de dados leantime_database] *******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: A base de dados leantime_database existe ?] *********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: A base de dados leantime_database j√° se encontra criada"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o e Teste: Verifica se o endere√ßo git para a vers√£o de leantime existe] ****************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /var/www/leantime/config/configuration.php] *******************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O ficheiro /var/www/leantime/config/configuration.php existe e tem as permiss√µes certas?] ***********************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: Permiss√µes correctas e ficheiro configuration.php existente"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace.] ******************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O dbUser foi alterado?] *****************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace.] **************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: a vari√°vel dbDatabase foi alterada?] ****************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace.] **************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O dbPassword foi alterado?] *************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /etc/apache2/sites-available/leantime.conf] *******************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permiss√µes certas?] ***********************************
<span style="color: #aa0000">fatal: [ubuntu-20.04]: FAILED! =&gt; {</span>
<span style="color: #aa0000">    "assertion": "ficheiro.stat.mode == \"0755\"",</span>
<span style="color: #aa0000">    "changed": false,</span>
<span style="color: #aa0000">    "evaluated_to": false,</span>
<span style="color: #aa0000">    "msg": "ERRO: Permiss√µes incorrectas"</span>
<span style="color: #aa0000">}</span>

PLAY RECAP *******************************************************************************************************************************
<span style="color: #aa0000">ubuntu-20.04</span>               : <span style="color: #00aa00">ok=27  </span> changed=0    unreachable=0    <span style="color: #aa0000">failed=1   </span> skipped=0    rescued=0    ignored=0


<span style="font-weight: bold; color: #aa0000">CRITICAL</span> Ansible return code was <span style="font-weight: bold; color: #00aaaa">2</span>, command was: ansible-playbook --inventory <span style="color: #E850A8">/home/admlocal/.cache/molecule/leantime_ansible/default/</span><span style="color: #ff90e8">inventory</span> --skip-tags molecule-notest,notest <span style="color: #E850A8">/home/admlocal/leantime_ansible/molecule/default/</span><span style="color: #ff90e8">verify.yml</span>
]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ molecule verifyidempotenceconvergenano tasks/tasks.yml 
[?2004h[?1049h[?7h[?1h=[?1h=[?25l<span style="background-color: #AAAAAA; color: #000000">[ A ler... ]</span><span style="background-color: #AAAAAA; color: #000000">[ 168 linhas lidas ]</span><span style="background-color: #AAAAAA; color: #000000">  GNU nano 4.8                                                tasks/tasks.yml                                                             </span>
<span style="background-color: #AAAAAA; color: #000000">^G</span> Ajuda<span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar<span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor    <span style="background-color: #AAAAAA; color: #000000">M-U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt
<span style="background-color: #AAAAAA; color: #000000">^X</span> Sair<span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer<span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
---- name: Atualiza a cache (equivalente a apt update)apt:update_cache: truecache_valid_time: 3600- name: "Atualiza o sistema operativo"apt:upgrade: safe- name: "Instalar as dependencias necess√°ria ao programa leantime"apt:pkg:- mc- screen- git- apache2- mysql-server- php- php-mysql- php-ldap- php-cli- php-soap- php-json- graphviz- php-xml- php-gd- php-zip- libapache2-mod-php- php-dev- libmcrypt-dev- gcc- make- autoconf- libc-dev
[?12l[?25h[?25l - autoconf    - libc-dev  - pkg-config- pwgen- curl- unzip    - zip  - php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurl
<span style="color: #00aaaa">   # Fonte de inspira√ß√£o: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.html</span>- name: "Instala o servi√ßo apache2 no arranque do sistema"service:name: apache2state: startedenabled: true
<span style="color: #00aaaa">   # Fonte: https://www.mydailytutorials.com/using-ansible-find-module-search-filesfolder</span>- name: "Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurse: trueregister: caminho_php_ini
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.html</span>- name: "Ativa v√°rias op√ß√µes no ficheiro php.ini, utilizando o m√≥dulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"
[?12l[?25h[?25lregexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:regexp: "^file_uploads"  line: "file_uploads = 1"regexp: "^upload_max_filesize"  line: "upload_max_filesize = 1G"regexp: "^max_file_uploads"  line: "max_file_uploads = 20"regexp: "^post_max_size"  line: "post_max_size = 2G"regexp: "^memory_limit"  line: "memory_limit = 2G"- regexp: "^max_input_time" line: "max_input_time = 3600"
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/2.7/modules/file_module.html</span>- name: Cria a directoria tempor√°ria leantime e a directoria de apache leantimefile:path: "{{ item.path }}"state: directory mode: 0755    owner: www-data  group: www-datawith_items:- path: "/tmp/leantime"- path: "/var/www/leantime"
<span style="color: #00aaaa">   # Fonte: Ansible for DevOps - Server and configuration management for humans de Jeff Geerling, p√°gina 98
</span>   - name: "Cria a base de dados de mysql para o leantime"  mysql_db: "db=leantime_database state=present"
- name: "Cria o utilizador para a base de dados leantime"mysql_user:namlogin_leantime }}"
[?12l[?25h[?25lmysql_user:namlogin_leantime }}"  password: "{{ password_leantime }}"priv: "leantime_database.*:ALL"host: localhoststate: present
- name: "Faz o download do software leantime a partir do reposit√≥rio git"get_url:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipdest: /tmp/leantimemode: 0755
<span style="color: #00aaaa">   # O ficheiro Leantime-versao.zip necessita de ser descomprimido</span>- name: Descomprime o software leantimeunarchive: src: "/tmp/leantime/Leantime-{{ versao_leantime }}.zip"    dest: "/var/www/leantime"  owner: www-datagroup: www-datamode: 0755remote_src: true
<span style="color: #00aaaa">   # Ap√≥s a descompress√£o, se o ficheiro configuration.php n√£o existir, este necessita de ser
   # criado a partir do ficheiro configuration.sample.php
   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html</span>- name: Copia o ficheiro de configura√ß√£o configuration.sample.phpansible.builtin.copy: src: /var/www/leantime/config/configuration.sample.php    dest: /var/www/leantime/config/configuration.php  owner: www-datagroup: www-data    mode: '0755'  remote_src: trueforce: false
[?12l[?25h[?25l  remote_src: trueforce: false
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html</span>- name: Altera as vari√°veis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o m√≥dulo replace.ansible.builtin.replace:path: /var/www/leantime/config/configuration.php    regexp: "{{ item.regexp  }}"  replace: "{{ item.line }}"with_items:- regexp: 'dbUser=""'  line: 'dbUser="{{ login_leantime }}"'- regexp: 'dbDatabase=""' line: 'dbDatabase="leantime_database"'    - regexp: 'dbPassword=""'    line: 'dbPassword="{{ password_leantime }}"'
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html</span>- name: Copia o template do site para a p√°sta /etc/apache2/sites-availableansible.builtin.template:src: leantime.template.j2dest: /etc/apache2/sites-available/leantime.confowner: root group: www-data mode: 0755 force: false
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html</span>- name: "Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"ansible.builtin.file:src: /etc/apache2/sites-available/leantime.confdest: /etc/apache2/sites-enabled/leantime.confowner: rootgroup: rootmode: '0777'
[?12l[?25h[?25lgroup: rootmode: '0777'state: link
[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l<span style="background-color: #AAAAAA; color: #000000">Modificado</span>'[?12l[?25h[?25l'[?12l[?25h[?25l5'[?12l[?25h[?25l55'[?12l[?25h[?25l[?12l[?25h[?25l         <span style="background-color: #AAAAAA; color: #000000">M-D</span> Formato DOS<span style="background-color: #AAAAAA; color: #000000">M-A</span> Anexar<span style="background-color: #AAAAAA; color: #000000">B</span> Seguran√ßa<span style="background-color: #AAAAAA; color: #000000">C</span> Cancelar           <span style="background-color: #AAAAAA; color: #000000">M-M</span> Formato Mac<span style="background-color: #AAAAAA; color: #000000">M-P</span> Prepor<span style="background-color: #AAAAAA; color: #000000">^T</span> P/ ficheiros
<span style="background-color: #AAAAAA; color: #000000">Nome do ficheiro onde escrever: tasks/tasks.yml                                                                                           </span>[?12l[?25h[?25l <span style="background-color: #AAAAAA; color: #000000">[ A escrever... ]</span><span style="background-color: #AAAAAA; color: #000000">          </span><span style="background-color: #AAAAAA; color: #000000">[ 168 linhas escritas ]</span><span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar      <span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor<span style="background-color: #AAAAAA; color: #000000">U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt<span style="background-color: #AAAAAA; color: #000000">X</span> Sair    <span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer      <span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
[?12l[?25h[?25l
[?12l[?25h[?1049l
[?1l&gt;[?2004l]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ nano tasks/tasks.yml molecule verifyidempotenceconverge
<span style="color: #0000aa">INFO    </span> default scenario test matrix: dependency, create, prepare, converge
<span style="color: #0000aa">INFO    </span> Performing prerun<span style="color: #aa5500">...</span>
<span style="color: #0000aa">INFO    </span> Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
<span style="color: #0000aa">INFO    </span> Added <span style="color: #aa5500">ANSIBLE_ROLES_PATH</span>=~<span style="color: #E850A8">/.ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/usr/share/ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/etc/ansible/</span><span style="color: #ff90e8">roles</span>:.<span style="color: #E850A8">/.cache/</span><span style="color: #ff90e8">roles</span>
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">dependency</span>
<span style="color: #aa0000">WARNING </span> Skipping, missing the requirements file.
<span style="color: #aa0000">WARNING </span> Skipping, missing the requirements file.
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">create</span>
<span style="color: #aa0000">WARNING </span> Skipping, instances already created.
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">prepare</span>
<span style="color: #aa0000">WARNING </span> Skipping, instances already prepared.
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">converge</span>

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instalar as dependencias necess√°ria ao programa leantime] *******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instala o servi√ßo apache2 no arranque do sistema] ***************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Ativa v√°rias op√ß√µes no ficheiro php.ini, utilizando o m√≥dulo lineinfile.] ***************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})</span>

TASK [leantime_ansible : Cria a directoria tempor√°ria leantime e a directoria de apache leantime] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/tmp/leantime'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/var/www/leantime'})</span>

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
<span style="font-weight: bold; color: #E850A8">[WARNING]: Module did not set no_log for update_password</span>
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Faz o download do software leantime a partir do reposit√≥rio git] ************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Copia o ficheiro de configura√ß√£o configuration.sample.php] ******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Altera as vari√°veis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o m√≥dulo replace.] ***
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})</span>

TASK [leantime_ansible : Copia o template do site para a p√°sta /etc/apache2/sites-available] *********************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
<span style="color: #aa5500">changed: [ubuntu-20.04]</span>

PLAY RECAP *******************************************************************************************************************************
<span style="color: #aa5500">ubuntu-20.04</span>               : <span style="color: #00aa00">ok=16  </span> <span style="color: #aa5500">changed=1   </span> unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ molecule convergeidempotenece
Usage: molecule [OPTIONS] COMMAND [ARGS]...
Try "molecule --help" for help.

Error: No such command "idempotece".
]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ molecule idempotecence
<span style="color: #0000aa">INFO    </span> default scenario test matrix: idempotence
<span style="color: #0000aa">INFO    </span> Performing prerun<span style="color: #aa5500">...</span>
<span style="color: #0000aa">INFO    </span> Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
<span style="color: #0000aa">INFO    </span> Added <span style="color: #aa5500">ANSIBLE_ROLES_PATH</span>=~<span style="color: #E850A8">/.ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/usr/share/ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/etc/ansible/</span><span style="color: #ff90e8">roles</span>:.<span style="color: #E850A8">/.cache/</span><span style="color: #ff90e8">roles</span>
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">idempotence</span>

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instalar as dependencias necess√°ria ao programa leantime] *******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instala o servi√ßo apache2 no arranque do sistema] ***************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Ativa v√°rias op√ß√µes no ficheiro php.ini, utilizando o m√≥dulo lineinfile.] ***************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})</span>

TASK [leantime_ansible : Cria a directoria tempor√°ria leantime e a directoria de apache leantime] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/tmp/leantime'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/var/www/leantime'})</span>

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
<span style="font-weight: bold; color: #E850A8">[WARNING]: Module did not set no_log for update_password</span>
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Faz o download do software leantime a partir do reposit√≥rio git] ************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Copia o ficheiro de configura√ß√£o configuration.sample.php] ******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Altera as vari√°veis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o m√≥dulo replace.] ***
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})</span>

TASK [leantime_ansible : Copia o template do site para a p√°sta /etc/apache2/sites-available] *********************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

PLAY RECAP *******************************************************************************************************************************
<span style="color: #00aa00">ubuntu-20.04</span>               : <span style="color: #00aa00">ok=16  </span> changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


<span style="color: #0000aa">INFO    </span> Idempotence completed successfully.
]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ molecule idempotenceverify
<span style="color: #0000aa">INFO    </span> default scenario test matrix: verify
<span style="color: #0000aa">INFO    </span> Performing prerun<span style="color: #aa5500">...</span>
<span style="color: #0000aa">INFO    </span> Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
<span style="color: #0000aa">INFO    </span> Added <span style="color: #aa5500">ANSIBLE_ROLES_PATH</span>=~<span style="color: #E850A8">/.ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/usr/share/ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/etc/ansible/</span><span style="color: #ff90e8">roles</span>:.<span style="color: #E850A8">/.cache/</span><span style="color: #ff90e8">roles</span>
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">verify</span>
<span style="color: #0000aa">INFO    </span> Running Ansible Verifier

PLAY [Infraestrutura conduzida por testes] ***********************************************************************************************

TASK [Vari√°veis] *************************************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Simula√ß√£o: Atualizar a cache do sistema] *******************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [teste: a cache encontra-se actualizada?] *******************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: A cache est√° atualizada"</span>
<span style="color: #00aa00">}</span>

TASK [Atualizar o sistema operativo (equivalente a apt upgrade)] *************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [teste: o sistema operativo encontra-se atualizado?] ********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O sistema operativo est√° atualizado"</span>
<span style="color: #00aa00">}</span>

TASK [Teste: a cache encontra-se atualizada?] ********************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: A cache est√° atualizada"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: testa se as aplica√ß√µes dependencia do software leantime se encontram instaladas] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: as dependencias encontra-se instaladas?] ************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: As dependencias estavam instaladas"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Testar se o servi√ßo apache2 se encontra instalado, iniciado e ativo no arranque] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O servi√ßo apache2 encontra-se ativo no arranque no sistema, e est√° iniciado?] ***********************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O servi√ßo apache2 est√° correctamente instalado e inicia com o arranque do sistema"</span>
<span style="color: #00aa00">}</span>

TASK [Rotina Auxiliar&gt; Procura o caminho do ficheiro php.ini do servidor apache2] ********************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Simula√ß√£o: Ativa a op√ß√£o file_uploads no ficheiro php.ini, utilizando o m√≥dulo lineinfile.] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})</span>

TASK [Teste: As linhas do php.ini encontram-se alteradas ?] ******************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O ficheiro php.ini foi alterado com sucesso"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Obtem informa√ß√£o sobre a pastas /var/www/leantime] **********************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: A pasta /var/www/leantime existe e tem as permiss√µes certas?] ***************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: Permiss√µes correctas no site leantime"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Verifica se √© necess√°rio criar a base de dados leantime_database] *******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: A base de dados leantime_database existe ?] *********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: A base de dados leantime_database j√° se encontra criada"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o e Teste: Verifica se o endere√ßo git para a vers√£o de leantime existe] ****************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /var/www/leantime/config/configuration.php] *******************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O ficheiro /var/www/leantime/config/configuration.php existe e tem as permiss√µes certas?] ***********************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: Permiss√µes correctas e ficheiro configuration.php existente"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace.] ******************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O dbUser foi alterado?] *****************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace.] **************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: a vari√°vel dbDatabase foi alterada?] ****************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace.] **************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O dbPassword foi alterado?] *************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /etc/apache2/sites-available/leantime.conf] *******************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permiss√µes certas?] ***********************************
<span style="color: #aa0000">fatal: [ubuntu-20.04]: FAILED! =&gt; {</span>
<span style="color: #aa0000">    "assertion": "ficheiro.stat.gr_name == \"www-data\"",</span>
<span style="color: #aa0000">    "changed": false,</span>
<span style="color: #aa0000">    "evaluated_to": false,</span>
<span style="color: #aa0000">    "msg": "ERRO: Permiss√µes incorrectas"</span>
<span style="color: #aa0000">}</span>

PLAY RECAP *******************************************************************************************************************************
<span style="color: #aa0000">ubuntu-20.04</span>               : <span style="color: #00aa00">ok=27  </span> changed=0    unreachable=0    <span style="color: #aa0000">failed=1   </span> skipped=0    rescued=0    ignored=0


<span style="font-weight: bold; color: #aa0000">CRITICAL</span> Ansible return code was <span style="font-weight: bold; color: #00aaaa">2</span>, command was: ansible-playbook --inventory <span style="color: #E850A8">/home/admlocal/.cache/molecule/leantime_ansible/default/</span><span style="color: #ff90e8">inventory</span> --skip-tags molecule-notest,notest <span style="color: #E850A8">/home/admlocal/leantime_ansible/molecule/default/</span><span style="color: #ff90e8">verify.yml</span>
]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ nano molecule/default/verify.yml 
[?2004h[?1049h[?7h[?1h=[?1h=[?25l<span style="background-color: #AAAAAA; color: #000000">[ A ler... ]</span><span style="background-color: #AAAAAA; color: #000000">[ 302 linhas lidas ]</span><span style="background-color: #AAAAAA; color: #000000">  GNU nano 4.8                                          molecule/default/verify.yml                                                       </span>
<span style="background-color: #AAAAAA; color: #000000">^G</span> Ajuda<span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar<span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor    <span style="background-color: #AAAAAA; color: #000000">M-U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt
<span style="background-color: #AAAAAA; color: #000000">^X</span> Sair<span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer<span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
---
<span style="color: #00aaaa"># Tutorial de inspira√ß√£o para a infraestrutura conduzida por teste no site
# https://www.adictosaltrabajo.com/2020/05/08/ansible-testing-using-molecule-with-ansible-as-verifier/
</span>- name: "Infraestrutura conduzida por testes"hosts: allgather_facts: falsebecome: truetasks:- name: Vari√°veisinclude_vars:file: ../../vars/main.yml- name: "Simula√ß√£o: Atualizar a cache do sistema"apt:update_cache: truecache_valid_time: 3600check_mode: trueregister: estado- name: "teste: a cache encontra-se actualizada?"assert:that:- not estado.changedsuccess_msg: "SUCESSO: A cache est√° atualizada"fail_msg: "ERRO: Existem actualiza√ß√µes pendentes"- name: "Atualizar o sistema operativo (equivalente a apt upgrade)"apt:upgrade: safecheck_mode: trueregister: estado- name: "teste: o sistema operativo encontra-se atualizado?"
[?12l[?25h[?25l  - name: "teste: o sistema operativo encontra-se atualizado?"
    assert:that: - not estado.changed    success_msg: "SUCESSO: O sistema operativo est√° atualizado"    fail_msg: "ERRO: Existem actualiza√ß√µes pendentes"
  - name: "Teste: a cache encontra-se atualizada?"  assert:    that:  - not estado.changedsuccess_msg: "SUCESSO: A cache est√° atualizada"fail_msg: "ERRO: Existem atualiza√ß√µes pendentes"
  - name: "Simula√ß√£o: testa se as aplica√ß√µes dependencia do software leantime se encontram instaladas"apt:pkg:  - mc  - screen- git    - apache2  - mysql-server- phpphp-mysql- php-ldap- php-cli- php-soap    - php-json  - graphviz- php-xml  - php-gd  - php-zip- libapache2-mod-php    - php-dev
[?12l[?25h[?25l- libapache2-mod-php    - php-dev  - libmcrypt-dev- gccmake- autoconf- libc-dev- pkg-config    - pwgen  - curl- unzipzip- php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurlcheck_mode: trueregister: estado
  - name: "Teste: as dependencias encontra-se instaladas?"assert:that:not estado.changedsuccess_msg: "SUCESSO: As dependencias estavam instaladas"fail_msg: "ERRO: Faltam instalar algumas dependencias. O software pode estar parcialmente instalado"
<span style="color: #00aaaa">  # Fonte de inspira√ß√£o: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.html</span>- name: "Simula√ß√£o: Testar se o servi√ßo apache2 se encontra instalado, iniciado e ativo no arranque"service:name: apache2state: startedenabled: truecheck_mode: true
[?12l[?25h[?25lenabled: trueO servi√ßo apache2 encontra-se ativo no arranque no sistema, e est√° iniciado?"O servi√ßo apache2 est√° correctamente instalado e inicia com o arranque do sistema"O servi√ßo apache2 n√£o se encontra correcta<span style="color: #00aaaa">: https://www.mydailytutorials.com/using--find-module-search-filesfolder</span>Rotina Auxiliar&gt; Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurseregister: caminho_php_ini
<span style="color: #00aaaa">  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.html</span>- name: "Simula√ß√£o: Ativa a op√ß√£o file_uploads no ficheiro php.ini, utilizando o m√≥dulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:- regexp: "^file_uploads"line: "file_uploads = 1"- regexp: "^upload_max_filesize"line: "upload_max_filesize = 1G"- regexp: "^max_file_uploads"line: "max_file_uploads = 20"- regexp: "^post_max_size"line: "post_max_size = 2G"- regexp: "^memory_limit"
[?12l[?25h[?25l78line: "post_max_size = 2G"- regexp: "^memory_limit"line: "memory_limit = 2G"- regexp: "^max_input_time"  line: "max_input_time = 3600"As linhas do php.ini encontram-se alteradas ?"ficheiro php.ini foi alterado com sucesso"Algumas altera√ß√µes ao ficheiro php.ini n√£o tiveram sucesso"<span style="color: #00aaaa">O site deve existir na pasta /var/www/leantime. Este teste visa determinar se a pasta
  # existe e se temas permiss√µes certas
  # Fonte de inspira√ß√£o: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html</span>- name: "Simula√ß√£o: Obtem informa√ß√£o sobre a pastas /var/www/leantime"
    stat:    path: "/var/www/leantime"register: pasta
  - name: "Teste: A pasta /var/www/leantime existe e tem as permiss√µes certas?"assert:  that:  - pasta.stat.exists- pasta.stat.isdir  - pasta.stat.mode == "0755"- pasta.stat.pw_name == "www-data"  - pasta.stat.gr_name == "www-data"success_msg: "SUCESSO: Permiss√µes correctas no site leantime"fail_msg: "ERRO: Permiss√µes incorrectas no site leantime ou site n√£o existente"
<span style="color: #00aaaa">  # Outro dos requesitos √© a exist√™ncia de uma base de dados para o site.
</span>[?12l[?25h[?25l<span style="color: #00aaaa">  # Outro dos requesitos √© a exist√™ncia de uma base de dados para o site.
  # Esta base de dados deve ser criada, logo tem de ser testada para determinar se ela existe ou n√£o.
  # Fonte de inspira√ß√£o: https://serverfault.com/questions/173978/from-a-shell-script-how-can-i-check-whether-a-mysql-database-exists</span>- name: "Simula√ß√£o: Verifica se √© necess√°rio criar a base de dados leantime_database"shell: "mysql -u root -e 'use leantime_database'"resultfailed_when: false  changed_when: false
  - name: "Teste: A base de dados leantime_database existe ?"assert:that:- result.rc == 0success_msg: "SUCESSO: A base de dados leantime_database j√° se encontra criada"fail_msg: "ERRO: N√£o existe a base de dados leantime_database"
<span style="color: #00aaaa">  # Teste: O download do software leantime deve ser poss√≠vel, a partir do site do leantime</span>- name: "Simula√ß√£o e Teste: Verifica se o endere√ßo git para a vers√£o de leantime existe"uri:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipregister: resultado<span style="color: #00aaaa">Teste: Do ficheiro configuration.php no site do leantime. A exist√™ncia deste ficheiro       com as permiss√µes certas indica que o processo de unzip correu bemDocumenta√ß√£o oficial em: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html</span>o ficheiro /var/www/leantime/config/configuration.php"/config/configuration.php"ficheiroO ficheiro /var/www/leantime/config/configuration.php existe e tem as permiss√µes certas?"ficheiro.stat.exists
[?12l[?25h[?25lthat: - ficheiro.stat.exists - ficheiro.stat.isreg - ficheiro.stat.mode == "0755" - ficheiro.stat.pw_name == "www-data"    - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permiss√µes correctas e ficheiro configuration.php existente"  fail_msg: "ERRO: Permiss√µes incorrectas ou ficheiro configuration.php n√£o existente"
<span style="color: #00aaaa">  # Teste: O ficheiro /var/www/leantime/config/configuration.php necessita de ser alterado.
  # As vari√°veis dbuser, dbDatabase, e dbPassword necessitam de estar configuradas.
  # Por simula√ß√£o o sistema vai determinar se estas est√£o configuradas com o valor esperado.
  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html</span>- name: "Simula√ß√£o: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbUser=""' replace: 'dbUser="{{ login_leantime }}"'  check_mode: yesregister: conffailed_when: false
  - name: "Teste: O dbUser foi alterado?"
    assert: that: - conf is not changed    - conf is not failed  success_msg: "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"fail_msg: "ERRO: O dbUser n√£o foi alterado no ficheiro configuration.php"
<span style="color: #00aaaa">  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html</span>- name: "Simula√ß√£o: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.php
[?12l[?25h[?25l    ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbDatabase=""'replace: 'dbDatabase="leantime_database"'check_mode: yesregister: conffailed_when: false
  - name: "Teste: a vari√°vel dbDatabase foi alterada?"
    assert: that: - conf is not changed - conf is not failed    success_msg: "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"  fail_msg: "ERRO: O dbDatabase n√£o foi alterado no ficheiro configuration.php"
<span style="color: #00aaaa">  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html</span>- name: "Simula√ß√£o: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace."ansible.builtin.replace:  path: /var/www/leantime/config/configuration.php  regexp: 'dbPassword=""'replace: 'dbPassword="{{ password_leantime }}"'  check_mode: yesregister: conffailed_when: false
  - name: "Teste: O dbPassword foi alterado?"assert:that:- conf is not changed- conf is not failed success_msg: "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"    fail_msg: "ERRO: O dbPassword n√£o foi alterado no ficheiro configuration.php"
<span style="color: #00aaaa">  # A configura√ß√£o do site leantime necessita que seja criado um site atrav√©s de um ficheiro de
</span>[?12l[?25h[?25l<span style="color: #00aaaa">  # A configura√ß√£o do site leantime necessita que seja criado um site atrav√©s de um ficheiro de
  # configura√ß√£o, dentro das pasta do apache2. Deve existir um ficheiro de configura√ß√£o do
  # leantime em (/etc/apache2/sites-available</span>
<span style="color: #00aaaa">  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html</span>- name: "Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /etc/apache2/sites-available/leantime.conf"stat:path: "/etc/apache2/sites-available/leantime.conf"  register: ficheiro
  - name: "Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permiss√µes certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.isreg- ficheiro.stat.mode == "0755" - ficheiro.stat.pw_name == "root" - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permiss√µes correctas"fail_msg: "ERRO: Permiss√µes incorrectas"
<span style="color: #00aaaa">  # O site deve estar ativo no apache. Este teste vai verificar se o site se encontra ativo
  # https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html</span>- name: "Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf"stat:path: "/etc/apache2/sites-enabled/leantime.conf"  register: ficheiro
  - name: "Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permiss√µes certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.islnk- ficheiro.stat.mode == "0777" - ficheiro.stat.pw_name == "root"
[?12l[?25h[?25l77root"
[?12l[?25h[?25l78M- ficheiro.stat.islnk
[?12l[?25h[?25l78M- ficheiro.stat.exists
[?12l[?25h[?25l78Mthat:
[?12l[?25h[?25l78Massert:
[?12l[?25h[?25l78M- name: "Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permiss√µes certas?"
[?12l[?25h[?25l78M[?12l[?25h[?25l[?12l[?25h[?1049l
[?1l&gt;[?2004l]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ nano molecule/default/verify.yml 
[?2004h[?1049h[?7h[?1h=[?1h=[?25l<span style="background-color: #AAAAAA; color: #000000">[ A ler... ]</span><span style="background-color: #AAAAAA; color: #000000">[ 302 linhas lidas ]</span><span style="background-color: #AAAAAA; color: #000000">  GNU nano 4.8                                          molecule/default/verify.yml                                                       </span>
<span style="background-color: #AAAAAA; color: #000000">^G</span> Ajuda<span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar<span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor    <span style="background-color: #AAAAAA; color: #000000">M-U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt
<span style="background-color: #AAAAAA; color: #000000">^X</span> Sair<span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer<span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
---
<span style="color: #00aaaa"># Tutorial de inspira√ß√£o para a infraestrutura conduzida por teste no site
# https://www.adictosaltrabajo.com/2020/05/08/ansible-testing-using-molecule-with-ansible-as-verifier/
</span>- name: "Infraestrutura conduzida por testes"hosts: allgather_facts: falsebecome: truetasks:- name: Vari√°veisinclude_vars:file: ../../vars/main.yml- name: "Simula√ß√£o: Atualizar a cache do sistema"apt:update_cache: truecache_valid_time: 3600check_mode: trueregister: estado- name: "teste: a cache encontra-se actualizada?"assert:that:- not estado.changedsuccess_msg: "SUCESSO: A cache est√° atualizada"fail_msg: "ERRO: Existem actualiza√ß√µes pendentes"- name: "Atualizar o sistema operativo (equivalente a apt upgrade)"apt:upgrade: safecheck_mode: trueregister: estado- name: "teste: o sistema operativo encontra-se atualizado?"
[?12l[?25h[?25l  - name: "teste: o sistema operativo encontra-se atualizado?"
    assert:that: - not estado.changed    success_msg: "SUCESSO: O sistema operativo est√° atualizado"    fail_msg: "ERRO: Existem actualiza√ß√µes pendentes"
  - name: "Teste: a cache encontra-se atualizada?"  assert:    that:  - not estado.changedsuccess_msg: "SUCESSO: A cache est√° atualizada"fail_msg: "ERRO: Existem atualiza√ß√µes pendentes"
  - name: "Simula√ß√£o: testa se as aplica√ß√µes dependencia do software leantime se encontram instaladas"apt:pkg:  - mc  - screen- git    - apache2  - mysql-server- phpphp-mysql- php-ldap- php-cli- php-soap    - php-json  - graphviz- php-xml  - php-gd  - php-zip- libapache2-mod-php    - php-dev
[?12l[?25h[?25l- libapache2-mod-php    - php-dev  - libmcrypt-dev- gccmake- autoconf- libc-dev- pkg-config    - pwgen  - curl- unzipzip- php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurlcheck_mode: trueregister: estado
  - name: "Teste: as dependencias encontra-se instaladas?"assert:that:not estado.changedsuccess_msg: "SUCESSO: As dependencias estavam instaladas"fail_msg: "ERRO: Faltam instalar algumas dependencias. O software pode estar parcialmente instalado"
<span style="color: #00aaaa">  # Fonte de inspira√ß√£o: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.html</span>- name: "Simula√ß√£o: Testar se o servi√ßo apache2 se encontra instalado, iniciado e ativo no arranque"service:name: apache2state: startedenabled: truecheck_mode: true
[?12l[?25h[?25lenabled: trueO servi√ßo apache2 encontra-se ativo no arranque no sistema, e est√° iniciado?"O servi√ßo apache2 est√° correctamente instalado e inicia com o arranque do sistema"O servi√ßo apache2 n√£o se encontra correcta<span style="color: #00aaaa">: https://www.mydailytutorials.com/using--find-module-search-filesfolder</span>Rotina Auxiliar&gt; Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurseregister: caminho_php_ini
<span style="color: #00aaaa">  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.html</span>- name: "Simula√ß√£o: Ativa a op√ß√£o file_uploads no ficheiro php.ini, utilizando o m√≥dulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:- regexp: "^file_uploads"line: "file_uploads = 1"- regexp: "^upload_max_filesize"line: "upload_max_filesize = 1G"- regexp: "^max_file_uploads"line: "max_file_uploads = 20"- regexp: "^post_max_size"line: "post_max_size = 2G"- regexp: "^memory_limit"
[?12l[?25h[?25l78line: "post_max_size = 2G"- regexp: "^memory_limit"line: "memory_limit = 2G"- regexp: "^max_input_time"  line: "max_input_time = 3600"As linhas do php.ini encontram-se alteradas ?"ficheiro php.ini foi alterado com sucesso"Algumas altera√ß√µes ao ficheiro php.ini n√£o tiveram sucesso"<span style="color: #00aaaa">O site deve existir na pasta /var/www/leantime. Este teste visa determinar se a pasta
  # existe e se temas permiss√µes certas
  # Fonte de inspira√ß√£o: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html</span>- name: "Simula√ß√£o: Obtem informa√ß√£o sobre a pastas /var/www/leantime"
    stat:    path: "/var/www/leantime"register: pasta
  - name: "Teste: A pasta /var/www/leantime existe e tem as permiss√µes certas?"assert:  that:  - pasta.stat.exists- pasta.stat.isdir  - pasta.stat.mode == "0755"- pasta.stat.pw_name == "www-data"  - pasta.stat.gr_name == "www-data"success_msg: "SUCESSO: Permiss√µes correctas no site leantime"fail_msg: "ERRO: Permiss√µes incorrectas no site leantime ou site n√£o existente"
<span style="color: #00aaaa">  # Outro dos requesitos √© a exist√™ncia de uma base de dados para o site.
</span>[?12l[?25h[?25l<span style="color: #00aaaa">  # Outro dos requesitos √© a exist√™ncia de uma base de dados para o site.
  # Esta base de dados deve ser criada, logo tem de ser testada para determinar se ela existe ou n√£o.
  # Fonte de inspira√ß√£o: https://serverfault.com/questions/173978/from-a-shell-script-how-can-i-check-whether-a-mysql-database-exists</span>- name: "Simula√ß√£o: Verifica se √© necess√°rio criar a base de dados leantime_database"shell: "mysql -u root -e 'use leantime_database'"resultfailed_when: false  changed_when: false
  - name: "Teste: A base de dados leantime_database existe ?"assert:that:- result.rc == 0success_msg: "SUCESSO: A base de dados leantime_database j√° se encontra criada"fail_msg: "ERRO: N√£o existe a base de dados leantime_database"
<span style="color: #00aaaa">  # Teste: O download do software leantime deve ser poss√≠vel, a partir do site do leantime</span>- name: "Simula√ß√£o e Teste: Verifica se o endere√ßo git para a vers√£o de leantime existe"uri:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipregister: resultado<span style="color: #00aaaa">Teste: Do ficheiro configuration.php no site do leantime. A exist√™ncia deste ficheiro       com as permiss√µes certas indica que o processo de unzip correu bemDocumenta√ß√£o oficial em: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html</span>o ficheiro /var/www/leantime/config/configuration.php"/config/configuration.php"ficheiroO ficheiro /var/www/leantime/config/configuration.php existe e tem as permiss√µes certas?"ficheiro.stat.exists
[?12l[?25h[?25lthat: - ficheiro.stat.exists - ficheiro.stat.isreg - ficheiro.stat.mode == "0755" - ficheiro.stat.pw_name == "www-data"    - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permiss√µes correctas e ficheiro configuration.php existente"  fail_msg: "ERRO: Permiss√µes incorrectas ou ficheiro configuration.php n√£o existente"
<span style="color: #00aaaa">  # Teste: O ficheiro /var/www/leantime/config/configuration.php necessita de ser alterado.
  # As vari√°veis dbuser, dbDatabase, e dbPassword necessitam de estar configuradas.
  # Por simula√ß√£o o sistema vai determinar se estas est√£o configuradas com o valor esperado.
  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html</span>- name: "Simula√ß√£o: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbUser=""' replace: 'dbUser="{{ login_leantime }}"'  check_mode: yesregister: conffailed_when: false
  - name: "Teste: O dbUser foi alterado?"
    assert: that: - conf is not changed    - conf is not failed  success_msg: "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"fail_msg: "ERRO: O dbUser n√£o foi alterado no ficheiro configuration.php"
<span style="color: #00aaaa">  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html</span>- name: "Simula√ß√£o: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.php
[?12l[?25h[?25l    ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbDatabase=""'replace: 'dbDatabase="leantime_database"'check_mode: yesregister: conffailed_when: false
  - name: "Teste: a vari√°vel dbDatabase foi alterada?"
    assert: that: - conf is not changed - conf is not failed    success_msg: "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"  fail_msg: "ERRO: O dbDatabase n√£o foi alterado no ficheiro configuration.php"
<span style="color: #00aaaa">  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html</span>- name: "Simula√ß√£o: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace."ansible.builtin.replace:  path: /var/www/leantime/config/configuration.php  regexp: 'dbPassword=""'replace: 'dbPassword="{{ password_leantime }}"'  check_mode: yesregister: conffailed_when: false
  - name: "Teste: O dbPassword foi alterado?"assert:that:- conf is not changed- conf is not failed success_msg: "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"    fail_msg: "ERRO: O dbPassword n√£o foi alterado no ficheiro configuration.php"
<span style="color: #00aaaa">  # A configura√ß√£o do site leantime necessita que seja criado um site atrav√©s de um ficheiro de
</span>[?12l[?25h[?25l<span style="color: #00aaaa">  # A configura√ß√£o do site leantime necessita que seja criado um site atrav√©s de um ficheiro de
  # configura√ß√£o, dentro das pasta do apache2. Deve existir um ficheiro de configura√ß√£o do
  # leantime em (/etc/apache2/sites-available</span>
<span style="color: #00aaaa">  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html</span>- name: "Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /etc/apache2/sites-available/leantime.conf"stat:path: "/etc/apache2/sites-available/leantime.conf"  register: ficheiro
  - name: "Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permiss√µes certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.isreg- ficheiro.stat.mode == "0755" - ficheiro.stat.pw_name == "root" - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permiss√µes correctas"fail_msg: "ERRO: Permiss√µes incorrectas"
<span style="color: #00aaaa">  # O site deve estar ativo no apache. Este teste vai verificar se o site se encontra ativo
  # https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html</span>- name: "Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf"stat:path: "/etc/apache2/sites-enabled/leantime.conf"  register: ficheiro
  - name: "Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permiss√µes certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.islnk- ficheiro.stat.mode == "0777" - ficheiro.stat.pw_name == "root"
[?12l[?25h[?25l77root"
[?12l[?25h[?25l78M- ficheiro.stat.islnk
[?12l[?25h[?25l78M- ficheiro.stat.exists
[?12l[?25h[?25l78Mthat:
[?12l[?25h[?25l78Massert:
[?12l[?25h[?25l78M- name: "Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permiss√µes certas?"
[?12l[?25h[?25l78M[?12l[?25h[?25l78Mregister: ficheiro
[?12l[?25h[?25l78Mpath: "/etc/apache2/sites-enabled/leantime.conf"
[?12l[?25h[?25l78Mstat:
[?12l[?25h[?25l78M- name: "Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf"
[?12l[?25h[?25l78M<span style="color: #00aaaa">  # https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html
</span>[?12l[?25h[?25l78M<span style="color: #00aaaa">  # O site deve estar ativo no apache. Este teste vai verificar se o site se encontra ativo
</span>[?12l[?25h[?25l78M[?12l[?25h[?25l78Mfail_msg: "ERRO: Permiss√µes incorrectas"
[?12l[?25h[?25l78Msuccess_msg: "SUCESSO: Permiss√µes correctas"
[?12l[?25h[?25l78M- ficheiro.stat.gr_name == "www-data"
[?12l[?25h[?25l78M- ficheiro.stat.pw_name == "root"
[?12l[?25h[?25l78M- ficheiro.stat.mode == "0755"
[?12l[?25h[?25l78M- ficheiro.stat.isreg
[?12l[?25h[?25l78M- ficheiro.stat.exists
[?12l[?25h[?25l78Mthat:
[?12l[?25h[?25l78Massert:
[?12l[?25h[?25l78M- name: "Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permiss√µes certas?"
[?12l[?25h[?25l78M[?12l[?25h[?25l78Mregister: ficheiro
[?12l[?25h[?25l78Mpath: "/etc/apache2/sites-available/leantime.conf"
[?12l[?25h[?25l78Mstat:
[?12l[?25h[?25l78M- name: "Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /etc/apache2/sites-available/leantime.conf"
[?12l[?25h[?25l78M<span style="color: #00aaaa">  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html
</span>[?12l[?25h[?25l78M<span style="color: #00aaaa">  # leantime em (/etc/apache2/sites-available
</span>[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25lata"[?12l[?25h[?25l
[?12l[?25h[?1049l
[?1l&gt;[?2004l]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ molecule login
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">login</span>
Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-72-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Tue May 25 20:56:10 UTC 2021

  System load:  0.26              Processes:               130
  Usage of /:   7.8% of 38.71GB   Users logged in:         0
  Memory usage: 31%               IPv4 address for enp0s3: 10.0.2.15
  Swap usage:   0%                IPv4 address for enp0s8: 172.28.128.21

 * Super-optimized for small spaces - read how we shrank the memory
   footprint of MicroK8s to make it the smallest full K8s around.

   https://ubuntu.com/blog/microk8s-memory-optimisation




*** System restart required ***
Last login: Tue May 25 20:54:44 2021 from 10.0.2.2

]0;vagrant@ubuntu-20: ~vagrant@ubuntu-20:~$ sudo /i*i-i
]0;root@ubuntu-20: ~root@ubuntu-20:~# ls /etc/apache2/sites-available/- /etc/apache2/sites-available/a /etc/apache2/sites-available/l /etc/apache2/sites-available/h /etc/apache2/sites-available/ /etc/apache2/sites-available/
ls-alh: command not found
]0;root@ubuntu-20: ~root@ubuntu-20:~# ls-alh  /etc/apache2/sites-available/[1@ 
total 24K
drwxr-xr-x 2 root root 4.0K May 25 18:57 <span style="font-weight: bold; color: #0000aa">.</span>
drwxr-xr-x 8 root root 4.0K May 20 21:19 <span style="font-weight: bold; color: #0000aa">..</span>
-rw-r--r-- 1 root root 1.4K Apr 13  2020 000-default.conf
-rw-r--r-- 1 root root 6.2K Apr 13  2020 default-ssl.conf
-rwxr-xr-x 1 root root  320 May 25 18:57 <span style="font-weight: bold; color: #00aa00">leantime.conf</span>
]0;root@ubuntu-20: ~root@ubuntu-20:~# rm leals -alh  /etc/apache2/sites-available/[1@r[1@mleantime.conf 
]0;root@ubuntu-20: ~root@ubuntu-20:~# rm  /etc/apache2/sites-available/leantime.conf 
ls -alh  /etc/apache2/sites-available/

[1@ /////////e/n/abled/
total 8.0K
drwxr-xr-x 2 root root 4.0K May 25 20:49 <span style="font-weight: bold; color: #0000aa">.</span>
drwxr-xr-x 8 root root 4.0K May 20 21:19 <span style="font-weight: bold; color: #0000aa">..</span>
lrwxrwxrwx 1 root root   35 May 20 21:19 <span style="font-weight: bold; color: #00aaaa">000-default.conf</span> -&gt; ../sites-available/000-default.conf
lrwxrwxrwx 1 root root   42 May 25 20:49 <span style="font-weight: bold; color: #aa0000; background-color: #000316">leantime.conf</span> -&gt; <span style="font-weight: bold; color: #aa0000; background-color: #000316">/etc/apache2/sites-available/leantime.conf</span>
]0;root@ubuntu-20: ~root@ubuntu-20:~# ls -alh  /etc/apache2/sites-enabled/[1@r[1@mleantime.conf 
]0;root@ubuntu-20: ~root@ubuntu-20:~# exit
logout
]0;vagrant@ubuntu-20: ~vagrant@ubuntu-20:~$ exit
logout
Connection to 127.0.0.1 closed.

]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ nano tasks/tasks.yml 
[?2004h[?1049h[?7h[?1h=[?1h=[?25l<span style="background-color: #AAAAAA; color: #000000">[ A ler... ]</span><span style="background-color: #AAAAAA; color: #000000">[ 168 linhas lidas ]</span><span style="background-color: #AAAAAA; color: #000000">  GNU nano 4.8                                                tasks/tasks.yml                                                             </span>
<span style="background-color: #AAAAAA; color: #000000">^G</span> Ajuda<span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar<span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor    <span style="background-color: #AAAAAA; color: #000000">M-U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt
<span style="background-color: #AAAAAA; color: #000000">^X</span> Sair<span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer<span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
---- name: Atualiza a cache (equivalente a apt update)apt:update_cache: truecache_valid_time: 3600- name: "Atualiza o sistema operativo"apt:upgrade: safe- name: "Instalar as dependencias necess√°ria ao programa leantime"apt:pkg:- mc- screen- git- apache2- mysql-server- php- php-mysql- php-ldap- php-cli- php-soap- php-json- graphviz- php-xml- php-gd- php-zip- libapache2-mod-php- php-dev- libmcrypt-dev- gcc- make- autoconf- libc-dev
[?12l[?25h[?25l - autoconf    - libc-dev  - pkg-config- pwgen- curl- unzip    - zip  - php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurl
<span style="color: #00aaaa">   # Fonte de inspira√ß√£o: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.html</span>- name: "Instala o servi√ßo apache2 no arranque do sistema"service:name: apache2state: startedenabled: true
<span style="color: #00aaaa">   # Fonte: https://www.mydailytutorials.com/using-ansible-find-module-search-filesfolder</span>- name: "Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurse: trueregister: caminho_php_ini
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.html</span>- name: "Ativa v√°rias op√ß√µes no ficheiro php.ini, utilizando o m√≥dulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"
[?12l[?25h[?25lregexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:regexp: "^file_uploads"  line: "file_uploads = 1"regexp: "^upload_max_filesize"  line: "upload_max_filesize = 1G"regexp: "^max_file_uploads"  line: "max_file_uploads = 20"regexp: "^post_max_size"  line: "post_max_size = 2G"regexp: "^memory_limit"  line: "memory_limit = 2G"- regexp: "^max_input_time" line: "max_input_time = 3600"
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/2.7/modules/file_module.html</span>- name: Cria a directoria tempor√°ria leantime e a directoria de apache leantimefile:path: "{{ item.path }}"state: directory mode: 0755    owner: www-data  group: www-datawith_items:- path: "/tmp/leantime"- path: "/var/www/leantime"
<span style="color: #00aaaa">   # Fonte: Ansible for DevOps - Server and configuration management for humans de Jeff Geerling, p√°gina 98
</span>   - name: "Cria a base de dados de mysql para o leantime"  mysql_db: "db=leantime_database state=present"
- name: "Cria o utilizador para a base de dados leantime"mysql_user:namlogin_leantime }}"
[?12l[?25h[?25lmysql_user:namlogin_leantime }}"  password: "{{ password_leantime }}"priv: "leantime_database.*:ALL"host: localhoststate: present
- name: "Faz o download do software leantime a partir do reposit√≥rio git"get_url:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipdest: /tmp/leantimemode: 0755
<span style="color: #00aaaa">   # O ficheiro Leantime-versao.zip necessita de ser descomprimido</span>- name: Descomprime o software leantimeunarchive: src: "/tmp/leantime/Leantime-{{ versao_leantime }}.zip"    dest: "/var/www/leantime"  owner: www-datagroup: www-datamode: 0755remote_src: true
<span style="color: #00aaaa">   # Ap√≥s a descompress√£o, se o ficheiro configuration.php n√£o existir, este necessita de ser
   # criado a partir do ficheiro configuration.sample.php
   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.html</span>- name: Copia o ficheiro de configura√ß√£o configuration.sample.phpansible.builtin.copy: src: /var/www/leantime/config/configuration.sample.php    dest: /var/www/leantime/config/configuration.php  owner: www-datagroup: www-data    mode: '0755'  remote_src: trueforce: false
[?12l[?25h[?25l  remote_src: trueforce: false
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html</span>- name: Altera as vari√°veis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o m√≥dulo replace.ansible.builtin.replace:path: /var/www/leantime/config/configuration.php    regexp: "{{ item.regexp  }}"  replace: "{{ item.line }}"with_items:- regexp: 'dbUser=""'  line: 'dbUser="{{ login_leantime }}"'- regexp: 'dbDatabase=""' line: 'dbDatabase="leantime_database"'    - regexp: 'dbPassword=""'    line: 'dbPassword="{{ password_leantime }}"'
<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html</span>- name: Copia o template do site para a p√°sta /etc/apache2/sites-availableansible.builtin.template:src: leantime.template.j2dest: /etc/apache2/sites-available/leantime.confowner: root group: www-data mode: 0755force: false<span style="color: #00aaaa">file</span>"Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"fileetc/apache2/sites-available/leantime.confetc/apache2/sites-enabled/leantime.confrootroot
[?12l[?25h[?25lgroup: rootmode: '0755'state: link
[?12l[?25h[?25l78Mowner: root
[?12l[?25h[?25l78Mdest: /etc/apache2/sites-enabled/leantime.conf
[?12l[?25h[?25l78Msrc: /etc/apache2/sites-available/leantime.conf
[?12l[?25h[?25l78Mansible.builtin.file:
[?12l[?25h[?25l78M- name: "Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"
[?12l[?25h[?25l78M<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html
</span>[?12l[?25h[?25l78M[?12l[?25h[?25l78Mforce: false
[?12l[?25h[?25l78Mmode: 0755
[?12l[?25h[?25l78Mgroup: www-data
[?12l[?25h[?25l78Mowner: root
[?12l[?25h[?25l78Mdest: /etc/apache2/sites-available/leantime.conf
[?12l[?25h[?25l78Msrc: leantime.template.j2
[?12l[?25h[?25l78Mansible.builtin.template:
[?12l[?25h[?25l78M- name: Copia o template do site para a p√°sta /etc/apache2/sites-available
[?12l[?25h[?25l78M<span style="color: #00aaaa">   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.html
</span>[?12l[?25h[?25l78M[?12l[?25h[?25l78Mline: 'dbPassword="{{ password_leantime }}"'
[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l<span style="background-color: #AAAAAA; color: #000000">Modificado</span>'[?12l[?25h[?25l'[?12l[?25h[?25l77'[?12l[?25h[?25l777'[?12l[?25h[?25l         <span style="background-color: #AAAAAA; color: #000000">M-D</span> Formato DOS<span style="background-color: #AAAAAA; color: #000000">M-A</span> Anexar<span style="background-color: #AAAAAA; color: #000000">B</span> Seguran√ßa<span style="background-color: #AAAAAA; color: #000000">C</span> Cancelar           <span style="background-color: #AAAAAA; color: #000000">M-M</span> Formato Mac<span style="background-color: #AAAAAA; color: #000000">M-P</span> Prepor<span style="background-color: #AAAAAA; color: #000000">^T</span> P/ ficheiros
<span style="background-color: #AAAAAA; color: #000000">Nome do ficheiro onde escrever: tasks/tasks.yml                                                                                           </span>[?12l[?25h[?25l <span style="background-color: #AAAAAA; color: #000000">[ A escrever... ]</span><span style="background-color: #AAAAAA; color: #000000">          </span><span style="background-color: #AAAAAA; color: #000000">[ 168 linhas escritas ]</span><span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar      <span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor<span style="background-color: #AAAAAA; color: #000000">U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt<span style="background-color: #AAAAAA; color: #000000">X</span> Sair    <span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer      <span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25ls[?12l[?25h[?25l
[?12l[?25h[?25l<span style="background-color: #AAAAAA; color: #000000">Modificado
</span> [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25l [?12l[?25h[?25lw[?12l[?25h[?25lw[?12l[?25h[?25lw[?12l[?25h[?25l-[?12l[?25h[?25ld[?12l[?25h[?25la[?12l[?25h[?25lt[?12l[?25h[?25la[?12l[?25h[?25l         <span style="background-color: #AAAAAA; color: #000000">M-D</span> Formato DOS<span style="background-color: #AAAAAA; color: #000000">M-A</span> Anexar<span style="background-color: #AAAAAA; color: #000000">B</span> Seguran√ßa<span style="background-color: #AAAAAA; color: #000000">C</span> Cancelar           <span style="background-color: #AAAAAA; color: #000000">M-M</span> Formato Mac<span style="background-color: #AAAAAA; color: #000000">M-P</span> Prepor<span style="background-color: #AAAAAA; color: #000000">^T</span> P/ ficheiros
<span style="background-color: #AAAAAA; color: #000000">Nome do ficheiro onde escrever: tasks/tasks.yml                                                                                           </span>[?12l[?25h[?25l <span style="background-color: #AAAAAA; color: #000000">[ A escrever... ]</span><span style="background-color: #AAAAAA; color: #000000">          </span><span style="background-color: #AAAAAA; color: #000000">[ 168 linhas escritas ]</span><span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar      <span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor<span style="background-color: #AAAAAA; color: #000000">U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt<span style="background-color: #AAAAAA; color: #000000">X</span> Sair    <span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer      <span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
[?12l[?25h[?25l
[?12l[?25h[?1049l
[?1l&gt;[?2004l]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ nano tasks/tasks.yml molecule loginconvergeverify
<span style="color: #0000aa">INFO    </span> default scenario test matrix: verify
<span style="color: #0000aa">INFO    </span> Performing prerun<span style="color: #aa5500">...</span>
<span style="color: #0000aa">INFO    </span> Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
<span style="color: #0000aa">INFO    </span> Added <span style="color: #aa5500">ANSIBLE_ROLES_PATH</span>=~<span style="color: #E850A8">/.ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/usr/share/ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/etc/ansible/</span><span style="color: #ff90e8">roles</span>:.<span style="color: #E850A8">/.cache/</span><span style="color: #ff90e8">roles</span>
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">verify</span>
<span style="color: #0000aa">INFO    </span> Running Ansible Verifier

PLAY [Infraestrutura conduzida por testes] ***********************************************************************************************

TASK [Vari√°veis] *************************************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Simula√ß√£o: Atualizar a cache do sistema] *******************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [teste: a cache encontra-se actualizada?] *******************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: A cache est√° atualizada"</span>
<span style="color: #00aa00">}</span>

TASK [Atualizar o sistema operativo (equivalente a apt upgrade)] *************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [teste: o sistema operativo encontra-se atualizado?] ********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O sistema operativo est√° atualizado"</span>
<span style="color: #00aa00">}</span>

TASK [Teste: a cache encontra-se atualizada?] ********************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: A cache est√° atualizada"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: testa se as aplica√ß√µes dependencia do software leantime se encontram instaladas] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: as dependencias encontra-se instaladas?] ************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: As dependencias estavam instaladas"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Testar se o servi√ßo apache2 se encontra instalado, iniciado e ativo no arranque] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O servi√ßo apache2 encontra-se ativo no arranque no sistema, e est√° iniciado?] ***********************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O servi√ßo apache2 est√° correctamente instalado e inicia com o arranque do sistema"</span>
<span style="color: #00aa00">}</span>

TASK [Rotina Auxiliar&gt; Procura o caminho do ficheiro php.ini do servidor apache2] ********************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Simula√ß√£o: Ativa a op√ß√£o file_uploads no ficheiro php.ini, utilizando o m√≥dulo lineinfile.] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})</span>

TASK [Teste: As linhas do php.ini encontram-se alteradas ?] ******************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O ficheiro php.ini foi alterado com sucesso"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Obtem informa√ß√£o sobre a pastas /var/www/leantime] **********************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: A pasta /var/www/leantime existe e tem as permiss√µes certas?] ***************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: Permiss√µes correctas no site leantime"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Verifica se √© necess√°rio criar a base de dados leantime_database] *******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: A base de dados leantime_database existe ?] *********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: A base de dados leantime_database j√° se encontra criada"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o e Teste: Verifica se o endere√ßo git para a vers√£o de leantime existe] ****************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /var/www/leantime/config/configuration.php] *******************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O ficheiro /var/www/leantime/config/configuration.php existe e tem as permiss√µes certas?] ***********************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: Permiss√µes correctas e ficheiro configuration.php existente"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace.] ******************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O dbUser foi alterado?] *****************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace.] **************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: a vari√°vel dbDatabase foi alterada?] ****************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace.] **************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O dbPassword foi alterado?] *************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /etc/apache2/sites-available/leantime.conf] *******************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permiss√µes certas?] ***********************************
<span style="color: #aa0000">fatal: [ubuntu-20.04]: FAILED! =&gt; {</span>
<span style="color: #aa0000">    "assertion": "ficheiro.stat.exists",</span>
<span style="color: #aa0000">    "changed": false,</span>
<span style="color: #aa0000">    "evaluated_to": false,</span>
<span style="color: #aa0000">    "msg": "ERRO: Permiss√µes incorrectas"</span>
<span style="color: #aa0000">}</span>

PLAY RECAP *******************************************************************************************************************************
<span style="color: #aa0000">ubuntu-20.04</span>               : <span style="color: #00aa00">ok=27  </span> changed=0    unreachable=0    <span style="color: #aa0000">failed=1   </span> skipped=0    rescued=0    ignored=0


<span style="font-weight: bold; color: #aa0000">CRITICAL</span> Ansible return code was <span style="font-weight: bold; color: #00aaaa">2</span>, command was: ansible-playbook --inventory <span style="color: #E850A8">/home/admlocal/.cache/molecule/leantime_ansible/default/</span><span style="color: #ff90e8">inventory</span> --skip-tags molecule-notest,notest <span style="color: #E850A8">/home/admlocal/leantime_ansible/molecule/default/</span><span style="color: #ff90e8">verify.yml</span>
]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ molecule verifyconverge
<span style="color: #0000aa">INFO    </span> default scenario test matrix: dependency, create, prepare, converge
<span style="color: #0000aa">INFO    </span> Performing prerun<span style="color: #aa5500">...</span>
<span style="color: #0000aa">INFO    </span> Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
<span style="color: #0000aa">INFO    </span> Added <span style="color: #aa5500">ANSIBLE_ROLES_PATH</span>=~<span style="color: #E850A8">/.ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/usr/share/ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/etc/ansible/</span><span style="color: #ff90e8">roles</span>:.<span style="color: #E850A8">/.cache/</span><span style="color: #ff90e8">roles</span>
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">dependency</span>
<span style="color: #aa0000">WARNING </span> Skipping, missing the requirements file.
<span style="color: #aa0000">WARNING </span> Skipping, missing the requirements file.
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">create</span>
<span style="color: #aa0000">WARNING </span> Skipping, instances already created.
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">prepare</span>
<span style="color: #aa0000">WARNING </span> Skipping, instances already prepared.
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">converge</span>

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instalar as dependencias necess√°ria ao programa leantime] *******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instala o servi√ßo apache2 no arranque do sistema] ***************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Ativa v√°rias op√ß√µes no ficheiro php.ini, utilizando o m√≥dulo lineinfile.] ***************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})</span>

TASK [leantime_ansible : Cria a directoria tempor√°ria leantime e a directoria de apache leantime] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/tmp/leantime'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/var/www/leantime'})</span>

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
<span style="font-weight: bold; color: #E850A8">[WARNING]: Module did not set no_log for update_password</span>
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Faz o download do software leantime a partir do reposit√≥rio git] ************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Copia o ficheiro de configura√ß√£o configuration.sample.php] ******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Altera as vari√°veis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o m√≥dulo replace.] ***
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})</span>

TASK [leantime_ansible : Copia o template do site para a p√°sta /etc/apache2/sites-available] *********************************************
<span style="color: #aa5500">changed: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
<span style="color: #aa5500">changed: [ubuntu-20.04]</span>

PLAY RECAP *******************************************************************************************************************************
<span style="color: #aa5500">ubuntu-20.04</span>               : <span style="color: #00aa00">ok=16  </span> <span style="color: #aa5500">changed=2   </span> unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ molecule convergeidempotence
<span style="color: #0000aa">INFO    </span> default scenario test matrix: idempotence
<span style="color: #0000aa">INFO    </span> Performing prerun<span style="color: #aa5500">...</span>
<span style="color: #0000aa">INFO    </span> Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
<span style="color: #0000aa">INFO    </span> Added <span style="color: #aa5500">ANSIBLE_ROLES_PATH</span>=~<span style="color: #E850A8">/.ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/usr/share/ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/etc/ansible/</span><span style="color: #ff90e8">roles</span>:.<span style="color: #E850A8">/.cache/</span><span style="color: #ff90e8">roles</span>
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">idempotence</span>

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instalar as dependencias necess√°ria ao programa leantime] *******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instala o servi√ßo apache2 no arranque do sistema] ***************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Ativa v√°rias op√ß√µes no ficheiro php.ini, utilizando o m√≥dulo lineinfile.] ***************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})</span>

TASK [leantime_ansible : Cria a directoria tempor√°ria leantime e a directoria de apache leantime] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/tmp/leantime'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/var/www/leantime'})</span>

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
<span style="font-weight: bold; color: #E850A8">[WARNING]: Module did not set no_log for update_password</span>
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Faz o download do software leantime a partir do reposit√≥rio git] ************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Copia o ficheiro de configura√ß√£o configuration.sample.php] ******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Altera as vari√°veis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o m√≥dulo replace.] ***
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})</span>

TASK [leantime_ansible : Copia o template do site para a p√°sta /etc/apache2/sites-available] *********************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

PLAY RECAP *******************************************************************************************************************************
<span style="color: #00aa00">ubuntu-20.04</span>               : <span style="color: #00aa00">ok=16  </span> changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


<span style="color: #0000aa">INFO    </span> Idempotence completed successfully.
]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ molecule login
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">login</span>
Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-72-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Tue May 25 21:00:06 UTC 2021

  System load:  0.31              Processes:               135
  Usage of /:   7.8% of 38.71GB   Users logged in:         0
  Memory usage: 33%               IPv4 address for enp0s3: 10.0.2.15
  Swap usage:   0%                IPv4 address for enp0s8: 172.28.128.21

 * Super-optimized for small spaces - read how we shrank the memory
   footprint of MicroK8s to make it the smallest full K8s around.

   https://ubuntu.com/blog/microk8s-memory-optimisation




*** System restart required ***
Last login: Tue May 25 20:59:59 2021 from 10.0.2.2

]0;vagrant@ubuntu-20: ~vagrant@ubuntu-20:~$ sudo -i
]0;root@ubuntu-20: ~root@ubuntu-20:~# ls -alh /etc/apache2/sites-available/
total 24K
drwxr-xr-x 2 root root     4.0K May 25 20:59 <span style="font-weight: bold; color: #0000aa">.</span>
drwxr-xr-x 8 root root     4.0K May 20 21:19 <span style="font-weight: bold; color: #0000aa">..</span>
-rw-r--r-- 1 root root     1.4K Apr 13  2020 000-default.conf
-rw-r--r-- 1 root root     6.2K Apr 13  2020 default-ssl.conf
-rwxrwxrwx 1 root www-data  320 May 25 20:59 <span style="font-weight: bold; color: #00aa00">leantime.conf</span>
]0;root@ubuntu-20: ~root@ubuntu-20:~# ls -alh /etc/apache2/sites-available//////////e/n/a/b/l/e/d/
total 8.0K
drwxr-xr-x 2 root root 4.0K May 25 20:59 <span style="font-weight: bold; color: #0000aa">.</span>
drwxr-xr-x 8 root root 4.0K May 20 21:19 <span style="font-weight: bold; color: #0000aa">..</span>
lrwxrwxrwx 1 root root   35 May 20 21:19 <span style="font-weight: bold; color: #00aaaa">000-default.conf</span> -&gt; ../sites-available/000-default.conf
lrwxrwxrwx 1 root root   42 May 25 20:59 <span style="font-weight: bold; color: #00aaaa">leantime.conf</span> -&gt; <span style="font-weight: bold; color: #00aa00">/etc/apache2/sites-available/leantime.conf</span>
]0;root@ubuntu-20: ~root@ubuntu-20:~# stat -c "%a %n" &amp;/etc/&amp;apache2/sites-available/leantime.conf 
777 /etc/apache2/sites-available/leantime.conf
]0;root@ubuntu-20: ~root@ubuntu-20:~# stat -c "%a %n" /etc/apache2/sites-available/leantime.conf [1@e[1@n[1@a[1@b[1@l[1@e[1@d
777 /etc/apache2/sites-enabled/leantime.conf
]0;root@ubuntu-20: ~root@ubuntu-20:~# exit
logout
]0;vagrant@ubuntu-20: ~vagrant@ubuntu-20:~$ exit
logout
Connection to 127.0.0.1 closed.

]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ nano molecule/default/
[?2004h[?1049h[?7h[?1h=[?1h=[?25l<span style="font-weight: bold"></span><span style="font-weight: bold; color: #F5F1DE"></span><span style="font-weight: bold; color: #F5F1DE; background-color: #aa0000">[ "molecule/default/" √© uma pasta ]</span><span style="font-weight: bold"></span><span style="background-color: #AAAAAA; color: #000000">  GNU nano 4.8                                                  Novo buffer                                                               </span>
<span style="background-color: #AAAAAA; color: #000000">^G</span> Ajuda<span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar<span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor    <span style="background-color: #AAAAAA; color: #000000">M-U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt
<span style="background-color: #AAAAAA; color: #000000">^X</span> Sair<span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer<span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
[?12l[?25h[?25l<span style="background-color: #AAAAAA; color: #000000">Modificado</span>
v[?12l[?25h[?25l<span style="background-color: #AAAAAA; color: #000000">Gravar buffer modificado?                                                                                                                  S</span> Sim
<span style="background-color: #AAAAAA; color: #000000"> N</span> N√£o <span style="background-color: #AAAAAA; color: #000000">^C</span> Cancelar[?12l[?25h[?25l[?12l[?25h[?25l
[?12l[?25h[?1049l
[?1l&gt;[?2004l]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ nano molecule/default/verify.yml 
[?2004h[?1049h[?7h[?1h=[?1h=[?25l<span style="background-color: #AAAAAA; color: #000000">[ A ler... ]</span><span style="background-color: #AAAAAA; color: #000000">[ 302 linhas lidas ]</span><span style="background-color: #AAAAAA; color: #000000">  GNU nano 4.8                                          molecule/default/verify.yml                                                       </span>
<span style="background-color: #AAAAAA; color: #000000">^G</span> Ajuda<span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar<span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor    <span style="background-color: #AAAAAA; color: #000000">M-U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt
<span style="background-color: #AAAAAA; color: #000000">^X</span> Sair<span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer<span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
---
<span style="color: #00aaaa"># Tutorial de inspira√ß√£o para a infraestrutura conduzida por teste no site
# https://www.adictosaltrabajo.com/2020/05/08/ansible-testing-using-molecule-with-ansible-as-verifier/
</span>- name: "Infraestrutura conduzida por testes"hosts: allgather_facts: falsebecome: truetasks:- name: Vari√°veisinclude_vars:file: ../../vars/main.yml- name: "Simula√ß√£o: Atualizar a cache do sistema"apt:update_cache: truecache_valid_time: 3600check_mode: trueregister: estado- name: "teste: a cache encontra-se actualizada?"assert:that:- not estado.changedsuccess_msg: "SUCESSO: A cache est√° atualizada"fail_msg: "ERRO: Existem actualiza√ß√µes pendentes"- name: "Atualizar o sistema operativo (equivalente a apt upgrade)"apt:upgrade: safecheck_mode: trueregister: estado- name: "teste: o sistema operativo encontra-se atualizado?"
[?12l[?25h[?25l  - name: "teste: o sistema operativo encontra-se atualizado?"
    assert:that: - not estado.changed    success_msg: "SUCESSO: O sistema operativo est√° atualizado"    fail_msg: "ERRO: Existem actualiza√ß√µes pendentes"
  - name: "Teste: a cache encontra-se atualizada?"  assert:    that:  - not estado.changedsuccess_msg: "SUCESSO: A cache est√° atualizada"fail_msg: "ERRO: Existem atualiza√ß√µes pendentes"
  - name: "Simula√ß√£o: testa se as aplica√ß√µes dependencia do software leantime se encontram instaladas"apt:pkg:  - mc  - screen- git    - apache2  - mysql-server- phpphp-mysql- php-ldap- php-cli- php-soap    - php-json  - graphviz- php-xml  - php-gd  - php-zip- libapache2-mod-php    - php-dev
[?12l[?25h[?25l- libapache2-mod-php    - php-dev  - libmcrypt-dev- gccmake- autoconf- libc-dev- pkg-config    - pwgen  - curl- unzipzip- php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurlcheck_mode: trueregister: estado
  - name: "Teste: as dependencias encontra-se instaladas?"assert:that:not estado.changedsuccess_msg: "SUCESSO: As dependencias estavam instaladas"fail_msg: "ERRO: Faltam instalar algumas dependencias. O software pode estar parcialmente instalado"
<span style="color: #00aaaa">  # Fonte de inspira√ß√£o: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.html</span>- name: "Simula√ß√£o: Testar se o servi√ßo apache2 se encontra instalado, iniciado e ativo no arranque"service:name: apache2state: startedenabled: truecheck_mode: true
[?12l[?25h[?25lenabled: trueO servi√ßo apache2 encontra-se ativo no arranque no sistema, e est√° iniciado?"O servi√ßo apache2 est√° correctamente instalado e inicia com o arranque do sistema"O servi√ßo apache2 n√£o se encontra correcta<span style="color: #00aaaa">: https://www.mydailytutorials.com/using--find-module-search-filesfolder</span>Rotina Auxiliar&gt; Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurseregister: caminho_php_ini
<span style="color: #00aaaa">  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.html</span>- name: "Simula√ß√£o: Ativa a op√ß√£o file_uploads no ficheiro php.ini, utilizando o m√≥dulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:- regexp: "^file_uploads"line: "file_uploads = 1"- regexp: "^upload_max_filesize"line: "upload_max_filesize = 1G"- regexp: "^max_file_uploads"line: "max_file_uploads = 20"- regexp: "^post_max_size"line: "post_max_size = 2G"- regexp: "^memory_limit"
[?12l[?25h[?25l78line: "post_max_size = 2G"- regexp: "^memory_limit"line: "memory_limit = 2G"- regexp: "^max_input_time"  line: "max_input_time = 3600"As linhas do php.ini encontram-se alteradas ?"ficheiro php.ini foi alterado com sucesso"Algumas altera√ß√µes ao ficheiro php.ini n√£o tiveram sucesso"<span style="color: #00aaaa">O site deve existir na pasta /var/www/leantime. Este teste visa determinar se a pasta
  # existe e se temas permiss√µes certas
  # Fonte de inspira√ß√£o: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html</span>- name: "Simula√ß√£o: Obtem informa√ß√£o sobre a pastas /var/www/leantime"
    stat:    path: "/var/www/leantime"register: pasta
  - name: "Teste: A pasta /var/www/leantime existe e tem as permiss√µes certas?"assert:  that:  - pasta.stat.exists- pasta.stat.isdir  - pasta.stat.mode == "0755"- pasta.stat.pw_name == "www-data"  - pasta.stat.gr_name == "www-data"success_msg: "SUCESSO: Permiss√µes correctas no site leantime"fail_msg: "ERRO: Permiss√µes incorrectas no site leantime ou site n√£o existente"
<span style="color: #00aaaa">  # Outro dos requesitos √© a exist√™ncia de uma base de dados para o site.
</span>[?12l[?25h[?25l<span style="color: #00aaaa">  # Outro dos requesitos √© a exist√™ncia de uma base de dados para o site.
  # Esta base de dados deve ser criada, logo tem de ser testada para determinar se ela existe ou n√£o.
  # Fonte de inspira√ß√£o: https://serverfault.com/questions/173978/from-a-shell-script-how-can-i-check-whether-a-mysql-database-exists</span>- name: "Simula√ß√£o: Verifica se √© necess√°rio criar a base de dados leantime_database"shell: "mysql -u root -e 'use leantime_database'"resultfailed_when: false  changed_when: false
  - name: "Teste: A base de dados leantime_database existe ?"assert:that:- result.rc == 0success_msg: "SUCESSO: A base de dados leantime_database j√° se encontra criada"fail_msg: "ERRO: N√£o existe a base de dados leantime_database"
<span style="color: #00aaaa">  # Teste: O download do software leantime deve ser poss√≠vel, a partir do site do leantime</span>- name: "Simula√ß√£o e Teste: Verifica se o endere√ßo git para a vers√£o de leantime existe"uri:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipregister: resultado<span style="color: #00aaaa">Teste: Do ficheiro configuration.php no site do leantime. A exist√™ncia deste ficheiro       com as permiss√µes certas indica que o processo de unzip correu bemDocumenta√ß√£o oficial em: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html</span>o ficheiro /var/www/leantime/config/configuration.php"/config/configuration.php"ficheiroO ficheiro /var/www/leantime/config/configuration.php existe e tem as permiss√µes certas?"ficheiro.stat.exists
[?12l[?25h[?25lthat: - ficheiro.stat.exists - ficheiro.stat.isreg - ficheiro.stat.mode == "0755" - ficheiro.stat.pw_name == "www-data"    - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permiss√µes correctas e ficheiro configuration.php existente"  fail_msg: "ERRO: Permiss√µes incorrectas ou ficheiro configuration.php n√£o existente"
<span style="color: #00aaaa">  # Teste: O ficheiro /var/www/leantime/config/configuration.php necessita de ser alterado.
  # As vari√°veis dbuser, dbDatabase, e dbPassword necessitam de estar configuradas.
  # Por simula√ß√£o o sistema vai determinar se estas est√£o configuradas com o valor esperado.
  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html</span>- name: "Simula√ß√£o: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbUser=""' replace: 'dbUser="{{ login_leantime }}"'  check_mode: yesregister: conffailed_when: false
  - name: "Teste: O dbUser foi alterado?"
    assert: that: - conf is not changed    - conf is not failed  success_msg: "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"fail_msg: "ERRO: O dbUser n√£o foi alterado no ficheiro configuration.php"
<span style="color: #00aaaa">  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html</span>- name: "Simula√ß√£o: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.php
[?12l[?25h[?25l    ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbDatabase=""'replace: 'dbDatabase="leantime_database"'check_mode: yesregister: conffailed_when: false
  - name: "Teste: a vari√°vel dbDatabase foi alterada?"
    assert: that: - conf is not changed - conf is not failed    success_msg: "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"  fail_msg: "ERRO: O dbDatabase n√£o foi alterado no ficheiro configuration.php"
<span style="color: #00aaaa">  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.html</span>- name: "Simula√ß√£o: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace."ansible.builtin.replace:  path: /var/www/leantime/config/configuration.php  regexp: 'dbPassword=""'replace: 'dbPassword="{{ password_leantime }}"'  check_mode: yesregister: conffailed_when: false
  - name: "Teste: O dbPassword foi alterado?"assert:that:- conf is not changed- conf is not failed success_msg: "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"    fail_msg: "ERRO: O dbPassword n√£o foi alterado no ficheiro configuration.php"
<span style="color: #00aaaa">  # A configura√ß√£o do site leantime necessita que seja criado um site atrav√©s de um ficheiro de
</span>[?12l[?25h[?25l<span style="color: #00aaaa">  # A configura√ß√£o do site leantime necessita que seja criado um site atrav√©s de um ficheiro de
  # configura√ß√£o, dentro das pasta do apache2. Deve existir um ficheiro de configura√ß√£o do
  # leantime em (/etc/apache2/sites-available</span>
<span style="color: #00aaaa">  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html</span>- name: "Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /etc/apache2/sites-available/leantime.conf"stat:path: "/etc/apache2/sites-available/leantime.conf"  register: ficheiro
  - name: "Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permiss√µes certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.isreg- ficheiro.stat.mode == "0755" - ficheiro.stat.pw_name == "root" - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permiss√µes correctas"fail_msg: "ERRO: Permiss√µes incorrectas"
<span style="color: #00aaaa">  # O site deve estar ativo no apache. Este teste vai verificar se o site se encontra ativo
  # https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html</span>- name: "Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf"stat:path: "/etc/apache2/sites-enabled/leantime.conf"  register: ficheiro
  - name: "Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permiss√µes certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.islnk- ficheiro.stat.mode == "0777" - ficheiro.stat.pw_name == "root"
[?12l[?25h[?25l77root"
[?12l[?25h[?25l78M- ficheiro.stat.islnk
[?12l[?25h[?25l78M- ficheiro.stat.exists
[?12l[?25h[?25l78Mthat:
[?12l[?25h[?25l78Massert:
[?12l[?25h[?25l78M- name: "Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permiss√µes certas?"
[?12l[?25h[?25l78M[?12l[?25h[?25l78Mregister: ficheiro
[?12l[?25h[?25l78Mpath: "/etc/apache2/sites-enabled/leantime.conf"
[?12l[?25h[?25l78Mstat:
[?12l[?25h[?25l78M- name: "Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf"
[?12l[?25h[?25l78M<span style="color: #00aaaa">  # https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.html
</span>[?12l[?25h[?25l78M<span style="color: #00aaaa">  # O site deve estar ativo no apache. Este teste vai verificar se o site se encontra ativo
</span>[?12l[?25h[?25l78M[?12l[?25h[?25l78Mfail_msg: "ERRO: Permiss√µes incorrectas"
[?12l[?25h[?25l78Msuccess_msg: "SUCESSO: Permiss√µes correctas"
[?12l[?25h[?25l78M- ficheiro.stat.gr_name == "www-data"
[?12l[?25h[?25l78M- ficheiro.stat.pw_name == "root"
[?12l[?25h[?25l78M- ficheiro.stat.mode == "0755"
[?12l[?25h[?25l78M- ficheiro.stat.isreg
[?12l[?25h[?25l78M- ficheiro.stat.exists
[?12l[?25h[?25l78Mthat:
[?12l[?25h[?25l78Massert:
[?12l[?25h[?25l78M- name: "Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permiss√µes certas?"
[?12l[?25h[?25l78M[?12l[?25h[?25l78Mregister: ficheiro
[?12l[?25h[?25l78Mpath: "/etc/apache2/sites-available/leantime.conf"
[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l<span style="background-color: #AAAAAA; color: #000000">Modificado</span>"[?12l[?25h[?25l"[?12l[?25h[?25l77"[?12l[?25h[?25l777"[?12l[?25h[?25l         <span style="background-color: #AAAAAA; color: #000000">M-D</span> Formato DOS<span style="background-color: #AAAAAA; color: #000000">M-A</span> Anexar<span style="background-color: #AAAAAA; color: #000000">B</span> Seguran√ßa<span style="background-color: #AAAAAA; color: #000000">C</span> Cancelar           <span style="background-color: #AAAAAA; color: #000000">M-M</span> Formato Mac<span style="background-color: #AAAAAA; color: #000000">M-P</span> Prepor<span style="background-color: #AAAAAA; color: #000000">^T</span> P/ ficheiros
<span style="background-color: #AAAAAA; color: #000000">Nome do ficheiro onde escrever: molecule/default/verify.yml                                                                               </span>[?12l[?25h[?25l <span style="background-color: #AAAAAA; color: #000000">[ A escrever... ]</span><span style="background-color: #AAAAAA; color: #000000">          </span><span style="background-color: #AAAAAA; color: #000000">[ 302 linhas escritas ]</span><span style="background-color: #AAAAAA; color: #000000">^O</span> Gravar<span style="background-color: #AAAAAA; color: #000000">^W</span> Procurar      <span style="background-color: #AAAAAA; color: #000000">^K</span> Cortar txt    <span style="background-color: #AAAAAA; color: #000000">^J</span> Justificar    <span style="background-color: #AAAAAA; color: #000000">^C</span> Pos cursor<span style="background-color: #AAAAAA; color: #000000">U</span> Desfazer     <span style="background-color: #AAAAAA; color: #000000">M-A</span> Marcar txt<span style="background-color: #AAAAAA; color: #000000">X</span> Sair    <span style="background-color: #AAAAAA; color: #000000">^R</span> Carregar<span style="background-color: #AAAAAA; color: #000000">^\</span> Substituir    <span style="background-color: #AAAAAA; color: #000000">^U</span> Colar txt     <span style="background-color: #AAAAAA; color: #000000">^T</span> Ortografia    <span style="background-color: #AAAAAA; color: #000000">^_</span> Ir p/ linha   <span style="background-color: #AAAAAA; color: #000000">M-E</span> Refazer      <span style="background-color: #AAAAAA; color: #000000">M-6</span> Copiar txt
[?12l[?25h[?25l
[?12l[?25h[?1049l
[?1l&gt;[?2004l]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ nano molecule/default/verify.yml molecule loginverify
<span style="color: #0000aa">INFO    </span> default scenario test matrix: verify
<span style="color: #0000aa">INFO    </span> Performing prerun<span style="color: #aa5500">...</span>
<span style="color: #0000aa">INFO    </span> Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
<span style="color: #0000aa">INFO    </span> Added <span style="color: #aa5500">ANSIBLE_ROLES_PATH</span>=~<span style="color: #E850A8">/.ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/usr/share/ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/etc/ansible/</span><span style="color: #ff90e8">roles</span>:.<span style="color: #E850A8">/.cache/</span><span style="color: #ff90e8">roles</span>
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">verify</span>
<span style="color: #0000aa">INFO    </span> Running Ansible Verifier

PLAY [Infraestrutura conduzida por testes] ***********************************************************************************************

TASK [Vari√°veis] *************************************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Simula√ß√£o: Atualizar a cache do sistema] *******************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [teste: a cache encontra-se actualizada?] *******************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: A cache est√° atualizada"</span>
<span style="color: #00aa00">}</span>

TASK [Atualizar o sistema operativo (equivalente a apt upgrade)] *************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [teste: o sistema operativo encontra-se atualizado?] ********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O sistema operativo est√° atualizado"</span>
<span style="color: #00aa00">}</span>

TASK [Teste: a cache encontra-se atualizada?] ********************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: A cache est√° atualizada"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: testa se as aplica√ß√µes dependencia do software leantime se encontram instaladas] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: as dependencias encontra-se instaladas?] ************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: As dependencias estavam instaladas"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Testar se o servi√ßo apache2 se encontra instalado, iniciado e ativo no arranque] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O servi√ßo apache2 encontra-se ativo no arranque no sistema, e est√° iniciado?] ***********************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O servi√ßo apache2 est√° correctamente instalado e inicia com o arranque do sistema"</span>
<span style="color: #00aa00">}</span>

TASK [Rotina Auxiliar&gt; Procura o caminho do ficheiro php.ini do servidor apache2] ********************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Simula√ß√£o: Ativa a op√ß√£o file_uploads no ficheiro php.ini, utilizando o m√≥dulo lineinfile.] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})</span>

TASK [Teste: As linhas do php.ini encontram-se alteradas ?] ******************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O ficheiro php.ini foi alterado com sucesso"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Obtem informa√ß√£o sobre a pastas /var/www/leantime] **********************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: A pasta /var/www/leantime existe e tem as permiss√µes certas?] ***************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: Permiss√µes correctas no site leantime"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Verifica se √© necess√°rio criar a base de dados leantime_database] *******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: A base de dados leantime_database existe ?] *********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: A base de dados leantime_database j√° se encontra criada"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o e Teste: Verifica se o endere√ßo git para a vers√£o de leantime existe] ****************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /var/www/leantime/config/configuration.php] *******************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O ficheiro /var/www/leantime/config/configuration.php existe e tem as permiss√µes certas?] ***********************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: Permiss√µes correctas e ficheiro configuration.php existente"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace.] ******************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O dbUser foi alterado?] *****************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace.] **************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: a vari√°vel dbDatabase foi alterada?] ****************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o m√≥dulo replace.] **************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O dbPassword foi alterado?] *************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /etc/apache2/sites-available/leantime.conf] *******************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permiss√µes certas?] ***********************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: Permiss√µes correctas"</span>
<span style="color: #00aa00">}</span>

TASK [Simula√ß√£o: Obtem informa√ß√£o sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf] *********************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permiss√µes certas?] *************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; {</span>
<span style="color: #00aa00">    "changed": false,</span>
<span style="color: #00aa00">    "msg": "SUCESSO: Permiss√µes correctas"</span>
<span style="color: #00aa00">}</span>

PLAY RECAP *******************************************************************************************************************************
<span style="color: #00aa00">ubuntu-20.04</span>               : <span style="color: #00aa00">ok=30  </span> changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0

<span style="color: #0000aa">INFO    </span> Verifier completed successfully.
]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ molecule idempotence
<span style="color: #0000aa">INFO    </span> default scenario test matrix: idempotence
<span style="color: #0000aa">INFO    </span> Performing prerun<span style="color: #aa5500">...</span>
<span style="color: #0000aa">INFO    </span> Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
<span style="color: #0000aa">INFO    </span> Added <span style="color: #aa5500">ANSIBLE_ROLES_PATH</span>=~<span style="color: #E850A8">/.ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/usr/share/ansible/</span><span style="color: #ff90e8">roles</span>:<span style="color: #E850A8">/etc/ansible/</span><span style="color: #ff90e8">roles</span>:.<span style="color: #E850A8">/.cache/</span><span style="color: #ff90e8">roles</span>
<span style="color: #0000aa">INFO    </span> <span style="font-weight: lighter; color: #00aaaa">Running </span><span style="font-weight: lighter; color: #00aa00">default</span><span style="font-weight: lighter; color: #00aaaa"> &gt; </span><span style="font-weight: lighter; color: #00aa00">idempotence</span>

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instalar as dependencias necess√°ria ao programa leantime] *******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Instala o servi√ßo apache2 no arranque do sistema] ***************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Ativa v√°rias op√ß√µes no ficheiro php.ini, utilizando o m√≥dulo lineinfile.] ***************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})</span>

TASK [leantime_ansible : Cria a directoria tempor√°ria leantime e a directoria de apache leantime] ****************************************
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/tmp/leantime'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'path': '/var/www/leantime'})</span>

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
<span style="font-weight: bold; color: #E850A8">[WARNING]: Module did not set no_log for update_password</span>
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Faz o download do software leantime a partir do reposit√≥rio git] ************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Copia o ficheiro de configura√ß√£o configuration.sample.php] ******************************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Altera as vari√°veis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o m√≥dulo replace.] ***
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})</span>
<span style="color: #00aa00">ok: [ubuntu-20.04] =&gt; (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})</span>

TASK [leantime_ansible : Copia o template do site para a p√°sta /etc/apache2/sites-available] *********************************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

TASK [leantime_ansible : Cria um link simb√≥lico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
<span style="color: #00aa00">ok: [ubuntu-20.04]</span>

PLAY RECAP *******************************************************************************************************************************
<span style="color: #00aa00">ubuntu-20.04</span>               : <span style="color: #00aa00">ok=16  </span> changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


<span style="color: #0000aa">INFO    </span> Idempotence completed successfully.
]0;admlocal@devOps: ~/leantime_ansibleadmlocal@devOps:~/leantime_ansible$ exit
exit
