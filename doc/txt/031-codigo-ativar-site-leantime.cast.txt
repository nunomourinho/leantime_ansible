admlocal@devOps:~/leantime_ansible$ nano tasks/tasks.yml 
BBB[ A ler... ]BB[ 157 linhas lidas ]BB  GNU nano 4.8                                                tasks/tasks.yml                                                             BB^GB AjudaB^OB GravarB^WB ProcurarB^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtB^XB SairB^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txtB---- name: Atualiza a cache (equivalente a apt update)apt:update_cache: truecache_valid_time: 3600- name: "Atualiza o sistema operativo"apt:upgrade: safe- name: "Instalar as dependencias necessária ao programa leantime"apt:pkg:- mc- screen- git- apache2- mysql-server- php- php-mysql- php-ldap- php-cli- php-soap- php-json- graphviz- php-xml- php-gd- php-zip- libapache2-mod-php- php-dev- libmcrypt-dev- gcc- make- autoconf- libc-dev - autoconf    - libc-dev  - pkg-config- pwgen- curl- unzip    - zip  - php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurl   # Fonte de inspiração: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.htmlB- name: "Instala o serviço apache2 no arranque do sistema"service:name: apache2state: startedenabled: true   # Fonte: https://www.mydailytutorials.com/using-ansible-find-module-search-filesfolderB- name: "Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurse: trueregister: caminho_php_ini   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.htmlB- name: "Ativa várias opções no ficheiro php.ini, utilizando o módulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:regexp: "^file_uploads"  line: "file_uploads = 1"regexp: "^upload_max_filesize"  line: "upload_max_filesize = 1G"regexp: "^max_file_uploads"  line: "max_file_uploads = 20"regexp: "^post_max_size"  line: "post_max_size = 2G"regexp: "^memory_limit"  line: "memory_limit = 2G"- regexp: "^max_input_time" line: "max_input_time = 3600"   # Fonte: https://docs.ansible.com/ansible/2.7/modules/file_module.htmlB- name: Cria a directoria temporária leantime e a directoria de apache leantimefile:path: "{{ item.path }}"state: directory mode: 0755    owner: www-data  group: www-datawith_items:- path: "/tmp/leantime"- path: "/var/www/leantime"   # Fonte: Ansible for DevOps - Server and configuration management for humans de Jeff Geerling, página 98B   - name: "Cria a base de dados de mysql para o leantime"  mysql_db: "db=leantime_database state=present"- name: "Cria o utilizador para a base de dados leantime"mysql_user:namlogin_leantime }}"mysql_user:namlogin_leantime }}"  password: "{{ password_leantime }}"priv: "leantime_database.*:ALL"host: localhoststate: present- name: "Faz o download do software leantime a partir do repositório git"get_url:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipdest: /tmp/leantimemode: 0755   # O ficheiro Leantime-versao.zip necessita de ser descomprimidoB- name: Descomprime o software leantimeunarchive: src: "/tmp/leantime/Leantime-{{ versao_leantime }}.zip"    dest: "/var/www/leantime"  owner: www-datagroup: www-datamode: 0755remote_src: true   # Após a descompressão, se o ficheiro configuration.php não existir, este necessita de ser   # criado a partir do ficheiro configuration.sample.php   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.htmlB- name: Copia o ficheiro de configuração configuration.sample.phpansible.builtin.copy: src: /var/www/leantime/config/configuration.sample.php    dest: /var/www/leantime/config/configuration.php  owner: www-datagroup: www-data    mode: '0755'  remote_src: trueforce: false  remote_src: trueforce: false   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: Altera as variáveis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o módulo replace.ansible.builtin.replace:path: /var/www/leantime/config/configuration.php    regexp: "{{ item.regexp  }}"  replace: "{{ item.line }}"with_items:- regexp: 'dbUser=""'  line: 'dbUser="{{ login_leantime }}"'- regexp: 'dbDatabase=""' line: 'dbDatabase="leantime_database"'    - regexp: 'dbPassword=""'    line: 'dbPassword="{{ password_leantime }}"'   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.htmlB- name: Copia o template do site para a pásta /etc/apache2/sites-availableansible.builtin.template:src: leantime.template.j2dest: /etc/apache2/sites-available/leantime.confowner: root group: www-data mode: 0755BModificadoB    #B BFBoBnBtBeB:B BhBtBtBpBsB:B/B/BdBoBcBsB.BaBnBsBiBbBlBeB.BcBoBmB/BaBnBsBiBbBlBeB/BlBaBtBeBsBtB/BcBoBlBlBeBcBtBiBoBnBsB/BaBnBsBiBbBlBeB/BbBuBiBlBtBiBnB/BfBiBlBeB_BmBoBdBuBlBeB.BhBtBmBlB  - name: "Cria um link simbólico para o ficheiro leantime.conf na psta /etc/apache/sites-enabled"    ansible.builtin.file:      src: /etc/apache2/sites-available/leantime.conf      dest: /etc/apache2/sites-enabled      owner: root      group: root      mode: '0777'      state: linkm link simblico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"'
         BM-DB Formato DOSBM-AB AnexarBBB SegurançaBCB Cancelar           BM-MB Formato MacBM-PB PreporB^TB P/ ficheirosBNome do ficheiro onde escrever: tasks/tasks.yml                                                                                           B B[ A escrever... ]BB          BB[ 167 linhas escritas ]BB^OB GravarB^WB Procurar      B^KB Cortar txt    B^JB Justificar    B^CB Pos cursorBUB Desfazer     BM-AB Marcar txtBXB Sair    B^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB Refazer      BM-6B Copiar txtadmlocal@devOps:~/leantime_ansible$ molecule lint
INFO     default scenario test matrix: dependency, lint
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > dependency
WARNING  Skipping, missing the requirements file.
WARNING  Skipping, missing the requirements file.
INFO     Running default > lint
COMMAND: set -e
yamllint .
ansible-lint

./tasks/tasks.yml
  160:3     error    syntax error: expected '<document start>', but found '<block sequence start>' (syntax)

CRITICAL Lint failed with error code 1
admlocal@devOps:~/leantime_ansible$ molecule lintnano tasks/tasks.yml 
BBB[ A ler... ]BB[ 167 linhas lidas ]BB  GNU nano 4.8                                                tasks/tasks.yml                                                             BB^GB AjudaB^OB GravarB^WB ProcurarB^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtB^XB SairB^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txtB---- name: Atualiza a cache (equivalente a apt update)apt:update_cache: truecache_valid_time: 3600- name: "Atualiza o sistema operativo"apt:upgrade: safe- name: "Instalar as dependencias necessária ao programa leantime"apt:pkg:- mc- screen- git- apache2- mysql-server- php- php-mysql- php-ldap- php-cli- php-soap- php-json- graphviz- php-xml- php-gd- php-zip- libapache2-mod-php- php-dev- libmcrypt-dev- gcc- make- autoconf- libc-dev         In. parágB^YB Prim.linhaB^TB Ir para txtBCB Cancelar           BOB Fim parágBVB Últ. linhaBInsira nº da linha, nº da coluna:                                                                                                         BB1BB6BB0BB,BB3BB^OB GravarProcurar      B^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtBXB Sair    B^RB CarregarB\B Substituir    B^UB Colar txtBTB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txt - regexp: 'dbUser=""' line: 'dbUser="{{ login_leantime }}"'  - regexp: 'dbDatabase=""'  line: 'dbDatabase="leantime_database"'- regexp: 'dbPassword=""'line: 'dbPassword="{{ password_leantime }}"'   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.htmlB- name: Copia o template do site para a pásta /etc/apache2/sites-availableansible.builtin.template:    src: leantime.template.j2  dest: /etc/apache2/sites-available/leantime.confowner: rootgroup: www-datamode: 0755  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.htmlB- name: "Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"ansible.builtin.file:src: /etc/apache2/sites-available/leantime.confdest: /etc/apache2/sites-enabledowner: rootgroup: rootmode: '0777'state: link  BModificadoB   - name: "Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"         # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.html   B     ansible.builtin.file: src: /etc/apache2/sites-available/leantime.conf dest: /etc/apache2/sites-enabled owner: root group: root mode: '0777' state: link         BM-DB Formato DOSBM-AB AnexarBBB SegurançaBCB Cancelar           BM-MB Formato MacBM-PB PreporB^TB P/ ficheirosBNome do ficheiro onde escrever: tasks/tasks.yml                                                                                           B B[ A escrever... ]BB          BB[ 167 linhas escritas ]BB^OB GravarB^WB Procurar      B^KB Cortar txt    B^JB Justificar    B^CB Pos cursorBUB Desfazer     BM-AB Marcar txtBXB Sair    B^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB Refazer      BM-6B Copiar txtadmlocal@devOps:~/leantime_ansible$ nano tasks/tasks.yml molecule lint
INFO     default scenario test matrix: dependency, lint
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > dependency
WARNING  Skipping, missing the requirements file.
WARNING  Skipping, missing the requirements file.
INFO     Running default > lint
COMMAND: set -e
yamllint .
ansible-lint

Loading custom .yamllint config file, this extends our internal yamllint config.
admlocal@devOps:~/leantime_ansible$ molecule converge
INFO     default scenario test matrix: dependency, create, prepare, converge
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > dependency
WARNING  Skipping, missing the requirements file.
WARNING  Skipping, missing the requirements file.
INFO     Running default > create
WARNING  Skipping, instances already created.
INFO     Running default > prepare
WARNING  Skipping, instances already prepared.
INFO     Running default > converge

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
changed: [ubuntu-20.04]

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instalar as dependencias necessária ao programa leantime] *******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instala o serviço apache2 no arranque do sistema] ***************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Ativa várias opções no ficheiro php.ini, utilizando o módulo lineinfile.] ***************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [leantime_ansible : Cria a directoria temporária leantime e a directoria de apache leantime] ****************************************
ok: [ubuntu-20.04] => (item={'path': '/tmp/leantime'})
ok: [ubuntu-20.04] => (item={'path': '/var/www/leantime'})

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
[WARNING]: Module did not set no_log for update_password
ok: [ubuntu-20.04]

TASK [leantime_ansible : Faz o download do software leantime a partir do repositório git] ************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Copia o ficheiro de configuração configuration.sample.php] ******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Altera as variáveis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o módulo replace.] ***
ok: [ubuntu-20.04] => (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})

TASK [leantime_ansible : Copia o template do site para a pásta /etc/apache2/sites-available] *********************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
fatal: [ubuntu-20.04]: FAILED! => {"changed": false, "gid": 0, "group": "root", "mode": "0755", "msg": "refusing to convert from directory to symlink for /etc/apache2/sites-enabled", "owner": "root", "path": "/etc/apache2/sites-enabled", "size": 4096, "state": "directory", "uid": 0}

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=15   changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0


CRITICAL Ansible return code was 2, command was: ansible-playbook --inventory /home/admlocal/.cache/molecule/leantime_ansible/default/inventory --skip-tags molecule-notest,notest /home/admlocal/leantime_ansible/molecule/default/converge.yml
admlocal@devOps:~/leantime_ansible$ molecule convergelintnano tasks/tasks.yml 
BBB[ A ler... ]BB[ 167 linhas lidas ]BB  GNU nano 4.8                                                tasks/tasks.yml                                                             BB^GB AjudaB^OB GravarB^WB ProcurarB^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtB^XB SairB^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txtB---- name: Atualiza a cache (equivalente a apt update)apt:update_cache: truecache_valid_time: 3600- name: "Atualiza o sistema operativo"apt:upgrade: safe- name: "Instalar as dependencias necessária ao programa leantime"apt:pkg:- mc- screen- git- apache2- mysql-server- php- php-mysql- php-ldap- php-cli- php-soap- php-json- graphviz- php-xml- php-gd- php-zip- libapache2-mod-php- php-dev- libmcrypt-dev- gcc- make- autoconf- libc-dev - autoconf    - libc-dev  - pkg-config- pwgen- curl- unzip    - zip  - php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurl   # Fonte de inspiração: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.htmlB- name: "Instala o serviço apache2 no arranque do sistema"service:name: apache2state: startedenabled: true   # Fonte: https://www.mydailytutorials.com/using-ansible-find-module-search-filesfolderB- name: "Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurse: trueregister: caminho_php_ini   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.htmlB- name: "Ativa várias opções no ficheiro php.ini, utilizando o módulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:regexp: "^file_uploads"  line: "file_uploads = 1"regexp: "^upload_max_filesize"  line: "upload_max_filesize = 1G"regexp: "^max_file_uploads"  line: "max_file_uploads = 20"regexp: "^post_max_size"  line: "post_max_size = 2G"regexp: "^memory_limit"  line: "memory_limit = 2G"- regexp: "^max_input_time" line: "max_input_time = 3600"   # Fonte: https://docs.ansible.com/ansible/2.7/modules/file_module.htmlB- name: Cria a directoria temporária leantime e a directoria de apache leantimefile:path: "{{ item.path }}"state: directory mode: 0755    owner: www-data  group: www-datawith_items:- path: "/tmp/leantime"- path: "/var/www/leantime"   # Fonte: Ansible for DevOps - Server and configuration management for humans de Jeff Geerling, página 98B   - name: "Cria a base de dados de mysql para o leantime"  mysql_db: "db=leantime_database state=present"- name: "Cria o utilizador para a base de dados leantime"mysql_user:namlogin_leantime }}"mysql_user:namlogin_leantime }}"  password: "{{ password_leantime }}"priv: "leantime_database.*:ALL"host: localhoststate: present- name: "Faz o download do software leantime a partir do repositório git"get_url:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipdest: /tmp/leantimemode: 0755   # O ficheiro Leantime-versao.zip necessita de ser descomprimidoB- name: Descomprime o software leantimeunarchive: src: "/tmp/leantime/Leantime-{{ versao_leantime }}.zip"    dest: "/var/www/leantime"  owner: www-datagroup: www-datamode: 0755remote_src: true   # Após a descompressão, se o ficheiro configuration.php não existir, este necessita de ser   # criado a partir do ficheiro configuration.sample.php   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.htmlB- name: Copia o ficheiro de configuração configuration.sample.phpansible.builtin.copy: src: /var/www/leantime/config/configuration.sample.php    dest: /var/www/leantime/config/configuration.php  owner: www-datagroup: www-data    mode: '0755'  remote_src: trueforce: false  remote_src: trueforce: false   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: Altera as variáveis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o módulo replace.ansible.builtin.replace:path: /var/www/leantime/config/configuration.php    regexp: "{{ item.regexp  }}"  replace: "{{ item.line }}"with_items:- regexp: 'dbUser=""'  line: 'dbUser="{{ login_leantime }}"'- regexp: 'dbDatabase=""' line: 'dbDatabase="leantime_database"'    - regexp: 'dbPassword=""'    line: 'dbPassword="{{ password_leantime }}"'   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.htmlB- name: Copia o template do site para a pásta /etc/apache2/sites-availableansible.builtin.template:src: leantime.template.j2dest: /etc/apache2/sites-available/leantime.confowner: root group: www-data mode: 0755   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.htmlB- name: "Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"ansible.builtin.file:src: /etc/apache2/sites-available/leantime.confdest: /etc/apache2/sites-enabledowner: rootgroup: rootmode: '0777'state: linkmode: '0777'state: linkgroup: rootowner: rootdest: /etc/apache2/sites-enabledsrc: /etc/apache2/sites-available/leantime.confansible.builtin.file:- name: "Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.htmlBBModificadoBleantime.conf
leantime.conf
/leantime.conf
         BM-DB Formato DOSBM-AB AnexarBBB SegurançaBCB Cancelar           BM-MB Formato MacBM-PB PreporB^TB P/ ficheirosBNome do ficheiro onde escrever: tasks/tasks.yml                                                                                           B B[ A escrever... ]BB          BB[ 167 linhas escritas ]BB^OB GravarB^WB Procurar      B^KB Cortar txt    B^JB Justificar    B^CB Pos cursorBUB Desfazer     BM-AB Marcar txtBXB Sair    B^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB Refazer      BM-6B Copiar txtadmlocal@devOps:~/leantime_ansible$ nano tasks/tasks.yml molecule converge
INFO     default scenario test matrix: dependency, create, prepare, converge
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > dependency
WARNING  Skipping, missing the requirements file.
WARNING  Skipping, missing the requirements file.
INFO     Running default > create
WARNING  Skipping, instances already created.
INFO     Running default > prepare
WARNING  Skipping, instances already prepared.
INFO     Running default > converge

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instalar as dependencias necessária ao programa leantime] *******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instala o serviço apache2 no arranque do sistema] ***************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Ativa várias opções no ficheiro php.ini, utilizando o módulo lineinfile.] ***************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [leantime_ansible : Cria a directoria temporária leantime e a directoria de apache leantime] ****************************************
ok: [ubuntu-20.04] => (item={'path': '/tmp/leantime'})
ok: [ubuntu-20.04] => (item={'path': '/var/www/leantime'})

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
[WARNING]: Module did not set no_log for update_password
ok: [ubuntu-20.04]

TASK [leantime_ansible : Faz o download do software leantime a partir do repositório git] ************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Copia o ficheiro de configuração configuration.sample.php] ******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Altera as variáveis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o módulo replace.] ***
ok: [ubuntu-20.04] => (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})

TASK [leantime_ansible : Copia o template do site para a pásta /etc/apache2/sites-available] *********************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
changed: [ubuntu-20.04]

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=16   changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


admlocal@devOps:~/leantime_ansible$ molecule convergeidempotence
INFO     default scenario test matrix: idempotence
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > idempotence

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instalar as dependencias necessária ao programa leantime] *******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instala o serviço apache2 no arranque do sistema] ***************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Ativa várias opções no ficheiro php.ini, utilizando o módulo lineinfile.] ***************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [leantime_ansible : Cria a directoria temporária leantime e a directoria de apache leantime] ****************************************
ok: [ubuntu-20.04] => (item={'path': '/tmp/leantime'})
ok: [ubuntu-20.04] => (item={'path': '/var/www/leantime'})

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
[WARNING]: Module did not set no_log for update_password
ok: [ubuntu-20.04]

TASK [leantime_ansible : Faz o download do software leantime a partir do repositório git] ************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Copia o ficheiro de configuração configuration.sample.php] ******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Altera as variáveis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o módulo replace.] ***
ok: [ubuntu-20.04] => (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})

TASK [leantime_ansible : Copia o template do site para a pásta /etc/apache2/sites-available] *********************************************
changed: [ubuntu-20.04]

TASK [leantime_ansible : Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
changed: [ubuntu-20.04]

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=16   changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


CRITICAL Idempotence test failed because of the following tasks:
*  => leantime_ansible : Copia o template do site para a pásta /etc/apache2/sites-available
*  => leantime_ansible : Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled
admlocal@devOps:~/leantime_ansible$ nano tasks/
BBB[ "tasks/" é uma pasta ]BB  GNU nano 4.8                                                  Novo buffer                                                               BB^GB AjudaB^OB GravarB^WB ProcurarB^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtB^XB SairB^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txtBadmlocal@devOps:~/leantime_ansible$ nano tasks/tasks.yml 
BBB[ A ler... ]BB[ 167 linhas lidas ]BB  GNU nano 4.8                                                tasks/tasks.yml                                                             BB^GB AjudaB^OB GravarB^WB ProcurarB^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtB^XB SairB^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txtB---- name: Atualiza a cache (equivalente a apt update)apt:update_cache: truecache_valid_time: 3600- name: "Atualiza o sistema operativo"apt:upgrade: safe- name: "Instalar as dependencias necessária ao programa leantime"apt:pkg:- mc- screen- git- apache2- mysql-server- php- php-mysql- php-ldap- php-cli- php-soap- php-json- graphviz- php-xml- php-gd- php-zip- libapache2-mod-php- php-dev- libmcrypt-dev- gcc- make- autoconf- libc-dev - autoconf    - libc-dev  - pkg-config- pwgen- curl- unzip    - zip  - php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurl   # Fonte de inspiração: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.htmlB- name: "Instala o serviço apache2 no arranque do sistema"service:name: apache2state: startedenabled: true   # Fonte: https://www.mydailytutorials.com/using-ansible-find-module-search-filesfolderB- name: "Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurse: trueregister: caminho_php_ini   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.htmlB- name: "Ativa várias opções no ficheiro php.ini, utilizando o módulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:regexp: "^file_uploads"  line: "file_uploads = 1"regexp: "^upload_max_filesize"  line: "upload_max_filesize = 1G"regexp: "^max_file_uploads"  line: "max_file_uploads = 20"regexp: "^post_max_size"  line: "post_max_size = 2G"regexp: "^memory_limit"  line: "memory_limit = 2G"- regexp: "^max_input_time" line: "max_input_time = 3600"   # Fonte: https://docs.ansible.com/ansible/2.7/modules/file_module.htmlB- name: Cria a directoria temporária leantime e a directoria de apache leantimefile:path: "{{ item.path }}"state: directory mode: 0755    owner: www-data  group: www-datawith_items:- path: "/tmp/leantime"- path: "/var/www/leantime"   # Fonte: Ansible for DevOps - Server and configuration management for humans de Jeff Geerling, página 98B   - name: "Cria a base de dados de mysql para o leantime"  mysql_db: "db=leantime_database state=present"- name: "Cria o utilizador para a base de dados leantime"mysql_user:namlogin_leantime }}"mysql_user:namlogin_leantime }}"  password: "{{ password_leantime }}"priv: "leantime_database.*:ALL"host: localhoststate: present- name: "Faz o download do software leantime a partir do repositório git"get_url:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipdest: /tmp/leantimemode: 0755   # O ficheiro Leantime-versao.zip necessita de ser descomprimidoB- name: Descomprime o software leantimeunarchive: src: "/tmp/leantime/Leantime-{{ versao_leantime }}.zip"    dest: "/var/www/leantime"  owner: www-datagroup: www-datamode: 0755remote_src: true   # Após a descompressão, se o ficheiro configuration.php não existir, este necessita de ser   # criado a partir do ficheiro configuration.sample.php   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.htmlB- name: Copia o ficheiro de configuração configuration.sample.phpansible.builtin.copy: src: /var/www/leantime/config/configuration.sample.php    dest: /var/www/leantime/config/configuration.php  owner: www-datagroup: www-data    mode: '0755'  remote_src: trueforce: false  remote_src: trueforce: false   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: Altera as variáveis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o módulo replace.ansible.builtin.replace:path: /var/www/leantime/config/configuration.php    regexp: "{{ item.regexp  }}"  replace: "{{ item.line }}"with_items:- regexp: 'dbUser=""'  line: 'dbUser="{{ login_leantime }}"'- regexp: 'dbDatabase=""' line: 'dbDatabase="leantime_database"'    - regexp: 'dbPassword=""'    line: 'dbPassword="{{ password_leantime }}"'   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.htmlB- name: Copia o template do site para a pásta /etc/apache2/sites-availableansible.builtin.template:src: leantime.template.j2dest: /etc/apache2/sites-available/leantime.confowner: root group: www-data mode: 0755   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.htmlB- name: "Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"ansible.builtin.file:src: /etc/apache2/sites-available/leantime.confdest: /etc/apache2/sites-enabled/leantime.confowner: rootgroup: rootmode: '0777'state: linkmode: '0777'state: linkgroup: rootowner: rootdest: /etc/apache2/sites-enabled/leantime.confsrc: /etc/apache2/sites-available/leantime.confansible.builtin.file:- name: "Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.htmlBmode: 0755group: www-dataowner: rootdest: /etc/apache2/sites-available/leantime.confsrc: leantime.template.j2ansible.builtin.template:- name: Copia o template do site para a pásta /etc/apache2/sites-available   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.htmlBline: 'dbPassword="{{ password_leantime }}"'- regexp: 'dbPassword=""'line: 'dbDatabase="leantime_database"'- regexp: 'dbDatabase=""'line: 'dbUser="{{ login_leantime }}"'- regexp: 'dbUser=""'with_items:replace: "{{ item.line }}"regexp: "{{ item.regexp  }}"path: /var/www/leantime/config/configuration.phpansible.builtin.replace:- name: Altera as variáveis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o módulo replace.   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlBforce: falseremote_src: truemode: '0755'group: www-dataowner: www-datadest: /var/www/leantime/config/configuration.phpsrc: /var/www/leantime/config/configuration.sample.phpansible.builtin.copy:- name: Copia o ficheiro de configuração configuration.sample.php   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.htmlBBModificadoB
- name: "Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"force: false
- name: "Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"
ansible.builtin.file:
src: /etc/apache2/sites-available/leantime.conf
dest: /etc/apache2/sites-enabled/leantime.conf
owner: root
group: root
mode: '0777'
state: link
force: false         BM-DB Formato DOSBM-AB AnexarBBB SegurançaBCB Cancelar           BM-MB Formato MacBM-PB PreporB^TB P/ ficheirosBNome do ficheiro onde escrever: tasks/tasks.yml                                                                                           B B[ A escrever... ]BB          BB[ 168 linhas escritas ]BB^OB GravarB^WB Procurar      B^KB Cortar txt    B^JB Justificar    B^CB Pos cursorBUB Desfazer     BM-AB Marcar txtBXB Sair    B^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB Refazer      BM-6B Copiar txtadmlocal@devOps:~/leantime_ansible$ nano tasks/tasks.yml molecule idempotenceconverge
INFO     default scenario test matrix: dependency, create, prepare, converge
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > dependency
WARNING  Skipping, missing the requirements file.
WARNING  Skipping, missing the requirements file.
INFO     Running default > create
WARNING  Skipping, instances already created.
INFO     Running default > prepare
WARNING  Skipping, instances already prepared.
INFO     Running default > converge

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instalar as dependencias necessária ao programa leantime] *******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instala o serviço apache2 no arranque do sistema] ***************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Ativa várias opções no ficheiro php.ini, utilizando o módulo lineinfile.] ***************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [leantime_ansible : Cria a directoria temporária leantime e a directoria de apache leantime] ****************************************
ok: [ubuntu-20.04] => (item={'path': '/tmp/leantime'})
ok: [ubuntu-20.04] => (item={'path': '/var/www/leantime'})

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
[WARNING]: Module did not set no_log for update_password
ok: [ubuntu-20.04]

TASK [leantime_ansible : Faz o download do software leantime a partir do repositório git] ************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Copia o ficheiro de configuração configuration.sample.php] ******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Altera as variáveis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o módulo replace.] ***
ok: [ubuntu-20.04] => (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})

TASK [leantime_ansible : Copia o template do site para a pásta /etc/apache2/sites-available] *********************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
ok: [ubuntu-20.04]

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=16   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


admlocal@devOps:~/leantime_ansible$ molecule convergeidempotence
INFO     default scenario test matrix: idempotence
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > idempotence

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instalar as dependencias necessária ao programa leantime] *******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instala o serviço apache2 no arranque do sistema] ***************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Ativa várias opções no ficheiro php.ini, utilizando o módulo lineinfile.] ***************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [leantime_ansible : Cria a directoria temporária leantime e a directoria de apache leantime] ****************************************
ok: [ubuntu-20.04] => (item={'path': '/tmp/leantime'})
ok: [ubuntu-20.04] => (item={'path': '/var/www/leantime'})

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
[WARNING]: Module did not set no_log for update_password
ok: [ubuntu-20.04]

TASK [leantime_ansible : Faz o download do software leantime a partir do repositório git] ************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Copia o ficheiro de configuração configuration.sample.php] ******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Altera as variáveis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o módulo replace.] ***
ok: [ubuntu-20.04] => (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})

TASK [leantime_ansible : Copia o template do site para a pásta /etc/apache2/sites-available] *********************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
ok: [ubuntu-20.04]

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=16   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


INFO     Idempotence completed successfully.
admlocal@devOps:~/leantime_ansible$ molecule verify
INFO     default scenario test matrix: verify
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > verify
INFO     Running Ansible Verifier

PLAY [Infraestrutura conduzida por testes] ***********************************************************************************************

TASK [Variáveis] *************************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Atualizar a cache do sistema] *******************************************************************************************
ok: [ubuntu-20.04]

TASK [teste: a cache encontra-se actualizada?] *******************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Atualizar o sistema operativo (equivalente a apt upgrade)] *************************************************************************
ok: [ubuntu-20.04]

TASK [teste: o sistema operativo encontra-se atualizado?] ********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O sistema operativo está atualizado"
}

TASK [Teste: a cache encontra-se atualizada?] ********************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Simulação: testa se as aplicações dependencia do software leantime se encontram instaladas] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: as dependencias encontra-se instaladas?] ************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: As dependencias estavam instaladas"
}

TASK [Simulação: Testar se o serviço apache2 se encontra instalado, iniciado e ativo no arranque] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: O serviço apache2 encontra-se ativo no arranque no sistema, e está iniciado?] ***********************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O serviço apache2 está correctamente instalado e inicia com o arranque do sistema"
}

TASK [Rotina Auxiliar> Procura o caminho do ficheiro php.ini do servidor apache2] ********************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Ativa a opção file_uploads no ficheiro php.ini, utilizando o módulo lineinfile.] ****************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [Teste: As linhas do php.ini encontram-se alteradas ?] ******************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O ficheiro php.ini foi alterado com sucesso"
}

TASK [Simulação: Obtem informação sobre a pastas /var/www/leantime] **********************************************************************
ok: [ubuntu-20.04]

TASK [Teste: A pasta /var/www/leantime existe e tem as permissões certas?] ***************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas no site leantime"
}

TASK [Simulação: Verifica se é necessário criar a base de dados leantime_database] *******************************************************
ok: [ubuntu-20.04]

TASK [Teste: A base de dados leantime_database existe ?] *********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A base de dados leantime_database já se encontra criada"
}

TASK [Simulação e Teste: Verifica se o endereço git para a versão de leantime existe] ****************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Obtem informação sobre o ficheiro /var/www/leantime/config/configuration.php] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /var/www/leantime/config/configuration.php existe e tem as permissões certas?] ***********************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas e ficheiro configuration.php existente"
}

TASK [Simulação: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o módulo replace.] ******************************
ok: [ubuntu-20.04]

TASK [Teste: O dbUser foi alterado?] *****************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: a variável dbDatabase foi alterada?] ****************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: O dbPassword foi alterado?] *************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-available/leantime.conf] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?] ***********************************
fatal: [ubuntu-20.04]: FAILED! => {
    "assertion": "ficheiro.stat.mode == \"0755\"",
    "changed": false,
    "evaluated_to": false,
    "msg": "ERRO: Permissões incorrectas"
}

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=27   changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0


CRITICAL Ansible return code was 2, command was: ansible-playbook --inventory /home/admlocal/.cache/molecule/leantime_ansible/default/inventory --skip-tags molecule-notest,notest /home/admlocal/leantime_ansible/molecule/default/verify.yml
admlocal@devOps:~/leantime_ansible$ molecule verifyidempotenceconvergenano tasks/tasks.yml 
BBB[ A ler... ]BB[ 168 linhas lidas ]BB  GNU nano 4.8                                                tasks/tasks.yml                                                             BB^GB AjudaB^OB GravarB^WB ProcurarB^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtB^XB SairB^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txtB---- name: Atualiza a cache (equivalente a apt update)apt:update_cache: truecache_valid_time: 3600- name: "Atualiza o sistema operativo"apt:upgrade: safe- name: "Instalar as dependencias necessária ao programa leantime"apt:pkg:- mc- screen- git- apache2- mysql-server- php- php-mysql- php-ldap- php-cli- php-soap- php-json- graphviz- php-xml- php-gd- php-zip- libapache2-mod-php- php-dev- libmcrypt-dev- gcc- make- autoconf- libc-dev - autoconf    - libc-dev  - pkg-config- pwgen- curl- unzip    - zip  - php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurl   # Fonte de inspiração: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.htmlB- name: "Instala o serviço apache2 no arranque do sistema"service:name: apache2state: startedenabled: true   # Fonte: https://www.mydailytutorials.com/using-ansible-find-module-search-filesfolderB- name: "Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurse: trueregister: caminho_php_ini   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.htmlB- name: "Ativa várias opções no ficheiro php.ini, utilizando o módulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:regexp: "^file_uploads"  line: "file_uploads = 1"regexp: "^upload_max_filesize"  line: "upload_max_filesize = 1G"regexp: "^max_file_uploads"  line: "max_file_uploads = 20"regexp: "^post_max_size"  line: "post_max_size = 2G"regexp: "^memory_limit"  line: "memory_limit = 2G"- regexp: "^max_input_time" line: "max_input_time = 3600"   # Fonte: https://docs.ansible.com/ansible/2.7/modules/file_module.htmlB- name: Cria a directoria temporária leantime e a directoria de apache leantimefile:path: "{{ item.path }}"state: directory mode: 0755    owner: www-data  group: www-datawith_items:- path: "/tmp/leantime"- path: "/var/www/leantime"   # Fonte: Ansible for DevOps - Server and configuration management for humans de Jeff Geerling, página 98B   - name: "Cria a base de dados de mysql para o leantime"  mysql_db: "db=leantime_database state=present"- name: "Cria o utilizador para a base de dados leantime"mysql_user:namlogin_leantime }}"mysql_user:namlogin_leantime }}"  password: "{{ password_leantime }}"priv: "leantime_database.*:ALL"host: localhoststate: present- name: "Faz o download do software leantime a partir do repositório git"get_url:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipdest: /tmp/leantimemode: 0755   # O ficheiro Leantime-versao.zip necessita de ser descomprimidoB- name: Descomprime o software leantimeunarchive: src: "/tmp/leantime/Leantime-{{ versao_leantime }}.zip"    dest: "/var/www/leantime"  owner: www-datagroup: www-datamode: 0755remote_src: true   # Após a descompressão, se o ficheiro configuration.php não existir, este necessita de ser   # criado a partir do ficheiro configuration.sample.php   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.htmlB- name: Copia o ficheiro de configuração configuration.sample.phpansible.builtin.copy: src: /var/www/leantime/config/configuration.sample.php    dest: /var/www/leantime/config/configuration.php  owner: www-datagroup: www-data    mode: '0755'  remote_src: trueforce: false  remote_src: trueforce: false   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: Altera as variáveis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o módulo replace.ansible.builtin.replace:path: /var/www/leantime/config/configuration.php    regexp: "{{ item.regexp  }}"  replace: "{{ item.line }}"with_items:- regexp: 'dbUser=""'  line: 'dbUser="{{ login_leantime }}"'- regexp: 'dbDatabase=""' line: 'dbDatabase="leantime_database"'    - regexp: 'dbPassword=""'    line: 'dbPassword="{{ password_leantime }}"'   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.htmlB- name: Copia o template do site para a pásta /etc/apache2/sites-availableansible.builtin.template:src: leantime.template.j2dest: /etc/apache2/sites-available/leantime.confowner: root group: www-data mode: 0755 force: false   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.htmlB- name: "Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"ansible.builtin.file:src: /etc/apache2/sites-available/leantime.confdest: /etc/apache2/sites-enabled/leantime.confowner: rootgroup: rootmode: '0777'group: rootmode: '0777'state: linkBModificadoB''5'55'         BM-DB Formato DOSBM-AB AnexarBBB SegurançaBCB Cancelar           BM-MB Formato MacBM-PB PreporB^TB P/ ficheirosBNome do ficheiro onde escrever: tasks/tasks.yml                                                                                           B B[ A escrever... ]BB          BB[ 168 linhas escritas ]BB^OB GravarB^WB Procurar      B^KB Cortar txt    B^JB Justificar    B^CB Pos cursorBUB Desfazer     BM-AB Marcar txtBXB Sair    B^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB Refazer      BM-6B Copiar txtadmlocal@devOps:~/leantime_ansible$ nano tasks/tasks.yml molecule verifyidempotenceconverge
INFO     default scenario test matrix: dependency, create, prepare, converge
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > dependency
WARNING  Skipping, missing the requirements file.
WARNING  Skipping, missing the requirements file.
INFO     Running default > create
WARNING  Skipping, instances already created.
INFO     Running default > prepare
WARNING  Skipping, instances already prepared.
INFO     Running default > converge

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instalar as dependencias necessária ao programa leantime] *******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instala o serviço apache2 no arranque do sistema] ***************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Ativa várias opções no ficheiro php.ini, utilizando o módulo lineinfile.] ***************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [leantime_ansible : Cria a directoria temporária leantime e a directoria de apache leantime] ****************************************
ok: [ubuntu-20.04] => (item={'path': '/tmp/leantime'})
ok: [ubuntu-20.04] => (item={'path': '/var/www/leantime'})

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
[WARNING]: Module did not set no_log for update_password
ok: [ubuntu-20.04]

TASK [leantime_ansible : Faz o download do software leantime a partir do repositório git] ************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Copia o ficheiro de configuração configuration.sample.php] ******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Altera as variáveis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o módulo replace.] ***
ok: [ubuntu-20.04] => (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})

TASK [leantime_ansible : Copia o template do site para a pásta /etc/apache2/sites-available] *********************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
changed: [ubuntu-20.04]

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=16   changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


admlocal@devOps:~/leantime_ansible$ molecule convergeidempotenece
Usage: molecule [OPTIONS] COMMAND [ARGS]...
Try "molecule --help" for help.

Error: No such command "idempotece".
admlocal@devOps:~/leantime_ansible$ molecule idempotecence
INFO     default scenario test matrix: idempotence
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > idempotence

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instalar as dependencias necessária ao programa leantime] *******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instala o serviço apache2 no arranque do sistema] ***************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Ativa várias opções no ficheiro php.ini, utilizando o módulo lineinfile.] ***************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [leantime_ansible : Cria a directoria temporária leantime e a directoria de apache leantime] ****************************************
ok: [ubuntu-20.04] => (item={'path': '/tmp/leantime'})
ok: [ubuntu-20.04] => (item={'path': '/var/www/leantime'})

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
[WARNING]: Module did not set no_log for update_password
ok: [ubuntu-20.04]

TASK [leantime_ansible : Faz o download do software leantime a partir do repositório git] ************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Copia o ficheiro de configuração configuration.sample.php] ******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Altera as variáveis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o módulo replace.] ***
ok: [ubuntu-20.04] => (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})

TASK [leantime_ansible : Copia o template do site para a pásta /etc/apache2/sites-available] *********************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
ok: [ubuntu-20.04]

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=16   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


INFO     Idempotence completed successfully.
admlocal@devOps:~/leantime_ansible$ molecule idempotenceverify
INFO     default scenario test matrix: verify
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > verify
INFO     Running Ansible Verifier

PLAY [Infraestrutura conduzida por testes] ***********************************************************************************************

TASK [Variáveis] *************************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Atualizar a cache do sistema] *******************************************************************************************
ok: [ubuntu-20.04]

TASK [teste: a cache encontra-se actualizada?] *******************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Atualizar o sistema operativo (equivalente a apt upgrade)] *************************************************************************
ok: [ubuntu-20.04]

TASK [teste: o sistema operativo encontra-se atualizado?] ********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O sistema operativo está atualizado"
}

TASK [Teste: a cache encontra-se atualizada?] ********************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Simulação: testa se as aplicações dependencia do software leantime se encontram instaladas] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: as dependencias encontra-se instaladas?] ************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: As dependencias estavam instaladas"
}

TASK [Simulação: Testar se o serviço apache2 se encontra instalado, iniciado e ativo no arranque] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: O serviço apache2 encontra-se ativo no arranque no sistema, e está iniciado?] ***********************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O serviço apache2 está correctamente instalado e inicia com o arranque do sistema"
}

TASK [Rotina Auxiliar> Procura o caminho do ficheiro php.ini do servidor apache2] ********************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Ativa a opção file_uploads no ficheiro php.ini, utilizando o módulo lineinfile.] ****************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [Teste: As linhas do php.ini encontram-se alteradas ?] ******************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O ficheiro php.ini foi alterado com sucesso"
}

TASK [Simulação: Obtem informação sobre a pastas /var/www/leantime] **********************************************************************
ok: [ubuntu-20.04]

TASK [Teste: A pasta /var/www/leantime existe e tem as permissões certas?] ***************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas no site leantime"
}

TASK [Simulação: Verifica se é necessário criar a base de dados leantime_database] *******************************************************
ok: [ubuntu-20.04]

TASK [Teste: A base de dados leantime_database existe ?] *********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A base de dados leantime_database já se encontra criada"
}

TASK [Simulação e Teste: Verifica se o endereço git para a versão de leantime existe] ****************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Obtem informação sobre o ficheiro /var/www/leantime/config/configuration.php] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /var/www/leantime/config/configuration.php existe e tem as permissões certas?] ***********************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas e ficheiro configuration.php existente"
}

TASK [Simulação: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o módulo replace.] ******************************
ok: [ubuntu-20.04]

TASK [Teste: O dbUser foi alterado?] *****************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: a variável dbDatabase foi alterada?] ****************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: O dbPassword foi alterado?] *************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-available/leantime.conf] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?] ***********************************
fatal: [ubuntu-20.04]: FAILED! => {
    "assertion": "ficheiro.stat.gr_name == \"www-data\"",
    "changed": false,
    "evaluated_to": false,
    "msg": "ERRO: Permissões incorrectas"
}

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=27   changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0


CRITICAL Ansible return code was 2, command was: ansible-playbook --inventory /home/admlocal/.cache/molecule/leantime_ansible/default/inventory --skip-tags molecule-notest,notest /home/admlocal/leantime_ansible/molecule/default/verify.yml
admlocal@devOps:~/leantime_ansible$ nano molecule/default/verify.yml 
BBB[ A ler... ]BB[ 302 linhas lidas ]BB  GNU nano 4.8                                          molecule/default/verify.yml                                                       BB^GB AjudaB^OB GravarB^WB ProcurarB^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtB^XB SairB^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txtB---# Tutorial de inspiração para a infraestrutura conduzida por teste no site# https://www.adictosaltrabajo.com/2020/05/08/ansible-testing-using-molecule-with-ansible-as-verifier/B- name: "Infraestrutura conduzida por testes"hosts: allgather_facts: falsebecome: truetasks:- name: Variáveisinclude_vars:file: ../../vars/main.yml- name: "Simulação: Atualizar a cache do sistema"apt:update_cache: truecache_valid_time: 3600check_mode: trueregister: estado- name: "teste: a cache encontra-se actualizada?"assert:that:- not estado.changedsuccess_msg: "SUCESSO: A cache está atualizada"fail_msg: "ERRO: Existem actualizações pendentes"- name: "Atualizar o sistema operativo (equivalente a apt upgrade)"apt:upgrade: safecheck_mode: trueregister: estado- name: "teste: o sistema operativo encontra-se atualizado?"  - name: "teste: o sistema operativo encontra-se atualizado?"    assert:that: - not estado.changed    success_msg: "SUCESSO: O sistema operativo está atualizado"    fail_msg: "ERRO: Existem actualizações pendentes"  - name: "Teste: a cache encontra-se atualizada?"  assert:    that:  - not estado.changedsuccess_msg: "SUCESSO: A cache está atualizada"fail_msg: "ERRO: Existem atualizações pendentes"  - name: "Simulação: testa se as aplicações dependencia do software leantime se encontram instaladas"apt:pkg:  - mc  - screen- git    - apache2  - mysql-server- phpphp-mysql- php-ldap- php-cli- php-soap    - php-json  - graphviz- php-xml  - php-gd  - php-zip- libapache2-mod-php    - php-dev- libapache2-mod-php    - php-dev  - libmcrypt-dev- gccmake- autoconf- libc-dev- pkg-config    - pwgen  - curl- unzipzip- php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurlcheck_mode: trueregister: estado  - name: "Teste: as dependencias encontra-se instaladas?"assert:that:not estado.changedsuccess_msg: "SUCESSO: As dependencias estavam instaladas"fail_msg: "ERRO: Faltam instalar algumas dependencias. O software pode estar parcialmente instalado"  # Fonte de inspiração: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.htmlB- name: "Simulação: Testar se o serviço apache2 se encontra instalado, iniciado e ativo no arranque"service:name: apache2state: startedenabled: truecheck_mode: trueenabled: trueO serviço apache2 encontra-se ativo no arranque no sistema, e está iniciado?"O serviço apache2 está correctamente instalado e inicia com o arranque do sistema"O serviço apache2 não se encontra correcta: https://www.mydailytutorials.com/using--find-module-search-filesfolderBRotina Auxiliar> Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurseregister: caminho_php_ini  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.htmlB- name: "Simulação: Ativa a opção file_uploads no ficheiro php.ini, utilizando o módulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:- regexp: "^file_uploads"line: "file_uploads = 1"- regexp: "^upload_max_filesize"line: "upload_max_filesize = 1G"- regexp: "^max_file_uploads"line: "max_file_uploads = 20"- regexp: "^post_max_size"line: "post_max_size = 2G"- regexp: "^memory_limit"line: "post_max_size = 2G"- regexp: "^memory_limit"line: "memory_limit = 2G"- regexp: "^max_input_time"  line: "max_input_time = 3600"As linhas do php.ini encontram-se alteradas ?"ficheiro php.ini foi alterado com sucesso"Algumas alterações ao ficheiro php.ini não tiveram sucesso"O site deve existir na pasta /var/www/leantime. Este teste visa determinar se a pasta  # existe e se temas permissões certas  # Fonte de inspiração: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre a pastas /var/www/leantime"    stat:    path: "/var/www/leantime"register: pasta  - name: "Teste: A pasta /var/www/leantime existe e tem as permissões certas?"assert:  that:  - pasta.stat.exists- pasta.stat.isdir  - pasta.stat.mode == "0755"- pasta.stat.pw_name == "www-data"  - pasta.stat.gr_name == "www-data"success_msg: "SUCESSO: Permissões correctas no site leantime"fail_msg: "ERRO: Permissões incorrectas no site leantime ou site não existente"  # Outro dos requesitos é a existência de uma base de dados para o site.B  # Outro dos requesitos é a existência de uma base de dados para o site.  # Esta base de dados deve ser criada, logo tem de ser testada para determinar se ela existe ou não.  # Fonte de inspiração: https://serverfault.com/questions/173978/from-a-shell-script-how-can-i-check-whether-a-mysql-database-existsB- name: "Simulação: Verifica se é necessário criar a base de dados leantime_database"shell: "mysql -u root -e 'use leantime_database'"resultfailed_when: false  changed_when: false  - name: "Teste: A base de dados leantime_database existe ?"assert:that:- result.rc == 0success_msg: "SUCESSO: A base de dados leantime_database já se encontra criada"fail_msg: "ERRO: Não existe a base de dados leantime_database"  # Teste: O download do software leantime deve ser possível, a partir do site do leantimeB- name: "Simulação e Teste: Verifica se o endereço git para a versão de leantime existe"uri:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipregister: resultadoTeste: Do ficheiro configuration.php no site do leantime. A existência deste ficheiro       com as permissões certas indica que o processo de unzip correu bemDocumentação oficial em: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlBo ficheiro /var/www/leantime/config/configuration.php"/config/configuration.php"ficheiroO ficheiro /var/www/leantime/config/configuration.php existe e tem as permissões certas?"ficheiro.stat.existsthat: - ficheiro.stat.exists - ficheiro.stat.isreg - ficheiro.stat.mode == "0755" - ficheiro.stat.pw_name == "www-data"    - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permissões correctas e ficheiro configuration.php existente"  fail_msg: "ERRO: Permissões incorrectas ou ficheiro configuration.php não existente"  # Teste: O ficheiro /var/www/leantime/config/configuration.php necessita de ser alterado.  # As variáveis dbuser, dbDatabase, e dbPassword necessitam de estar configuradas.  # Por simulação o sistema vai determinar se estas estão configuradas com o valor esperado.  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbUser=""' replace: 'dbUser="{{ login_leantime }}"'  check_mode: yesregister: conffailed_when: false  - name: "Teste: O dbUser foi alterado?"    assert: that: - conf is not changed    - conf is not failed  success_msg: "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"fail_msg: "ERRO: O dbUser não foi alterado no ficheiro configuration.php"  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.php    ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbDatabase=""'replace: 'dbDatabase="leantime_database"'check_mode: yesregister: conffailed_when: false  - name: "Teste: a variável dbDatabase foi alterada?"    assert: that: - conf is not changed - conf is not failed    success_msg: "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"  fail_msg: "ERRO: O dbDatabase não foi alterado no ficheiro configuration.php"  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:  path: /var/www/leantime/config/configuration.php  regexp: 'dbPassword=""'replace: 'dbPassword="{{ password_leantime }}"'  check_mode: yesregister: conffailed_when: false  - name: "Teste: O dbPassword foi alterado?"assert:that:- conf is not changed- conf is not failed success_msg: "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"    fail_msg: "ERRO: O dbPassword não foi alterado no ficheiro configuration.php"  # A configuração do site leantime necessita que seja criado um site através de um ficheiro deB  # A configuração do site leantime necessita que seja criado um site através de um ficheiro de  # configuração, dentro das pasta do apache2. Deve existir um ficheiro de configuração do  # leantime em (/etc/apache2/sites-availableB  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-available/leantime.conf"stat:path: "/etc/apache2/sites-available/leantime.conf"  register: ficheiro  - name: "Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.isreg- ficheiro.stat.mode == "0755" - ficheiro.stat.pw_name == "root" - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permissões correctas"fail_msg: "ERRO: Permissões incorrectas"  # O site deve estar ativo no apache. Este teste vai verificar se o site se encontra ativo  # https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf"stat:path: "/etc/apache2/sites-enabled/leantime.conf"  register: ficheiro  - name: "Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permissões certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.islnk- ficheiro.stat.mode == "0777" - ficheiro.stat.pw_name == "root"77root"- ficheiro.stat.islnk- ficheiro.stat.existsthat:assert:- name: "Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permissões certas?"admlocal@devOps:~/leantime_ansible$ nano molecule/default/verify.yml 
BBB[ A ler... ]BB[ 302 linhas lidas ]BB  GNU nano 4.8                                          molecule/default/verify.yml                                                       BB^GB AjudaB^OB GravarB^WB ProcurarB^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtB^XB SairB^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txtB---# Tutorial de inspiração para a infraestrutura conduzida por teste no site# https://www.adictosaltrabajo.com/2020/05/08/ansible-testing-using-molecule-with-ansible-as-verifier/B- name: "Infraestrutura conduzida por testes"hosts: allgather_facts: falsebecome: truetasks:- name: Variáveisinclude_vars:file: ../../vars/main.yml- name: "Simulação: Atualizar a cache do sistema"apt:update_cache: truecache_valid_time: 3600check_mode: trueregister: estado- name: "teste: a cache encontra-se actualizada?"assert:that:- not estado.changedsuccess_msg: "SUCESSO: A cache está atualizada"fail_msg: "ERRO: Existem actualizações pendentes"- name: "Atualizar o sistema operativo (equivalente a apt upgrade)"apt:upgrade: safecheck_mode: trueregister: estado- name: "teste: o sistema operativo encontra-se atualizado?"  - name: "teste: o sistema operativo encontra-se atualizado?"    assert:that: - not estado.changed    success_msg: "SUCESSO: O sistema operativo está atualizado"    fail_msg: "ERRO: Existem actualizações pendentes"  - name: "Teste: a cache encontra-se atualizada?"  assert:    that:  - not estado.changedsuccess_msg: "SUCESSO: A cache está atualizada"fail_msg: "ERRO: Existem atualizações pendentes"  - name: "Simulação: testa se as aplicações dependencia do software leantime se encontram instaladas"apt:pkg:  - mc  - screen- git    - apache2  - mysql-server- phpphp-mysql- php-ldap- php-cli- php-soap    - php-json  - graphviz- php-xml  - php-gd  - php-zip- libapache2-mod-php    - php-dev- libapache2-mod-php    - php-dev  - libmcrypt-dev- gccmake- autoconf- libc-dev- pkg-config    - pwgen  - curl- unzipzip- php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurlcheck_mode: trueregister: estado  - name: "Teste: as dependencias encontra-se instaladas?"assert:that:not estado.changedsuccess_msg: "SUCESSO: As dependencias estavam instaladas"fail_msg: "ERRO: Faltam instalar algumas dependencias. O software pode estar parcialmente instalado"  # Fonte de inspiração: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.htmlB- name: "Simulação: Testar se o serviço apache2 se encontra instalado, iniciado e ativo no arranque"service:name: apache2state: startedenabled: truecheck_mode: trueenabled: trueO serviço apache2 encontra-se ativo no arranque no sistema, e está iniciado?"O serviço apache2 está correctamente instalado e inicia com o arranque do sistema"O serviço apache2 não se encontra correcta: https://www.mydailytutorials.com/using--find-module-search-filesfolderBRotina Auxiliar> Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurseregister: caminho_php_ini  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.htmlB- name: "Simulação: Ativa a opção file_uploads no ficheiro php.ini, utilizando o módulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:- regexp: "^file_uploads"line: "file_uploads = 1"- regexp: "^upload_max_filesize"line: "upload_max_filesize = 1G"- regexp: "^max_file_uploads"line: "max_file_uploads = 20"- regexp: "^post_max_size"line: "post_max_size = 2G"- regexp: "^memory_limit"line: "post_max_size = 2G"- regexp: "^memory_limit"line: "memory_limit = 2G"- regexp: "^max_input_time"  line: "max_input_time = 3600"As linhas do php.ini encontram-se alteradas ?"ficheiro php.ini foi alterado com sucesso"Algumas alterações ao ficheiro php.ini não tiveram sucesso"O site deve existir na pasta /var/www/leantime. Este teste visa determinar se a pasta  # existe e se temas permissões certas  # Fonte de inspiração: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre a pastas /var/www/leantime"    stat:    path: "/var/www/leantime"register: pasta  - name: "Teste: A pasta /var/www/leantime existe e tem as permissões certas?"assert:  that:  - pasta.stat.exists- pasta.stat.isdir  - pasta.stat.mode == "0755"- pasta.stat.pw_name == "www-data"  - pasta.stat.gr_name == "www-data"success_msg: "SUCESSO: Permissões correctas no site leantime"fail_msg: "ERRO: Permissões incorrectas no site leantime ou site não existente"  # Outro dos requesitos é a existência de uma base de dados para o site.B  # Outro dos requesitos é a existência de uma base de dados para o site.  # Esta base de dados deve ser criada, logo tem de ser testada para determinar se ela existe ou não.  # Fonte de inspiração: https://serverfault.com/questions/173978/from-a-shell-script-how-can-i-check-whether-a-mysql-database-existsB- name: "Simulação: Verifica se é necessário criar a base de dados leantime_database"shell: "mysql -u root -e 'use leantime_database'"resultfailed_when: false  changed_when: false  - name: "Teste: A base de dados leantime_database existe ?"assert:that:- result.rc == 0success_msg: "SUCESSO: A base de dados leantime_database já se encontra criada"fail_msg: "ERRO: Não existe a base de dados leantime_database"  # Teste: O download do software leantime deve ser possível, a partir do site do leantimeB- name: "Simulação e Teste: Verifica se o endereço git para a versão de leantime existe"uri:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipregister: resultadoTeste: Do ficheiro configuration.php no site do leantime. A existência deste ficheiro       com as permissões certas indica que o processo de unzip correu bemDocumentação oficial em: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlBo ficheiro /var/www/leantime/config/configuration.php"/config/configuration.php"ficheiroO ficheiro /var/www/leantime/config/configuration.php existe e tem as permissões certas?"ficheiro.stat.existsthat: - ficheiro.stat.exists - ficheiro.stat.isreg - ficheiro.stat.mode == "0755" - ficheiro.stat.pw_name == "www-data"    - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permissões correctas e ficheiro configuration.php existente"  fail_msg: "ERRO: Permissões incorrectas ou ficheiro configuration.php não existente"  # Teste: O ficheiro /var/www/leantime/config/configuration.php necessita de ser alterado.  # As variáveis dbuser, dbDatabase, e dbPassword necessitam de estar configuradas.  # Por simulação o sistema vai determinar se estas estão configuradas com o valor esperado.  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbUser=""' replace: 'dbUser="{{ login_leantime }}"'  check_mode: yesregister: conffailed_when: false  - name: "Teste: O dbUser foi alterado?"    assert: that: - conf is not changed    - conf is not failed  success_msg: "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"fail_msg: "ERRO: O dbUser não foi alterado no ficheiro configuration.php"  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.php    ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbDatabase=""'replace: 'dbDatabase="leantime_database"'check_mode: yesregister: conffailed_when: false  - name: "Teste: a variável dbDatabase foi alterada?"    assert: that: - conf is not changed - conf is not failed    success_msg: "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"  fail_msg: "ERRO: O dbDatabase não foi alterado no ficheiro configuration.php"  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:  path: /var/www/leantime/config/configuration.php  regexp: 'dbPassword=""'replace: 'dbPassword="{{ password_leantime }}"'  check_mode: yesregister: conffailed_when: false  - name: "Teste: O dbPassword foi alterado?"assert:that:- conf is not changed- conf is not failed success_msg: "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"    fail_msg: "ERRO: O dbPassword não foi alterado no ficheiro configuration.php"  # A configuração do site leantime necessita que seja criado um site através de um ficheiro deB  # A configuração do site leantime necessita que seja criado um site através de um ficheiro de  # configuração, dentro das pasta do apache2. Deve existir um ficheiro de configuração do  # leantime em (/etc/apache2/sites-availableB  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-available/leantime.conf"stat:path: "/etc/apache2/sites-available/leantime.conf"  register: ficheiro  - name: "Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.isreg- ficheiro.stat.mode == "0755" - ficheiro.stat.pw_name == "root" - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permissões correctas"fail_msg: "ERRO: Permissões incorrectas"  # O site deve estar ativo no apache. Este teste vai verificar se o site se encontra ativo  # https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf"stat:path: "/etc/apache2/sites-enabled/leantime.conf"  register: ficheiro  - name: "Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permissões certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.islnk- ficheiro.stat.mode == "0777" - ficheiro.stat.pw_name == "root"77root"- ficheiro.stat.islnk- ficheiro.stat.existsthat:assert:- name: "Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permissões certas?"register: ficheiropath: "/etc/apache2/sites-enabled/leantime.conf"stat:- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf"  # https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB  # O site deve estar ativo no apache. Este teste vai verificar se o site se encontra ativoBfail_msg: "ERRO: Permissões incorrectas"success_msg: "SUCESSO: Permissões correctas"- ficheiro.stat.gr_name == "www-data"- ficheiro.stat.pw_name == "root"- ficheiro.stat.mode == "0755"- ficheiro.stat.isreg- ficheiro.stat.existsthat:assert:- name: "Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?"register: ficheiropath: "/etc/apache2/sites-available/leantime.conf"stat:- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-available/leantime.conf"  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB  # leantime em (/etc/apache2/sites-availableBata"admlocal@devOps:~/leantime_ansible$ molecule login
INFO     Running default > login
Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-72-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Tue May 25 20:56:10 UTC 2021

  System load:  0.26              Processes:               130
  Usage of /:   7.8% of 38.71GB   Users logged in:         0
  Memory usage: 31%               IPv4 address for enp0s3: 10.0.2.15
  Swap usage:   0%                IPv4 address for enp0s8: 172.28.128.21

 * Super-optimized for small spaces - read how we shrank the memory
   footprint of MicroK8s to make it the smallest full K8s around.

   https://ubuntu.com/blog/microk8s-memory-optimisation




*** System restart required ***
Last login: Tue May 25 20:54:44 2021 from 10.0.2.2
vagrant@ubuntu-20:~$ sudo /i*i-i
root@ubuntu-20:~# ls /etc/apache2/sites-available/- /etc/apache2/sites-available/a /etc/apache2/sites-available/l /etc/apache2/sites-available/h /etc/apache2/sites-available/ /etc/apache2/sites-available/
ls-alh: command not found
root@ubuntu-20:~# ls-alh  /etc/apache2/sites-available/ 
total 24K
drwxr-xr-x 2 root root 4.0K May 25 18:57 .
drwxr-xr-x 8 root root 4.0K May 20 21:19 ..
-rw-r--r-- 1 root root 1.4K Apr 13  2020 000-default.conf
-rw-r--r-- 1 root root 6.2K Apr 13  2020 default-ssl.conf
-rwxr-xr-x 1 root root  320 May 25 18:57 leantime.conf
root@ubuntu-20:~# rm leals -alh  /etc/apache2/sites-available/rmleantime.conf 
root@ubuntu-20:~# rm  /etc/apache2/sites-available/leantime.conf ls -alh  /etc/apache2/sites-available/ /////////e/n/abled/
total 8.0K
drwxr-xr-x 2 root root 4.0K May 25 20:49 .
drwxr-xr-x 8 root root 4.0K May 20 21:19 ..
lrwxrwxrwx 1 root root   35 May 20 21:19 000-default.conf -> ../sites-available/000-default.conf
lrwxrwxrwx 1 root root   42 May 25 20:49 leantime.conf -> /etc/apache2/sites-available/leantime.conf
root@ubuntu-20:~# ls -alh  /etc/apache2/sites-enabled/rmleantime.conf 
root@ubuntu-20:~# exit
logout
vagrant@ubuntu-20:~$ exit
logout
Connection to 127.0.0.1 closed.
admlocal@devOps:~/leantime_ansible$ nano tasks/tasks.yml 
BBB[ A ler... ]BB[ 168 linhas lidas ]BB  GNU nano 4.8                                                tasks/tasks.yml                                                             BB^GB AjudaB^OB GravarB^WB ProcurarB^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtB^XB SairB^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txtB---- name: Atualiza a cache (equivalente a apt update)apt:update_cache: truecache_valid_time: 3600- name: "Atualiza o sistema operativo"apt:upgrade: safe- name: "Instalar as dependencias necessária ao programa leantime"apt:pkg:- mc- screen- git- apache2- mysql-server- php- php-mysql- php-ldap- php-cli- php-soap- php-json- graphviz- php-xml- php-gd- php-zip- libapache2-mod-php- php-dev- libmcrypt-dev- gcc- make- autoconf- libc-dev - autoconf    - libc-dev  - pkg-config- pwgen- curl- unzip    - zip  - php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurl   # Fonte de inspiração: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.htmlB- name: "Instala o serviço apache2 no arranque do sistema"service:name: apache2state: startedenabled: true   # Fonte: https://www.mydailytutorials.com/using-ansible-find-module-search-filesfolderB- name: "Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurse: trueregister: caminho_php_ini   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.htmlB- name: "Ativa várias opções no ficheiro php.ini, utilizando o módulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:regexp: "^file_uploads"  line: "file_uploads = 1"regexp: "^upload_max_filesize"  line: "upload_max_filesize = 1G"regexp: "^max_file_uploads"  line: "max_file_uploads = 20"regexp: "^post_max_size"  line: "post_max_size = 2G"regexp: "^memory_limit"  line: "memory_limit = 2G"- regexp: "^max_input_time" line: "max_input_time = 3600"   # Fonte: https://docs.ansible.com/ansible/2.7/modules/file_module.htmlB- name: Cria a directoria temporária leantime e a directoria de apache leantimefile:path: "{{ item.path }}"state: directory mode: 0755    owner: www-data  group: www-datawith_items:- path: "/tmp/leantime"- path: "/var/www/leantime"   # Fonte: Ansible for DevOps - Server and configuration management for humans de Jeff Geerling, página 98B   - name: "Cria a base de dados de mysql para o leantime"  mysql_db: "db=leantime_database state=present"- name: "Cria o utilizador para a base de dados leantime"mysql_user:namlogin_leantime }}"mysql_user:namlogin_leantime }}"  password: "{{ password_leantime }}"priv: "leantime_database.*:ALL"host: localhoststate: present- name: "Faz o download do software leantime a partir do repositório git"get_url:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipdest: /tmp/leantimemode: 0755   # O ficheiro Leantime-versao.zip necessita de ser descomprimidoB- name: Descomprime o software leantimeunarchive: src: "/tmp/leantime/Leantime-{{ versao_leantime }}.zip"    dest: "/var/www/leantime"  owner: www-datagroup: www-datamode: 0755remote_src: true   # Após a descompressão, se o ficheiro configuration.php não existir, este necessita de ser   # criado a partir do ficheiro configuration.sample.php   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/copy_module.htmlB- name: Copia o ficheiro de configuração configuration.sample.phpansible.builtin.copy: src: /var/www/leantime/config/configuration.sample.php    dest: /var/www/leantime/config/configuration.php  owner: www-datagroup: www-data    mode: '0755'  remote_src: trueforce: false  remote_src: trueforce: false   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: Altera as variáveis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o módulo replace.ansible.builtin.replace:path: /var/www/leantime/config/configuration.php    regexp: "{{ item.regexp  }}"  replace: "{{ item.line }}"with_items:- regexp: 'dbUser=""'  line: 'dbUser="{{ login_leantime }}"'- regexp: 'dbDatabase=""' line: 'dbDatabase="leantime_database"'    - regexp: 'dbPassword=""'    line: 'dbPassword="{{ password_leantime }}"'   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.htmlB- name: Copia o template do site para a pásta /etc/apache2/sites-availableansible.builtin.template:src: leantime.template.j2dest: /etc/apache2/sites-available/leantime.confowner: root group: www-data mode: 0755force: falsefileB"Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"fileetc/apache2/sites-available/leantime.confetc/apache2/sites-enabled/leantime.confrootrootgroup: rootmode: '0755'state: linkowner: rootdest: /etc/apache2/sites-enabled/leantime.confsrc: /etc/apache2/sites-available/leantime.confansible.builtin.file:- name: "Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled"   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/file_module.htmlBforce: falsemode: 0755group: www-dataowner: rootdest: /etc/apache2/sites-available/leantime.confsrc: leantime.template.j2ansible.builtin.template:- name: Copia o template do site para a pásta /etc/apache2/sites-available   # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/template_module.htmlBline: 'dbPassword="{{ password_leantime }}"'BModificadoB''77'777'         BM-DB Formato DOSBM-AB AnexarBBB SegurançaBCB Cancelar           BM-MB Formato MacBM-PB PreporB^TB P/ ficheirosBNome do ficheiro onde escrever: tasks/tasks.yml                                                                                           B B[ A escrever... ]BB          BB[ 168 linhas escritas ]BB^OB GravarB^WB Procurar      B^KB Cortar txt    B^JB Justificar    B^CB Pos cursorBUB Desfazer     BM-AB Marcar txtBXB Sair    B^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB Refazer      BM-6B Copiar txt-sBModificadoB    www-data         BM-DB Formato DOSBM-AB AnexarBBB SegurançaBCB Cancelar           BM-MB Formato MacBM-PB PreporB^TB P/ ficheirosBNome do ficheiro onde escrever: tasks/tasks.yml                                                                                           B B[ A escrever... ]BB          BB[ 168 linhas escritas ]BB^OB GravarB^WB Procurar      B^KB Cortar txt    B^JB Justificar    B^CB Pos cursorBUB Desfazer     BM-AB Marcar txtBXB Sair    B^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB Refazer      BM-6B Copiar txtadmlocal@devOps:~/leantime_ansible$ nano tasks/tasks.yml molecule loginconvergeverify
INFO     default scenario test matrix: verify
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > verify
INFO     Running Ansible Verifier

PLAY [Infraestrutura conduzida por testes] ***********************************************************************************************

TASK [Variáveis] *************************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Atualizar a cache do sistema] *******************************************************************************************
ok: [ubuntu-20.04]

TASK [teste: a cache encontra-se actualizada?] *******************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Atualizar o sistema operativo (equivalente a apt upgrade)] *************************************************************************
ok: [ubuntu-20.04]

TASK [teste: o sistema operativo encontra-se atualizado?] ********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O sistema operativo está atualizado"
}

TASK [Teste: a cache encontra-se atualizada?] ********************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Simulação: testa se as aplicações dependencia do software leantime se encontram instaladas] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: as dependencias encontra-se instaladas?] ************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: As dependencias estavam instaladas"
}

TASK [Simulação: Testar se o serviço apache2 se encontra instalado, iniciado e ativo no arranque] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: O serviço apache2 encontra-se ativo no arranque no sistema, e está iniciado?] ***********************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O serviço apache2 está correctamente instalado e inicia com o arranque do sistema"
}

TASK [Rotina Auxiliar> Procura o caminho do ficheiro php.ini do servidor apache2] ********************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Ativa a opção file_uploads no ficheiro php.ini, utilizando o módulo lineinfile.] ****************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [Teste: As linhas do php.ini encontram-se alteradas ?] ******************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O ficheiro php.ini foi alterado com sucesso"
}

TASK [Simulação: Obtem informação sobre a pastas /var/www/leantime] **********************************************************************
ok: [ubuntu-20.04]

TASK [Teste: A pasta /var/www/leantime existe e tem as permissões certas?] ***************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas no site leantime"
}

TASK [Simulação: Verifica se é necessário criar a base de dados leantime_database] *******************************************************
ok: [ubuntu-20.04]

TASK [Teste: A base de dados leantime_database existe ?] *********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A base de dados leantime_database já se encontra criada"
}

TASK [Simulação e Teste: Verifica se o endereço git para a versão de leantime existe] ****************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Obtem informação sobre o ficheiro /var/www/leantime/config/configuration.php] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /var/www/leantime/config/configuration.php existe e tem as permissões certas?] ***********************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas e ficheiro configuration.php existente"
}

TASK [Simulação: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o módulo replace.] ******************************
ok: [ubuntu-20.04]

TASK [Teste: O dbUser foi alterado?] *****************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: a variável dbDatabase foi alterada?] ****************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: O dbPassword foi alterado?] *************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-available/leantime.conf] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?] ***********************************
fatal: [ubuntu-20.04]: FAILED! => {
    "assertion": "ficheiro.stat.exists",
    "changed": false,
    "evaluated_to": false,
    "msg": "ERRO: Permissões incorrectas"
}

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=27   changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0


CRITICAL Ansible return code was 2, command was: ansible-playbook --inventory /home/admlocal/.cache/molecule/leantime_ansible/default/inventory --skip-tags molecule-notest,notest /home/admlocal/leantime_ansible/molecule/default/verify.yml
admlocal@devOps:~/leantime_ansible$ molecule verifyconverge
INFO     default scenario test matrix: dependency, create, prepare, converge
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > dependency
WARNING  Skipping, missing the requirements file.
WARNING  Skipping, missing the requirements file.
INFO     Running default > create
WARNING  Skipping, instances already created.
INFO     Running default > prepare
WARNING  Skipping, instances already prepared.
INFO     Running default > converge

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instalar as dependencias necessária ao programa leantime] *******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instala o serviço apache2 no arranque do sistema] ***************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Ativa várias opções no ficheiro php.ini, utilizando o módulo lineinfile.] ***************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [leantime_ansible : Cria a directoria temporária leantime e a directoria de apache leantime] ****************************************
ok: [ubuntu-20.04] => (item={'path': '/tmp/leantime'})
ok: [ubuntu-20.04] => (item={'path': '/var/www/leantime'})

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
[WARNING]: Module did not set no_log for update_password
ok: [ubuntu-20.04]

TASK [leantime_ansible : Faz o download do software leantime a partir do repositório git] ************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Copia o ficheiro de configuração configuration.sample.php] ******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Altera as variáveis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o módulo replace.] ***
ok: [ubuntu-20.04] => (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})

TASK [leantime_ansible : Copia o template do site para a pásta /etc/apache2/sites-available] *********************************************
changed: [ubuntu-20.04]

TASK [leantime_ansible : Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
changed: [ubuntu-20.04]

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=16   changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


admlocal@devOps:~/leantime_ansible$ molecule convergeidempotence
INFO     default scenario test matrix: idempotence
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > idempotence

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instalar as dependencias necessária ao programa leantime] *******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instala o serviço apache2 no arranque do sistema] ***************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Ativa várias opções no ficheiro php.ini, utilizando o módulo lineinfile.] ***************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [leantime_ansible : Cria a directoria temporária leantime e a directoria de apache leantime] ****************************************
ok: [ubuntu-20.04] => (item={'path': '/tmp/leantime'})
ok: [ubuntu-20.04] => (item={'path': '/var/www/leantime'})

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
[WARNING]: Module did not set no_log for update_password
ok: [ubuntu-20.04]

TASK [leantime_ansible : Faz o download do software leantime a partir do repositório git] ************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Copia o ficheiro de configuração configuration.sample.php] ******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Altera as variáveis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o módulo replace.] ***
ok: [ubuntu-20.04] => (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})

TASK [leantime_ansible : Copia o template do site para a pásta /etc/apache2/sites-available] *********************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
ok: [ubuntu-20.04]

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=16   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


INFO     Idempotence completed successfully.
admlocal@devOps:~/leantime_ansible$ molecule login
INFO     Running default > login
Welcome to Ubuntu 20.04.2 LTS (GNU/Linux 5.4.0-72-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Tue May 25 21:00:06 UTC 2021

  System load:  0.31              Processes:               135
  Usage of /:   7.8% of 38.71GB   Users logged in:         0
  Memory usage: 33%               IPv4 address for enp0s3: 10.0.2.15
  Swap usage:   0%                IPv4 address for enp0s8: 172.28.128.21

 * Super-optimized for small spaces - read how we shrank the memory
   footprint of MicroK8s to make it the smallest full K8s around.

   https://ubuntu.com/blog/microk8s-memory-optimisation




*** System restart required ***
Last login: Tue May 25 20:59:59 2021 from 10.0.2.2
vagrant@ubuntu-20:~$ sudo -i
root@ubuntu-20:~# ls -alh /etc/apache2/sites-available/
total 24K
drwxr-xr-x 2 root root     4.0K May 25 20:59 .
drwxr-xr-x 8 root root     4.0K May 20 21:19 ..
-rw-r--r-- 1 root root     1.4K Apr 13  2020 000-default.conf
-rw-r--r-- 1 root root     6.2K Apr 13  2020 default-ssl.conf
-rwxrwxrwx 1 root www-data  320 May 25 20:59 leantime.conf
root@ubuntu-20:~# ls -alh /etc/apache2/sites-available//////////e/n/a/b/l/e/d/
total 8.0K
drwxr-xr-x 2 root root 4.0K May 25 20:59 .
drwxr-xr-x 8 root root 4.0K May 20 21:19 ..
lrwxrwxrwx 1 root root   35 May 20 21:19 000-default.conf -> ../sites-available/000-default.conf
lrwxrwxrwx 1 root root   42 May 25 20:59 leantime.conf -> /etc/apache2/sites-available/leantime.conf
root@ubuntu-20:~# stat -c "%a %n" &/etc/&apache2/sites-available/leantime.conf 
777 /etc/apache2/sites-available/leantime.conf
root@ubuntu-20:~# stat -c "%a %n" /etc/apache2/sites-available/leantime.conf enabled
777 /etc/apache2/sites-enabled/leantime.conf
root@ubuntu-20:~# exit
logout
vagrant@ubuntu-20:~$ exit
logout
Connection to 127.0.0.1 closed.
admlocal@devOps:~/leantime_ansible$ nano molecule/default/
BBB[ "molecule/default/" é uma pasta ]BB  GNU nano 4.8                                                  Novo buffer                                                               BB^GB AjudaB^OB GravarB^WB ProcurarB^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtB^XB SairB^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txtBBModificadoBvBGravar buffer modificado?                                                                                                                  SB SimB NB Não B^CB Cancelaradmlocal@devOps:~/leantime_ansible$ nano molecule/default/verify.yml 
BBB[ A ler... ]BB[ 302 linhas lidas ]BB  GNU nano 4.8                                          molecule/default/verify.yml                                                       BB^GB AjudaB^OB GravarB^WB ProcurarB^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtB^XB SairB^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txtB---# Tutorial de inspiração para a infraestrutura conduzida por teste no site# https://www.adictosaltrabajo.com/2020/05/08/ansible-testing-using-molecule-with-ansible-as-verifier/B- name: "Infraestrutura conduzida por testes"hosts: allgather_facts: falsebecome: truetasks:- name: Variáveisinclude_vars:file: ../../vars/main.yml- name: "Simulação: Atualizar a cache do sistema"apt:update_cache: truecache_valid_time: 3600check_mode: trueregister: estado- name: "teste: a cache encontra-se actualizada?"assert:that:- not estado.changedsuccess_msg: "SUCESSO: A cache está atualizada"fail_msg: "ERRO: Existem actualizações pendentes"- name: "Atualizar o sistema operativo (equivalente a apt upgrade)"apt:upgrade: safecheck_mode: trueregister: estado- name: "teste: o sistema operativo encontra-se atualizado?"  - name: "teste: o sistema operativo encontra-se atualizado?"    assert:that: - not estado.changed    success_msg: "SUCESSO: O sistema operativo está atualizado"    fail_msg: "ERRO: Existem actualizações pendentes"  - name: "Teste: a cache encontra-se atualizada?"  assert:    that:  - not estado.changedsuccess_msg: "SUCESSO: A cache está atualizada"fail_msg: "ERRO: Existem atualizações pendentes"  - name: "Simulação: testa se as aplicações dependencia do software leantime se encontram instaladas"apt:pkg:  - mc  - screen- git    - apache2  - mysql-server- phpphp-mysql- php-ldap- php-cli- php-soap    - php-json  - graphviz- php-xml  - php-gd  - php-zip- libapache2-mod-php    - php-dev- libapache2-mod-php    - php-dev  - libmcrypt-dev- gccmake- autoconf- libc-dev- pkg-config    - pwgen  - curl- unzipzip- php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurlcheck_mode: trueregister: estado  - name: "Teste: as dependencias encontra-se instaladas?"assert:that:not estado.changedsuccess_msg: "SUCESSO: As dependencias estavam instaladas"fail_msg: "ERRO: Faltam instalar algumas dependencias. O software pode estar parcialmente instalado"  # Fonte de inspiração: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.htmlB- name: "Simulação: Testar se o serviço apache2 se encontra instalado, iniciado e ativo no arranque"service:name: apache2state: startedenabled: truecheck_mode: trueenabled: trueO serviço apache2 encontra-se ativo no arranque no sistema, e está iniciado?"O serviço apache2 está correctamente instalado e inicia com o arranque do sistema"O serviço apache2 não se encontra correcta: https://www.mydailytutorials.com/using--find-module-search-filesfolderBRotina Auxiliar> Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurseregister: caminho_php_ini  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.htmlB- name: "Simulação: Ativa a opção file_uploads no ficheiro php.ini, utilizando o módulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:- regexp: "^file_uploads"line: "file_uploads = 1"- regexp: "^upload_max_filesize"line: "upload_max_filesize = 1G"- regexp: "^max_file_uploads"line: "max_file_uploads = 20"- regexp: "^post_max_size"line: "post_max_size = 2G"- regexp: "^memory_limit"line: "post_max_size = 2G"- regexp: "^memory_limit"line: "memory_limit = 2G"- regexp: "^max_input_time"  line: "max_input_time = 3600"As linhas do php.ini encontram-se alteradas ?"ficheiro php.ini foi alterado com sucesso"Algumas alterações ao ficheiro php.ini não tiveram sucesso"O site deve existir na pasta /var/www/leantime. Este teste visa determinar se a pasta  # existe e se temas permissões certas  # Fonte de inspiração: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre a pastas /var/www/leantime"    stat:    path: "/var/www/leantime"register: pasta  - name: "Teste: A pasta /var/www/leantime existe e tem as permissões certas?"assert:  that:  - pasta.stat.exists- pasta.stat.isdir  - pasta.stat.mode == "0755"- pasta.stat.pw_name == "www-data"  - pasta.stat.gr_name == "www-data"success_msg: "SUCESSO: Permissões correctas no site leantime"fail_msg: "ERRO: Permissões incorrectas no site leantime ou site não existente"  # Outro dos requesitos é a existência de uma base de dados para o site.B  # Outro dos requesitos é a existência de uma base de dados para o site.  # Esta base de dados deve ser criada, logo tem de ser testada para determinar se ela existe ou não.  # Fonte de inspiração: https://serverfault.com/questions/173978/from-a-shell-script-how-can-i-check-whether-a-mysql-database-existsB- name: "Simulação: Verifica se é necessário criar a base de dados leantime_database"shell: "mysql -u root -e 'use leantime_database'"resultfailed_when: false  changed_when: false  - name: "Teste: A base de dados leantime_database existe ?"assert:that:- result.rc == 0success_msg: "SUCESSO: A base de dados leantime_database já se encontra criada"fail_msg: "ERRO: Não existe a base de dados leantime_database"  # Teste: O download do software leantime deve ser possível, a partir do site do leantimeB- name: "Simulação e Teste: Verifica se o endereço git para a versão de leantime existe"uri:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipregister: resultadoTeste: Do ficheiro configuration.php no site do leantime. A existência deste ficheiro       com as permissões certas indica que o processo de unzip correu bemDocumentação oficial em: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlBo ficheiro /var/www/leantime/config/configuration.php"/config/configuration.php"ficheiroO ficheiro /var/www/leantime/config/configuration.php existe e tem as permissões certas?"ficheiro.stat.existsthat: - ficheiro.stat.exists - ficheiro.stat.isreg - ficheiro.stat.mode == "0755" - ficheiro.stat.pw_name == "www-data"    - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permissões correctas e ficheiro configuration.php existente"  fail_msg: "ERRO: Permissões incorrectas ou ficheiro configuration.php não existente"  # Teste: O ficheiro /var/www/leantime/config/configuration.php necessita de ser alterado.  # As variáveis dbuser, dbDatabase, e dbPassword necessitam de estar configuradas.  # Por simulação o sistema vai determinar se estas estão configuradas com o valor esperado.  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbUser=""' replace: 'dbUser="{{ login_leantime }}"'  check_mode: yesregister: conffailed_when: false  - name: "Teste: O dbUser foi alterado?"    assert: that: - conf is not changed    - conf is not failed  success_msg: "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"fail_msg: "ERRO: O dbUser não foi alterado no ficheiro configuration.php"  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.php    ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbDatabase=""'replace: 'dbDatabase="leantime_database"'check_mode: yesregister: conffailed_when: false  - name: "Teste: a variável dbDatabase foi alterada?"    assert: that: - conf is not changed - conf is not failed    success_msg: "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"  fail_msg: "ERRO: O dbDatabase não foi alterado no ficheiro configuration.php"  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:  path: /var/www/leantime/config/configuration.php  regexp: 'dbPassword=""'replace: 'dbPassword="{{ password_leantime }}"'  check_mode: yesregister: conffailed_when: false  - name: "Teste: O dbPassword foi alterado?"assert:that:- conf is not changed- conf is not failed success_msg: "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"    fail_msg: "ERRO: O dbPassword não foi alterado no ficheiro configuration.php"  # A configuração do site leantime necessita que seja criado um site através de um ficheiro deB  # A configuração do site leantime necessita que seja criado um site através de um ficheiro de  # configuração, dentro das pasta do apache2. Deve existir um ficheiro de configuração do  # leantime em (/etc/apache2/sites-availableB  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-available/leantime.conf"stat:path: "/etc/apache2/sites-available/leantime.conf"  register: ficheiro  - name: "Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.isreg- ficheiro.stat.mode == "0755" - ficheiro.stat.pw_name == "root" - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permissões correctas"fail_msg: "ERRO: Permissões incorrectas"  # O site deve estar ativo no apache. Este teste vai verificar se o site se encontra ativo  # https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf"stat:path: "/etc/apache2/sites-enabled/leantime.conf"  register: ficheiro  - name: "Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permissões certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.islnk- ficheiro.stat.mode == "0777" - ficheiro.stat.pw_name == "root"77root"- ficheiro.stat.islnk- ficheiro.stat.existsthat:assert:- name: "Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permissões certas?"register: ficheiropath: "/etc/apache2/sites-enabled/leantime.conf"stat:- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf"  # https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB  # O site deve estar ativo no apache. Este teste vai verificar se o site se encontra ativoBfail_msg: "ERRO: Permissões incorrectas"success_msg: "SUCESSO: Permissões correctas"- ficheiro.stat.gr_name == "www-data"- ficheiro.stat.pw_name == "root"- ficheiro.stat.mode == "0755"- ficheiro.stat.isreg- ficheiro.stat.existsthat:assert:- name: "Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?"register: ficheiropath: "/etc/apache2/sites-available/leantime.conf"BModificadoB""77"777"         BM-DB Formato DOSBM-AB AnexarBBB SegurançaBCB Cancelar           BM-MB Formato MacBM-PB PreporB^TB P/ ficheirosBNome do ficheiro onde escrever: molecule/default/verify.yml                                                                               B B[ A escrever... ]BB          BB[ 302 linhas escritas ]BB^OB GravarB^WB Procurar      B^KB Cortar txt    B^JB Justificar    B^CB Pos cursorBUB Desfazer     BM-AB Marcar txtBXB Sair    B^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB Refazer      BM-6B Copiar txtadmlocal@devOps:~/leantime_ansible$ nano molecule/default/verify.yml molecule loginverify
INFO     default scenario test matrix: verify
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > verify
INFO     Running Ansible Verifier

PLAY [Infraestrutura conduzida por testes] ***********************************************************************************************

TASK [Variáveis] *************************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Atualizar a cache do sistema] *******************************************************************************************
ok: [ubuntu-20.04]

TASK [teste: a cache encontra-se actualizada?] *******************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Atualizar o sistema operativo (equivalente a apt upgrade)] *************************************************************************
ok: [ubuntu-20.04]

TASK [teste: o sistema operativo encontra-se atualizado?] ********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O sistema operativo está atualizado"
}

TASK [Teste: a cache encontra-se atualizada?] ********************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Simulação: testa se as aplicações dependencia do software leantime se encontram instaladas] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: as dependencias encontra-se instaladas?] ************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: As dependencias estavam instaladas"
}

TASK [Simulação: Testar se o serviço apache2 se encontra instalado, iniciado e ativo no arranque] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: O serviço apache2 encontra-se ativo no arranque no sistema, e está iniciado?] ***********************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O serviço apache2 está correctamente instalado e inicia com o arranque do sistema"
}

TASK [Rotina Auxiliar> Procura o caminho do ficheiro php.ini do servidor apache2] ********************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Ativa a opção file_uploads no ficheiro php.ini, utilizando o módulo lineinfile.] ****************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [Teste: As linhas do php.ini encontram-se alteradas ?] ******************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O ficheiro php.ini foi alterado com sucesso"
}

TASK [Simulação: Obtem informação sobre a pastas /var/www/leantime] **********************************************************************
ok: [ubuntu-20.04]

TASK [Teste: A pasta /var/www/leantime existe e tem as permissões certas?] ***************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas no site leantime"
}

TASK [Simulação: Verifica se é necessário criar a base de dados leantime_database] *******************************************************
ok: [ubuntu-20.04]

TASK [Teste: A base de dados leantime_database existe ?] *********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A base de dados leantime_database já se encontra criada"
}

TASK [Simulação e Teste: Verifica se o endereço git para a versão de leantime existe] ****************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Obtem informação sobre o ficheiro /var/www/leantime/config/configuration.php] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /var/www/leantime/config/configuration.php existe e tem as permissões certas?] ***********************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas e ficheiro configuration.php existente"
}

TASK [Simulação: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o módulo replace.] ******************************
ok: [ubuntu-20.04]

TASK [Teste: O dbUser foi alterado?] *****************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: a variável dbDatabase foi alterada?] ****************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: O dbPassword foi alterado?] *************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-available/leantime.conf] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?] ***********************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf] *********************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permissões certas?] *************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas"
}

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=30   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0

INFO     Verifier completed successfully.
admlocal@devOps:~/leantime_ansible$ molecule idempotence
INFO     default scenario test matrix: idempotence
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > idempotence

PLAY [Converge] **************************************************************************************************************************

TASK [Gathering Facts] *******************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Include leantime_ansible] **********************************************************************************************************

TASK [leantime_ansible : Atualiza a cache (equivalente a apt update)] ********************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Atualiza o sistema operativo] ***********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instalar as dependencias necessária ao programa leantime] *******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Instala o serviço apache2 no arranque do sistema] ***************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Rotina Auxiliar: Procura o caminho do ficheiro php.ini do servidor apache2] *************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Ativa várias opções no ficheiro php.ini, utilizando o módulo lineinfile.] ***************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [leantime_ansible : Cria a directoria temporária leantime e a directoria de apache leantime] ****************************************
ok: [ubuntu-20.04] => (item={'path': '/tmp/leantime'})
ok: [ubuntu-20.04] => (item={'path': '/var/www/leantime'})

TASK [leantime_ansible : Cria a base de dados de mysql para o leantime] ******************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria o utilizador para a base de dados leantime] ****************************************************************
[WARNING]: Module did not set no_log for update_password
ok: [ubuntu-20.04]

TASK [leantime_ansible : Faz o download do software leantime a partir do repositório git] ************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Descomprime o software leantime] ********************************************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Copia o ficheiro de configuração configuration.sample.php] ******************************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Altera as variáveis dbuser, dbpassword e dbdatabase no ficheiro configuration.php utilizando o módulo replace.] ***
ok: [ubuntu-20.04] => (item={'regexp': 'dbUser=""', 'line': 'dbUser="leantimeDBadmin"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbDatabase=""', 'line': 'dbDatabase="leantime_database"'})
ok: [ubuntu-20.04] => (item={'regexp': 'dbPassword=""', 'line': 'dbPassword="#S3gr3d0S3cr3t0#"'})

TASK [leantime_ansible : Copia o template do site para a pásta /etc/apache2/sites-available] *********************************************
ok: [ubuntu-20.04]

TASK [leantime_ansible : Cria um link simbólico para o ficheiro leantime.conf na pasta /etc/apache/sites-enabled] ************************
ok: [ubuntu-20.04]

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=16   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


INFO     Idempotence completed successfully.
admlocal@devOps:~/leantime_ansible$ exit
exit
