admlocal@devOps:~/leantime_ansible$ nano vermolecule/default/verify.yml 
BBB[ A ler... ]BB[ 334 linhas lidas ]BB  GNU nano 4.8                                          molecule/default/verify.yml                                                       BB^GB AjudaB^OB GravarB^WB ProcurarB^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtB^XB SairB^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txtB---# Tutorial de inspiração para a infraestrutura conduzida por teste no site# https://www.adictosaltrabajo.com/2020/05/08/ansible-testing-using-molecule-with-ansible-as-verifier/B- name: "Infraestrutura conduzida por testes"hosts: allgather_facts: falsebecome: truetasks:- name: Variáveisinclude_vars:file: ../../vars/main.yml- name: "Simulação: Atualizar a cache do sistema"apt:update_cache: truecache_valid_time: 3600check_mode: trueregister: estado- name: "teste: a cache encontra-se actualizada?"assert:that:- not estado.changedsuccess_msg: "SUCESSO: A cache está atualizada"fail_msg: "ERRO: Existem actualizações pendentes"- name: "Atualizar o sistema operativo (equivalente a apt upgrade)"apt:upgrade: safecheck_mode: trueregister: estado- name: "teste: o sistema operativo encontra-se atualizado?"  - name: "teste: o sistema operativo encontra-se atualizado?"    assert:that: - not estado.changed    success_msg: "SUCESSO: O sistema operativo está atualizado"    fail_msg: "ERRO: Existem actualizações pendentes"  - name: "Teste: a cache encontra-se atualizada?"  assert:    that:  - not estado.changedsuccess_msg: "SUCESSO: A cache está atualizada"fail_msg: "ERRO: Existem atualizações pendentes"  - name: "Simulação: testa se as aplicações dependencia do software leantime se encontram instaladas"apt:pkg:  - mc  - screen- git    - apache2  - mysql-server- phpphp-mysql- php-ldap- php-cli- php-soap    - php-json  - graphviz- php-xml  - php-gd  - php-zip- libapache2-mod-php    - php-dev- libapache2-mod-php    - php-dev  - libmcrypt-dev- gccmake- autoconf- libc-dev- pkg-config    - pwgen  - curl- unzipzip- php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurlcheck_mode: trueregister: estado  - name: "Teste: as dependencias encontra-se instaladas?"assert:that:not estado.changedsuccess_msg: "SUCESSO: As dependencias estavam instaladas"fail_msg: "ERRO: Faltam instalar algumas dependencias. O software pode estar parcialmente instalado"  # Fonte de inspiração: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.htmlB- name: "Simulação: Testar se o serviço apache2 se encontra instalado, iniciado e ativo no arranque"service:name: apache2state: startedenabled: truecheck_mode: trueenabled: trueO serviço apache2 encontra-se ativo no arranque no sistema, e está iniciado?"O serviço apache2 está correctamente instalado e inicia com o arranque do sistema"O serviço apache2 não se encontra correcta: https://www.mydailytutorials.com/using--find-module-search-filesfolderBRotina Auxiliar> Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurseregister: caminho_php_ini  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.htmlB- name: "Simulação: Ativa a opção file_uploads no ficheiro php.ini, utilizando o módulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:- regexp: "^file_uploads"line: "file_uploads = 1"- regexp: "^upload_max_filesize"line: "upload_max_filesize = 1G"- regexp: "^max_file_uploads"line: "max_file_uploads = 20"- regexp: "^post_max_size"line: "post_max_size = 2G"- regexp: "^memory_limit"line: "post_max_size = 2G"- regexp: "^memory_limit"line: "memory_limit = 2G"- regexp: "^max_input_time"  line: "max_input_time = 3600"As linhas do php.ini encontram-se alteradas ?"ficheiro php.ini foi alterado com sucesso"Algumas alterações ao ficheiro php.ini não tiveram sucesso"O site deve existir na pasta /var/www/leantime. Este teste visa determinar se a pasta  # existe e se temas permissões certas  # Fonte de inspiração: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre a pastas /var/www/leantime"    stat:    path: "/var/www/leantime"register: pasta  - name: "Teste: A pasta /var/www/leantime existe e tem as permissões certas?"assert:  that:  - pasta.stat.exists- pasta.stat.isdir  - pasta.stat.mode == "0755"- pasta.stat.pw_name == "www-data"  - pasta.stat.gr_name == "www-data"success_msg: "SUCESSO: Permissões correctas no site leantime"fail_msg: "ERRO: Permissões incorrectas no site leantime ou site não existente"  # Outro dos requesitos é a existência de uma base de dados para o site.B  # Outro dos requesitos é a existência de uma base de dados para o site.  # Esta base de dados deve ser criada, logo tem de ser testada para determinar se ela existe ou não.  # Fonte de inspiração: https://serverfault.com/questions/173978/from-a-shell-script-how-can-i-check-whether-a-mysql-database-existsB- name: "Simulação: Verifica se é necessário criar a base de dados leantime_database"shell: "mysql -u root -e 'use leantime_database'"resultfailed_when: false  changed_when: false  - name: "Teste: A base de dados leantime_database existe ?"assert:that:- result.rc == 0success_msg: "SUCESSO: A base de dados leantime_database já se encontra criada"fail_msg: "ERRO: Não existe a base de dados leantime_database"  # Teste: O download do software leantime deve ser possível, a partir do site do leantimeB- name: "Simulação e Teste: Verifica se o endereço git para a versão de leantime existe"uri:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipregister: resultadoTeste: Do ficheiro configuration.php no site do leantime. A existência deste ficheiro       com as permissões certas indica que o processo de unzip correu bemDocumentação oficial em: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlBo ficheiro /var/www/leantime/config/configuration.php"/config/configuration.php"ficheiroO ficheiro /var/www/leantime/config/configuration.php existe e tem as permissões certas?"ficheiro.stat.existsthat: - ficheiro.stat.exists - ficheiro.stat.isreg - ficheiro.stat.mode == "0755" - ficheiro.stat.pw_name == "www-data"    - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permissões correctas e ficheiro configuration.php existente"  fail_msg: "ERRO: Permissões incorrectas ou ficheiro configuration.php não existente"  # Teste: O ficheiro /var/www/leantime/config/configuration.php necessita de ser alterado.  # As variáveis dbuser, dbDatabase, e dbPassword necessitam de estar configuradas.  # Por simulação o sistema vai determinar se estas estão configuradas com o valor esperado.  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbUser=""' replace: 'dbUser="{{ login_leantime }}"'  check_mode: yesregister: conffailed_when: false  - name: "Teste: O dbUser foi alterado?"    assert: that: - conf is not changed    - conf is not failed  success_msg: "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"fail_msg: "ERRO: O dbUser não foi alterado no ficheiro configuration.php"  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.php    ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbDatabase=""'replace: 'dbDatabase="leantime_database"'check_mode: yesregister: conffailed_when: false  - name: "Teste: a variável dbDatabase foi alterada?"    assert: that: - conf is not changed - conf is not failed    success_msg: "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"  fail_msg: "ERRO: O dbDatabase não foi alterado no ficheiro configuration.php"  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:  path: /var/www/leantime/config/configuration.php  regexp: 'dbPassword=""'replace: 'dbPassword="{{ password_leantime }}"'  check_mode: yesregister: conffailed_when: false  - name: "Teste: O dbPassword foi alterado?"assert:that:- conf is not changed- conf is not failed success_msg: "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"    fail_msg: "ERRO: O dbPassword não foi alterado no ficheiro configuration.php"  # A configuração do site leantime necessita que seja criado um site através de um ficheiro deB  # A configuração do site leantime necessita que seja criado um site através de um ficheiro de  # configuração, dentro das pasta do apache2. Deve existir um ficheiro de configuração do  # leantime em (/etc/apache2/sites-availableB  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-available/leantime.conf"stat:path: "/etc/apache2/sites-available/leantime.conf"  register: ficheiro  - name: "Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.isreg- ficheiro.stat.mode == "0777" - ficheiro.stat.pw_name == "root" - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permissões correctas"fail_msg: "ERRO: Permissões incorrectas"  # O site deve estar ativo no apache. Este teste vai verificar se o site se encontra ativo  # https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf"stat:path: "/etc/apache2/sites-enabled/leantime.conf"  register: ficheiro  - name: "Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permissões certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.islnk- ficheiro.stat.mode == "0777" - ficheiro.stat.pw_name == "root"- ficheiro.stat.mode == "0777" - ficheiro.stat.pw_name == "root" - ficheiro.stat.gr_name == "root" success_msg: "SUCESSO: Permissões correctas" fail_msg: "ERRO: Permissões incorrectas"  # https//docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/000-default.conf"stat:path: "/etc/apache2/sites-enabled/000-default.conf"  register: ficheiro  - name: "Teste: O ficheiro /etc/apache2/sites-enabled/000-default.conf NÃO existe?"assert:that:not ficheiro.stat.exists  - name: "Simulação: Activa o módulo mod_rewrite no apache"apache2_module:name: rewritestate: present    check_mode: true    register: estado  - name: "Simulação: Activa o módulo mod_rewrite no apache"apache2_module:  name: rewritestate: present  check_mode: trueregister: estado  - name: "Teste: o mod_rewrite do apache encontra-se ativo?"assert:that:- not estado.changedthat:- not estado.changedsuccess_msg: "SUCESSO: mod_rewrite encontra-se instalado e ativo"fail_msg: "ERRO: mod_rewrite não instalado ou não ativo!"BModificadoB     #B BTBeBsBtBeB:B BVBeBrBiBfBiBcBaBrB BsBeB BoB BsBiBsBtBeBmBaB BsBeB BeBnBcBoBnBtBrBaB BdBeBvBiBdBaBmBeBnBtBeB BiBnBsBtBaBlBaBdBoB BeB BcBoBnBfBiBgBuBrBaBdBoB.B    #B B B B B B B B BSBeB BaB BbBaBsBeB BdBeB BdBaBdBoBsB BeBsBtBiBvBeBrB BcBoBrBreBcBtBaBmBeBnBtBeB BcBoBnBfBiBgBuBrBaBdBaB BeB BsBeB BoB BaBdBmBiBnBiBsBtBrBaBdBoBrB BdBoB    #B B B B B B B B BsBiBsBtBeBmBaB BeBsBtBiBvBeBrB BcBoBnBfBiBgBuBrBaBdBoB,B BdBeBvBeB BsBeBrB BpBoBsBsBíBvBeBlB BfBaBzBeBrB BlBoBgBiBnB BaBoB BsBiBsBtBeBmBaB BsBeBmB BpBrBoBbBlBeBmBaBsB.B    #B B B B B B B B BEBsBtBeB BtBeBsBtBeB BtBeBmB BcBoBmBoB BoBbBjBeBtBiBvBoB BvBeBrBiBfBiBcBaBrB BsBeB BéB BpBoBsBsBíBvBeBlB BfBaBzBeBrB BoB BlBoBgBiBnB    #B BABtBrBaBvBéBsB BdBoB BBBuBrBbBSBuBiBtBeB B(BhBtBtBpBsB:B/B/BpBoBrBtBsBwBiBgBgBeBrB.BnBeBtB/BbBuBrBpB)B,B BaBpBrBeBnBdBiBdBoB BnBaBsB BaBuBlBaBsB BdBeB BTBeBsBtBeBsB BdBeB BPBeBnBeBtBrBaBçBãBoB BeB BDBeBsBeBnBvBoBlBvBiBmBeBnBtBoB BdBeB BEBxBpBlBoBiBtBsB    #B BfBoBiB BrBeBaBlBiBzBaBdBoB BuBmB BdBeBbBuBgB BdBaB BsBeBsBsBãBoB BdBeB BlBoBgBiBnB.B BCBoBmB BbBaBsBeB BnBeBsBsBaB BsBeBsBsBãBoB BaB BfBaBseB BdBeB BLBoBgBiBnB BenBcBoBnBtrBaB-BsBeB BaBqBuBiB BrBeBpBlBiBcBaBdBaB.B    #B BèB BnBeBcBeBsBsBáBrBioB BgBrBaBvBaBrB BaB BcBoBcBkBiBeB BdBeB BsBeBsBsBãBoB.B BAB BpBáBgBiBnBaB BoBfBiBcBiBaBlB BdBoB BABnBsBiBbBlBeB BcBoBnBtBeBmB BuBmB BeBrBrBoB BqBuBeB BéB BrBeBsBoBlBvBiBdBoB BcBoBmB BaB BsBeBgBuBiBnBtBeB.B.B.B    #B BFBoBnBtBeB:B BhBtBtBpBsB:B/B/BsBtBaBcBkBoBvBeBrBfBlBoBwB.BcBoBmB/BqBuBeBsBtBiBoBnBsB/B6B3B7B9B1B6B8B9B/BaBnBsBiBbBlBeB-BlBoBoBsBeBsB-BcBoBoBkBiBeB-BcBoBnBtBeBnBtB  - name: "Simulação: Tenta fazer login na aplicação com o utilizador criado"    uri:      url: http://localhost      method: POST      body: "username={{ login_website  }}&password={{ password_website  }}&redirectUrl:=/&login=Login"      status_code: 200      follow_redirects: true    register: paginalogin  - name: "Simulação: Obtem a página showMyCalendar para testar uma página com o login efetuado com sucesso"    uri:      url: http://localhost/calendar/showMyCalendar      method: GET      headers:        Cookie: "{{ paginalogin.set_cookie }}"      return_content: yes    register: paginaweb  - name: "Teste: Existe o texto editCompanySettings na página?"    assert:      that:      - "'password' not in paginaweb.content"
      - "'editCompanySettings' in paginaweb.content"
      success_msg: "SUCESSO: Login com sucesso. Utilizador e palavra passe iniciais correctamente criados"
      fail_msg: "ERRO: Não foi possivel fazer login! O utilizador ou palavra passe não foram criados com sucesso!"esGETruepSuite (https://portswigger.net/burp), aprendido nas aulas de Testes de Penetração e Desenvolvimento de ExploitsB
         BM-DB Formato DOSBM-AB AnexarBBB SegurançaBCB Cancelar           BM-MB Formato MacBM-PB PreporB^TB P/ ficheirosBNome do ficheiro onde escrever: molecule/default/verify.yml                                                                               B B[ A escrever... ]BB          BB[ 368 linhas escritas ]BB^OB GravarB^WB Procurar      B^KB Cortar txt    B^JB Justificar    B^CB Pos cursorBUB Desfazer     BM-AB Marcar txtBXB Sair    B^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB Refazer      BM-6B Copiar txtadmlocal@devOps:~/leantime_ansible$ molecule lint
INFO     default scenario test matrix: dependency, lint
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > dependency
WARNING  Skipping, missing the requirements file.
WARNING  Skipping, missing the requirements file.
INFO     Running default > lint
COMMAND: set -e
yamllint .
ansible-lint

Loading custom .yamllint config file, this extends our internal yamllint config.
admlocal@devOps:~/leantime_ansible$ molecule verify
INFO     default scenario test matrix: verify
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > verify
INFO     Running Ansible Verifier

PLAY [Infraestrutura conduzida por testes] ***********************************************************************************************

TASK [Variáveis] *************************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Atualizar a cache do sistema] *******************************************************************************************
changed: [ubuntu-20.04]

TASK [teste: a cache encontra-se actualizada?] *******************************************************************************************
fatal: [ubuntu-20.04]: FAILED! => {
    "assertion": "not estado.changed",
    "changed": false,
    "evaluated_to": false,
    "msg": "ERRO: Existem actualizações pendentes"
}

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=2    changed=1    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0


CRITICAL Ansible return code was 2, command was: ansible-playbook --inventory /home/admlocal/.cache/molecule/leantime_ansible/default/inventory --skip-tags molecule-notest,notest /home/admlocal/leantime_ansible/molecule/default/verify.yml
admlocal@devOps:~/leantime_ansible$ molecule verify
INFO     default scenario test matrix: verify
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > verify
INFO     Running Ansible Verifier

PLAY [Infraestrutura conduzida por testes] ***********************************************************************************************

TASK [Variáveis] *************************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Atualizar a cache do sistema] *******************************************************************************************
ok: [ubuntu-20.04]

TASK [teste: a cache encontra-se actualizada?] *******************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Atualizar o sistema operativo (equivalente a apt upgrade)] *************************************************************************
ok: [ubuntu-20.04]

TASK [teste: o sistema operativo encontra-se atualizado?] ********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O sistema operativo está atualizado"
}

TASK [Teste: a cache encontra-se atualizada?] ********************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Simulação: testa se as aplicações dependencia do software leantime se encontram instaladas] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: as dependencias encontra-se instaladas?] ************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: As dependencias estavam instaladas"
}

TASK [Simulação: Testar se o serviço apache2 se encontra instalado, iniciado e ativo no arranque] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: O serviço apache2 encontra-se ativo no arranque no sistema, e está iniciado?] ***********************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O serviço apache2 está correctamente instalado e inicia com o arranque do sistema"
}

TASK [Rotina Auxiliar> Procura o caminho do ficheiro php.ini do servidor apache2] ********************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Ativa a opção file_uploads no ficheiro php.ini, utilizando o módulo lineinfile.] ****************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [Teste: As linhas do php.ini encontram-se alteradas ?] ******************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O ficheiro php.ini foi alterado com sucesso"
}

TASK [Simulação: Obtem informação sobre a pastas /var/www/leantime] **********************************************************************
ok: [ubuntu-20.04]

TASK [Teste: A pasta /var/www/leantime existe e tem as permissões certas?] ***************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas no site leantime"
}

TASK [Simulação: Verifica se é necessário criar a base de dados leantime_database] *******************************************************
ok: [ubuntu-20.04]

TASK [Teste: A base de dados leantime_database existe ?] *********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A base de dados leantime_database já se encontra criada"
}

TASK [Simulação e Teste: Verifica se o endereço git para a versão de leantime existe] ****************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Obtem informação sobre o ficheiro /var/www/leantime/config/configuration.php] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /var/www/leantime/config/configuration.php existe e tem as permissões certas?] ***********************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas e ficheiro configuration.php existente"
}

TASK [Simulação: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o módulo replace.] ******************************
ok: [ubuntu-20.04]

TASK [Teste: O dbUser foi alterado?] *****************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: a variável dbDatabase foi alterada?] ****************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: O dbPassword foi alterado?] *************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-available/leantime.conf] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?] ***********************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf] *********************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permissões certas?] *************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/000-default.conf] ******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-enabled/000-default.conf NÃO existe?] *********************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Simulação: Activa o módulo mod_rewrite no apache] **********************************************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Activa o módulo mod_rewrite no apache] **********************************************************************************
ok: [ubuntu-20.04]

TASK [Teste: o mod_rewrite do apache encontra-se ativo?] *********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: mod_rewrite encontra-se instalado e ativo"
}

TASK [Simulação: Tenta fazer login na aplicação com o utilizador criado] *****************************************************************
fatal: [ubuntu-20.04]: FAILED! => {"msg": "The task includes an option with an undefined variable. The error was: 'login_website' is undefined\n\nThe error appears to be in '/home/admlocal/leantime_ansible/molecule/default/verify.yml': line 344, column 5, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n  # Fonte: https://stackoverflow.com/questions/63791689/ansible-looses-cookie-content\n  - name: \"Simulação: Tenta fazer login na aplicação com o utilizador criado\"\n    ^ here\nThis one looks easy to fix. It seems that there is a value started\nwith a quote, and the YAML parser is expecting to see the line ended\nwith the same kind of quote. For instance:\n\n    when: \"ok\" in result.stdout\n\nCould be written as:\n\n   when: '\"ok\" in result.stdout'\n\nOr equivalently:\n\n   when: \"'ok' in result.stdout\"\n"}

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=35   changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0


CRITICAL Ansible return code was 2, command was: ansible-playbook --inventory /home/admlocal/.cache/molecule/leantime_ansible/default/inventory --skip-tags molecule-notest,notest /home/admlocal/leantime_ansible/molecule/default/verify.yml
admlocal@devOps:~/leantime_ansible$ nano vars/vamain.yml 
BBB[ A ler... ]BB[ 5 linhas lidas ]BB  GNU nano 4.8                                                 vars/main.yml                                                              BB^GB AjudaB^OB GravarB^WB ProcurarB^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtB^XB SairB^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txtB--- login_leantime: leantimeDBadminpassword_leantime: "#S3gr3d0S3cr3t0#"versao_leantime: v2.1.7BModificadoB       login_website: "my_name@my_email.com"   password_website: "S3cr3tPwd@V3ryS3cret«"    password_website: "S3cr3tPwd@V3ryS3cret«"     login_website: "my_name@my_email.com"          BM-DB Formato DOSBM-AB AnexarBBB SegurançaBCB Cancelar           BM-MB Formato MacBM-PB PreporB^TB P/ ficheirosBNome do ficheiro onde escrever: vars/main.yml                                                                                             B B[ A escrever... ]BB          BB[ 7 linhas escritas ]BB^OB GravarB^WB Procurar      B^KB Cortar txt    B^JB Justificar    B^CB Pos cursorBUB Desfazer     BM-AB Marcar txtBXB Sair    B^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB Refazer      BM-6B Copiar txt          BM-DB Formato DOSBM-AB AnexarBBB SegurançaBCB Cancelar           BM-MB Formato MacBM-PB PreporB^TB P/ ficheirosBNome do ficheiro onde escrever: vars/main.yml                                                                                             B B[ A escrever... ]BB[ 7 linhas escritas ]BB^OB GravarB^WB Procurar      B^KB Cortar txt    B^JB Justificar    B^CB Pos cursorBUB Desfazer     BM-AB Marcar txtBXB Sair    B^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB Refazer      BM-6B Copiar txt admlocal@devOps:~/leantime_ansible$ nano vars/main.yml molecule verify
INFO     default scenario test matrix: verify
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > verify
INFO     Running Ansible Verifier

PLAY [Infraestrutura conduzida por testes] ***********************************************************************************************

TASK [Variáveis] *************************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Atualizar a cache do sistema] *******************************************************************************************
ok: [ubuntu-20.04]

TASK [teste: a cache encontra-se actualizada?] *******************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Atualizar o sistema operativo (equivalente a apt upgrade)] *************************************************************************
ok: [ubuntu-20.04]

TASK [teste: o sistema operativo encontra-se atualizado?] ********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O sistema operativo está atualizado"
}

TASK [Teste: a cache encontra-se atualizada?] ********************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Simulação: testa se as aplicações dependencia do software leantime se encontram instaladas] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: as dependencias encontra-se instaladas?] ************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: As dependencias estavam instaladas"
}

TASK [Simulação: Testar se o serviço apache2 se encontra instalado, iniciado e ativo no arranque] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: O serviço apache2 encontra-se ativo no arranque no sistema, e está iniciado?] ***********************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O serviço apache2 está correctamente instalado e inicia com o arranque do sistema"
}

TASK [Rotina Auxiliar> Procura o caminho do ficheiro php.ini do servidor apache2] ********************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Ativa a opção file_uploads no ficheiro php.ini, utilizando o módulo lineinfile.] ****************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [Teste: As linhas do php.ini encontram-se alteradas ?] ******************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O ficheiro php.ini foi alterado com sucesso"
}

TASK [Simulação: Obtem informação sobre a pastas /var/www/leantime] **********************************************************************
ok: [ubuntu-20.04]

TASK [Teste: A pasta /var/www/leantime existe e tem as permissões certas?] ***************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas no site leantime"
}

TASK [Simulação: Verifica se é necessário criar a base de dados leantime_database] *******************************************************
ok: [ubuntu-20.04]

TASK [Teste: A base de dados leantime_database existe ?] *********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A base de dados leantime_database já se encontra criada"
}

TASK [Simulação e Teste: Verifica se o endereço git para a versão de leantime existe] ****************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Obtem informação sobre o ficheiro /var/www/leantime/config/configuration.php] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /var/www/leantime/config/configuration.php existe e tem as permissões certas?] ***********************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas e ficheiro configuration.php existente"
}

TASK [Simulação: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o módulo replace.] ******************************
ok: [ubuntu-20.04]

TASK [Teste: O dbUser foi alterado?] *****************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: a variável dbDatabase foi alterada?] ****************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: O dbPassword foi alterado?] *************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-available/leantime.conf] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?] ***********************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf] *********************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permissões certas?] *************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/000-default.conf] ******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-enabled/000-default.conf NÃO existe?] *********************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Simulação: Activa o módulo mod_rewrite no apache] **********************************************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Activa o módulo mod_rewrite no apache] **********************************************************************************
ok: [ubuntu-20.04]

TASK [Teste: o mod_rewrite do apache encontra-se ativo?] *********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: mod_rewrite encontra-se instalado e ativo"
}

TASK [Simulação: Tenta fazer login na aplicação com o utilizador criado] *****************************************************************
[WARNING]: The value True (type bool) in a string field was converted to 'True' (type string). If this does not look like what you
expect, quote the entire value to ensure it does not change.
ok: [ubuntu-20.04]

TASK [Simulação: Obtem a página showMyCalendar para testar uma página com o login efetuado com sucesso] **********************************
fatal: [ubuntu-20.04]: FAILED! => {"msg": "The task includes an option with an undefined variable. The error was: 'dict object' has no attribute 'set_cookie'\n\nThe error appears to be in '/home/admlocal/leantime_ansible/molecule/default/verify.yml': line 353, column 5, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n\n  - name: \"Simulação: Obtem a página showMyCalendar para testar uma página com o login efetuado com sucesso\"\n    ^ here\nThis one looks easy to fix. It seems that there is a value started\nwith a quote, and the YAML parser is expecting to see the line ended\nwith the same kind of quote. For instance:\n\n    when: \"ok\" in result.stdout\n\nCould be written as:\n\n   when: '\"ok\" in result.stdout'\n\nOr equivalently:\n\n   when: \"'ok' in result.stdout\"\n"}

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=36   changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0


CRITICAL Ansible return code was 2, command was: ansible-playbook --inventory /home/admlocal/.cache/molecule/leantime_ansible/default/inventory --skip-tags molecule-notest,notest /home/admlocal/leantime_ansible/molecule/default/verify.yml
admlocal@devOps:~/leantime_ansible$ molecule verifynano vars/main.yml molecule verifylintnano molecule/default/verify.yml 
BBB[ A ler... ]BB[ 368 linhas lidas ]BB  GNU nano 4.8                                          molecule/default/verify.yml                                                       BB^GB AjudaB^OB GravarB^WB ProcurarB^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtB^XB SairB^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txtB---# Tutorial de inspiração para a infraestrutura conduzida por teste no site# https://www.adictosaltrabajo.com/2020/05/08/ansible-testing-using-molecule-with-ansible-as-verifier/B- name: "Infraestrutura conduzida por testes"hosts: allgather_facts: falsebecome: truetasks:- name: Variáveisinclude_vars:file: ../../vars/main.yml- name: "Simulação: Atualizar a cache do sistema"apt:update_cache: truecache_valid_time: 3600check_mode: trueregister: estado- name: "teste: a cache encontra-se actualizada?"assert:that:- not estado.changedsuccess_msg: "SUCESSO: A cache está atualizada"fail_msg: "ERRO: Existem actualizações pendentes"- name: "Atualizar o sistema operativo (equivalente a apt upgrade)"apt:upgrade: safecheck_mode: trueregister: estado- name: "teste: o sistema operativo encontra-se atualizado?"  - name: "teste: o sistema operativo encontra-se atualizado?"    assert:that: - not estado.changed    success_msg: "SUCESSO: O sistema operativo está atualizado"    fail_msg: "ERRO: Existem actualizações pendentes"  - name: "Teste: a cache encontra-se atualizada?"  assert:    that:  - not estado.changedsuccess_msg: "SUCESSO: A cache está atualizada"fail_msg: "ERRO: Existem atualizações pendentes"  - name: "Simulação: testa se as aplicações dependencia do software leantime se encontram instaladas"apt:pkg:  - mc  - screen- git    - apache2  - mysql-server- phpphp-mysql- php-ldap- php-cli- php-soap    - php-json  - graphviz- php-xml  - php-gd  - php-zip- libapache2-mod-php    - php-dev- libapache2-mod-php    - php-dev  - libmcrypt-dev- gccmake- autoconf- libc-dev- pkg-config    - pwgen  - curl- unzipzip- php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurlcheck_mode: trueregister: estado  - name: "Teste: as dependencias encontra-se instaladas?"assert:that:not estado.changedsuccess_msg: "SUCESSO: As dependencias estavam instaladas"fail_msg: "ERRO: Faltam instalar algumas dependencias. O software pode estar parcialmente instalado"  # Fonte de inspiração: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.htmlB- name: "Simulação: Testar se o serviço apache2 se encontra instalado, iniciado e ativo no arranque"service:name: apache2state: startedenabled: truecheck_mode: trueenabled: trueO serviço apache2 encontra-se ativo no arranque no sistema, e está iniciado?"O serviço apache2 está correctamente instalado e inicia com o arranque do sistema"O serviço apache2 não se encontra correcta: https://www.mydailytutorials.com/using--find-module-search-filesfolderBRotina Auxiliar> Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurseregister: caminho_php_ini  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.htmlB- name: "Simulação: Ativa a opção file_uploads no ficheiro php.ini, utilizando o módulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:- regexp: "^file_uploads"line: "file_uploads = 1"- regexp: "^upload_max_filesize"line: "upload_max_filesize = 1G"- regexp: "^max_file_uploads"line: "max_file_uploads = 20"- regexp: "^post_max_size"line: "post_max_size = 2G"- regexp: "^memory_limit"line: "post_max_size = 2G"- regexp: "^memory_limit"line: "memory_limit = 2G"- regexp: "^max_input_time"  line: "max_input_time = 3600"As linhas do php.ini encontram-se alteradas ?"ficheiro php.ini foi alterado com sucesso"Algumas alterações ao ficheiro php.ini não tiveram sucesso"O site deve existir na pasta /var/www/leantime. Este teste visa determinar se a pasta  # existe e se temas permissões certas  # Fonte de inspiração: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre a pastas /var/www/leantime"    stat:    path: "/var/www/leantime"register: pasta  - name: "Teste: A pasta /var/www/leantime existe e tem as permissões certas?"assert:  that:  - pasta.stat.exists- pasta.stat.isdir  - pasta.stat.mode == "0755"- pasta.stat.pw_name == "www-data"  - pasta.stat.gr_name == "www-data"success_msg: "SUCESSO: Permissões correctas no site leantime"fail_msg: "ERRO: Permissões incorrectas no site leantime ou site não existente"  # Outro dos requesitos é a existência de uma base de dados para o site.B  # Outro dos requesitos é a existência de uma base de dados para o site.  # Esta base de dados deve ser criada, logo tem de ser testada para determinar se ela existe ou não.  # Fonte de inspiração: https://serverfault.com/questions/173978/from-a-shell-script-how-can-i-check-whether-a-mysql-database-existsB- name: "Simulação: Verifica se é necessário criar a base de dados leantime_database"shell: "mysql -u root -e 'use leantime_database'"resultfailed_when: false  changed_when: false  - name: "Teste: A base de dados leantime_database existe ?"assert:that:- result.rc == 0success_msg: "SUCESSO: A base de dados leantime_database já se encontra criada"fail_msg: "ERRO: Não existe a base de dados leantime_database"  # Teste: O download do software leantime deve ser possível, a partir do site do leantimeB- name: "Simulação e Teste: Verifica se o endereço git para a versão de leantime existe"uri:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipregister: resultadoTeste: Do ficheiro configuration.php no site do leantime. A existência deste ficheiro       com as permissões certas indica que o processo de unzip correu bemDocumentação oficial em: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlBo ficheiro /var/www/leantime/config/configuration.php"/config/configuration.php"ficheiroO ficheiro /var/www/leantime/config/configuration.php existe e tem as permissões certas?"ficheiro.stat.existsthat: - ficheiro.stat.exists - ficheiro.stat.isreg - ficheiro.stat.mode == "0755" - ficheiro.stat.pw_name == "www-data"    - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permissões correctas e ficheiro configuration.php existente"  fail_msg: "ERRO: Permissões incorrectas ou ficheiro configuration.php não existente"  # Teste: O ficheiro /var/www/leantime/config/configuration.php necessita de ser alterado.  # As variáveis dbuser, dbDatabase, e dbPassword necessitam de estar configuradas.  # Por simulação o sistema vai determinar se estas estão configuradas com o valor esperado.  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbUser=""' replace: 'dbUser="{{ login_leantime }}"'  check_mode: yesregister: conffailed_when: false  - name: "Teste: O dbUser foi alterado?"    assert: that: - conf is not changed    - conf is not failed  success_msg: "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"fail_msg: "ERRO: O dbUser não foi alterado no ficheiro configuration.php"  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.php    ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbDatabase=""'replace: 'dbDatabase="leantime_database"'check_mode: yesregister: conffailed_when: false  - name: "Teste: a variável dbDatabase foi alterada?"    assert: that: - conf is not changed - conf is not failed    success_msg: "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"  fail_msg: "ERRO: O dbDatabase não foi alterado no ficheiro configuration.php"  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:  path: /var/www/leantime/config/configuration.php  regexp: 'dbPassword=""'replace: 'dbPassword="{{ password_leantime }}"'  check_mode: yesregister: conffailed_when: false  - name: "Teste: O dbPassword foi alterado?"assert:that:- conf is not changed- conf is not failed success_msg: "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"    fail_msg: "ERRO: O dbPassword não foi alterado no ficheiro configuration.php"  # A configuração do site leantime necessita que seja criado um site através de um ficheiro deB  # A configuração do site leantime necessita que seja criado um site através de um ficheiro de  # configuração, dentro das pasta do apache2. Deve existir um ficheiro de configuração do  # leantime em (/etc/apache2/sites-availableB  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-available/leantime.conf"stat:path: "/etc/apache2/sites-available/leantime.conf"  register: ficheiro  - name: "Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.isreg- ficheiro.stat.mode == "0777" - ficheiro.stat.pw_name == "root" - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permissões correctas"fail_msg: "ERRO: Permissões incorrectas"  # O site deve estar ativo no apache. Este teste vai verificar se o site se encontra ativo  # https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf"stat:path: "/etc/apache2/sites-enabled/leantime.conf"  register: ficheiro  - name: "Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permissões certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.islnk- ficheiro.stat.mode == "0777" - ficheiro.stat.pw_name == "root"- ficheiro.stat.mode == "0777" - ficheiro.stat.pw_name == "root" - ficheiro.stat.gr_name == "root" success_msg: "SUCESSO: Permissões correctas" fail_msg: "ERRO: Permissões incorrectas"  # https//docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/000-default.conf"stat:path: "/etc/apache2/sites-enabled/000-default.conf"  register: ficheiro  - name: "Teste: O ficheiro /etc/apache2/sites-enabled/000-default.conf NÃO existe?"assert:that:not ficheiro.stat.exists  - name: "Simulação: Activa o módulo mod_rewrite no apache"apache2_module:name: rewritestate: present    check_mode: true    register: estado  - name: "Simulação: Activa o módulo mod_rewrite no apache"apache2_module:  name: rewritestate: present  check_mode: trueregister: estado  - name: "Teste: o mod_rewrite do apache encontra-se ativo?"assert:that:- not estado.changedthat:- not estado.changedsuccess_msg: "SUCESSO: mod_rewrite encontra-se instalado e ativo"fail_msg: "ERRO: mod_rewrite não instalado ou não ativo!"  # Teste: Verificar se o sistema se encontra devidamente instalado e configurado.       Se a base de dados estiver correctamente configurada e se o administrador do  #        sistema estiver configurado, deve ser possível fazer login ao sistema sem problemas.B  #        Este teste tem como objetivo verificar se é possível fazer o login  # Através do BurpSuite (https://portswigger.net/burp), aprendido nas aulas de Testes de Penetração e Desenvolvimento de Exploits  # foi realizado um debug da sessão de login. Com base nessa sessão a fase de Login encontra-se aqui replicada.  # è necessário gravar a cockie de sessão. A página oficial do Ansible contem um erro que é resolvido com a seguinte...  # Fonte: https://stackoverflow.com/questions/63791689/ansible-looses-cookie-contentB- name: "Simulação: Tenta fazer login na aplicação com o utilizador criado"uri:url: http://localhostmethod: POST    body: "username={{ login_website  }}&password={{ password_website  }}&redirectUrl:=/&login=Login"  status_code: 200follow_redirects: trueregister: paginalogin  - name: "Simulação: Obtem a página showMyCalendar para testar uma página com o login efetuado com sucesso"uri:    url: http://localhost/calendar/showMyCalendar  method: GETheaders:  Cookie: "{{ paginalogin.set_cookie }}"  return_content: yespaginawebExiste o texto editCompanySettings na página?""'password' not in paginaweb.content""'password' not in paginaweb.content"- "'editCompanySettings' in paginaweb.content"success_msg: "SUCESSO: Login com sucesso. Utilizador e palavra passe iniciais correctamente criados"fail_msg: "ERRO: Não foi possivel fazer login! O utilizador ou palavra passe não foram criados com sucesso!"assert:- name: "Teste: Existe o texto editCompanySettings na página?"register: paginawebreturn_content: yesCookie: "{{ paginalogin.set_cookie }}"headers:method: GETurl: http://localhost/calendar/showMyCalendaruri:- name: "Simulação: Obtem a página showMyCalendar para testar uma página com o login efetuado com sucesso"register: paginaloginfollow_redirects: truestatus_code: 200body: "username={{ login_website  }}&password={{ password_website  }}&redirectUrl:=/&login=Login"method: POSTurl: http://localhosturi:- name: "Simulação: Tenta fazer login na aplicação com o utilizador criado"  # Fonte: https://stackoverflow.com/questions/63791689/ansible-looses-cookie-contentB  # Através do BurpSuite (https://portswigger.net/burp), aprendido nas aulas de Testes de Penetração e Desenvolvimento de Exploits  # foi realizado um debug da sessão de login. Com base nessa sessão a fase de Login encontra-se aqui replicada.  # è necessário gravar a cockie de sessão. A página oficial do Ansible contem um erro que é resolvido com a seguinte...B    #        Este teste tem como objetivo verificar se é possível fazer o login  B  #        sistema estiver configurado, deve ser possível fazer login ao sistema sem problemas.  B  #        Se a base de dados estiver correctamente configurada e se o administrador do  B  # Teste: Verificar se o sistema se encontra devidamente instalado e configurado.  Bfail_msg: "ERRO: mod_rewrite não instalado ou não ativo!"  success_msg: "SUCESSO: mod_rewrite encontra-se instalado e ativo"  - not estado.changed  that:  assert:  - name: "Teste: o mod_rewrite do apache encontra-se ativo?"  register: estado     
- name: "Teste: Existe o texto editCompanySettings na página?"  
assert:  
that:  
- "'password' not in paginaweb.content"  
- "'editCompanySettings' in paginaweb.content"  
success_msg: "SUCESSO: Login com sucesso. Utilizador e palavra passe iniciais correctamente criados"  
fail_msg: "ERRO: Não foi possivel fazer login! O utilizador ou palavra passe não foram criados com sucesso!"  
admlocal@devOps:~/leantime_ansible$ nano molecule/default/verify.yml molecule verify
INFO     default scenario test matrix: verify
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > verify
INFO     Running Ansible Verifier

PLAY [Infraestrutura conduzida por testes] ***********************************************************************************************

TASK [Variáveis] *************************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Atualizar a cache do sistema] *******************************************************************************************
ok: [ubuntu-20.04]

TASK [teste: a cache encontra-se actualizada?] *******************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Atualizar o sistema operativo (equivalente a apt upgrade)] *************************************************************************
ok: [ubuntu-20.04]

TASK [teste: o sistema operativo encontra-se atualizado?] ********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O sistema operativo está atualizado"
}

TASK [Teste: a cache encontra-se atualizada?] ********************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Simulação: testa se as aplicações dependencia do software leantime se encontram instaladas] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: as dependencias encontra-se instaladas?] ************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: As dependencias estavam instaladas"
}

TASK [Simulação: Testar se o serviço apache2 se encontra instalado, iniciado e ativo no arranque] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: O serviço apache2 encontra-se ativo no arranque no sistema, e está iniciado?] ***********************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O serviço apache2 está correctamente instalado e inicia com o arranque do sistema"
}

TASK [Rotina Auxiliar> Procura o caminho do ficheiro php.ini do servidor apache2] ********************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Ativa a opção file_uploads no ficheiro php.ini, utilizando o módulo lineinfile.] ****************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [Teste: As linhas do php.ini encontram-se alteradas ?] ******************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O ficheiro php.ini foi alterado com sucesso"
}

TASK [Simulação: Obtem informação sobre a pastas /var/www/leantime] **********************************************************************
ok: [ubuntu-20.04]

TASK [Teste: A pasta /var/www/leantime existe e tem as permissões certas?] ***************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas no site leantime"
}

TASK [Simulação: Verifica se é necessário criar a base de dados leantime_database] *******************************************************
ok: [ubuntu-20.04]

TASK [Teste: A base de dados leantime_database existe ?] *********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A base de dados leantime_database já se encontra criada"
}

TASK [Simulação e Teste: Verifica se o endereço git para a versão de leantime existe] ****************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Obtem informação sobre o ficheiro /var/www/leantime/config/configuration.php] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /var/www/leantime/config/configuration.php existe e tem as permissões certas?] ***********************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas e ficheiro configuration.php existente"
}

TASK [Simulação: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o módulo replace.] ******************************
ok: [ubuntu-20.04]

TASK [Teste: O dbUser foi alterado?] *****************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: a variável dbDatabase foi alterada?] ****************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: O dbPassword foi alterado?] *************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-available/leantime.conf] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?] ***********************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf] *********************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permissões certas?] *************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/000-default.conf] ******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-enabled/000-default.conf NÃO existe?] *********************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Simulação: Activa o módulo mod_rewrite no apache] **********************************************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Activa o módulo mod_rewrite no apache] **********************************************************************************
ok: [ubuntu-20.04]

TASK [Teste: o mod_rewrite do apache encontra-se ativo?] *********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: mod_rewrite encontra-se instalado e ativo"
}

TASK [Simulação: Tenta fazer login na aplicação com o utilizador criado] *****************************************************************
[WARNING]: The value True (type bool) in a string field was converted to 'True' (type string). If this does not look like what you
expect, quote the entire value to ensure it does not change.
ok: [ubuntu-20.04]

TASK [Simulação: Obtem a página showMyCalendar para testar uma página com o login efetuado com sucesso] **********************************
fatal: [ubuntu-20.04]: FAILED! => {"msg": "The task includes an option with an undefined variable. The error was: 'dict object' has no attribute 'set_cookie'\n\nThe error appears to be in '/home/admlocal/leantime_ansible/molecule/default/verify.yml': line 353, column 5, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n\n  - name: \"Simulação: Obtem a página showMyCalendar para testar uma página com o login efetuado com sucesso\"\n    ^ here\nThis one looks easy to fix. It seems that there is a value started\nwith a quote, and the YAML parser is expecting to see the line ended\nwith the same kind of quote. For instance:\n\n    when: \"ok\" in result.stdout\n\nCould be written as:\n\n   when: '\"ok\" in result.stdout'\n\nOr equivalently:\n\n   when: \"'ok' in result.stdout\"\n"}

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=36   changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0


CRITICAL Ansible return code was 2, command was: ansible-playbook --inventory /home/admlocal/.cache/molecule/leantime_ansible/default/inventory --skip-tags molecule-notest,notest /home/admlocal/leantime_ansible/molecule/default/verify.yml
admlocal@devOps:~/leantime_ansible$ molecule verifylint
INFO     default scenario test matrix: dependency, lint
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > dependency
WARNING  Skipping, missing the requirements file.
WARNING  Skipping, missing the requirements file.
INFO     Running default > lint
COMMAND: set -e
yamllint .
ansible-lint

Loading custom .yamllint config file, this extends our internal yamllint config.
admlocal@devOps:~/leantime_ansible$ molecule lintverifynano molecule/default/verify.yml 
BBB[ A ler... ]BB[ 368 linhas lidas ]BB  GNU nano 4.8                                          molecule/default/verify.yml                                                       BB^GB AjudaB^OB GravarB^WB ProcurarB^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtB^XB SairB^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txtB---# Tutorial de inspiração para a infraestrutura conduzida por teste no site# https://www.adictosaltrabajo.com/2020/05/08/ansible-testing-using-molecule-with-ansible-as-verifier/B- name: "Infraestrutura conduzida por testes"hosts: allgather_facts: falsebecome: truetasks:- name: Variáveisinclude_vars:file: ../../vars/main.yml- name: "Simulação: Atualizar a cache do sistema"apt:update_cache: truecache_valid_time: 3600check_mode: trueregister: estado- name: "teste: a cache encontra-se actualizada?"assert:that:- not estado.changedsuccess_msg: "SUCESSO: A cache está atualizada"fail_msg: "ERRO: Existem actualizações pendentes"- name: "Atualizar o sistema operativo (equivalente a apt upgrade)"apt:upgrade: safecheck_mode: trueregister: estado- name: "teste: o sistema operativo encontra-se atualizado?"  - name: "teste: o sistema operativo encontra-se atualizado?"    assert:that: - not estado.changed    success_msg: "SUCESSO: O sistema operativo está atualizado"    fail_msg: "ERRO: Existem actualizações pendentes"  - name: "Teste: a cache encontra-se atualizada?"  assert:    that:  - not estado.changedsuccess_msg: "SUCESSO: A cache está atualizada"fail_msg: "ERRO: Existem atualizações pendentes"  - name: "Simulação: testa se as aplicações dependencia do software leantime se encontram instaladas"apt:pkg:  - mc  - screen- git    - apache2  - mysql-server- phpphp-mysql- php-ldap- php-cli- php-soap    - php-json  - graphviz- php-xml  - php-gd  - php-zip- libapache2-mod-php    - php-dev- libapache2-mod-php    - php-dev  - libmcrypt-dev- gccmake- autoconf- libc-dev- pkg-config    - pwgen  - curl- unzipzip- php-mbstring- expect- net-tools    - python3-mysqldb  - python3-apt- python3-pycurlcheck_mode: trueregister: estado  - name: "Teste: as dependencias encontra-se instaladas?"assert:that:not estado.changedsuccess_msg: "SUCESSO: As dependencias estavam instaladas"fail_msg: "ERRO: Faltam instalar algumas dependencias. O software pode estar parcialmente instalado"  # Fonte de inspiração: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.htmlB- name: "Simulação: Testar se o serviço apache2 se encontra instalado, iniciado e ativo no arranque"service:name: apache2state: startedenabled: truecheck_mode: trueenabled: trueO serviço apache2 encontra-se ativo no arranque no sistema, e está iniciado?"O serviço apache2 está correctamente instalado e inicia com o arranque do sistema"O serviço apache2 não se encontra correcta: https://www.mydailytutorials.com/using--find-module-search-filesfolderBRotina Auxiliar> Procura o caminho do ficheiro php.ini do servidor apache2"find:paths: /etcpatterns: "php.ini"recurseregister: caminho_php_ini  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/lineinfile_module.htmlB- name: "Simulação: Ativa a opção file_uploads no ficheiro php.ini, utilizando o módulo lineinfile."ansible.builtin.lineinfile:path: "{{ caminho_php_ini.files[0].path }}"regexp: "{{ item.regexp  }}"line: "{{ item.line }}"with_items:- regexp: "^file_uploads"line: "file_uploads = 1"- regexp: "^upload_max_filesize"line: "upload_max_filesize = 1G"- regexp: "^max_file_uploads"line: "max_file_uploads = 20"- regexp: "^post_max_size"line: "post_max_size = 2G"- regexp: "^memory_limit"line: "post_max_size = 2G"- regexp: "^memory_limit"line: "memory_limit = 2G"- regexp: "^max_input_time"  line: "max_input_time = 3600"As linhas do php.ini encontram-se alteradas ?"ficheiro php.ini foi alterado com sucesso"Algumas alterações ao ficheiro php.ini não tiveram sucesso"O site deve existir na pasta /var/www/leantime. Este teste visa determinar se a pasta  # existe e se temas permissões certas  # Fonte de inspiração: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre a pastas /var/www/leantime"    stat:    path: "/var/www/leantime"register: pasta  - name: "Teste: A pasta /var/www/leantime existe e tem as permissões certas?"assert:  that:  - pasta.stat.exists- pasta.stat.isdir  - pasta.stat.mode == "0755"- pasta.stat.pw_name == "www-data"  - pasta.stat.gr_name == "www-data"success_msg: "SUCESSO: Permissões correctas no site leantime"fail_msg: "ERRO: Permissões incorrectas no site leantime ou site não existente"  # Outro dos requesitos é a existência de uma base de dados para o site.B  # Outro dos requesitos é a existência de uma base de dados para o site.  # Esta base de dados deve ser criada, logo tem de ser testada para determinar se ela existe ou não.  # Fonte de inspiração: https://serverfault.com/questions/173978/from-a-shell-script-how-can-i-check-whether-a-mysql-database-existsB- name: "Simulação: Verifica se é necessário criar a base de dados leantime_database"shell: "mysql -u root -e 'use leantime_database'"resultfailed_when: false  changed_when: false  - name: "Teste: A base de dados leantime_database existe ?"assert:that:- result.rc == 0success_msg: "SUCESSO: A base de dados leantime_database já se encontra criada"fail_msg: "ERRO: Não existe a base de dados leantime_database"  # Teste: O download do software leantime deve ser possível, a partir do site do leantimeB- name: "Simulação e Teste: Verifica se o endereço git para a versão de leantime existe"uri:url: https://github.com/Leantime/leantime/releases/download/{{ versao_leantime }}/Leantime-{{ versao_leantime }}.zipregister: resultadoTeste: Do ficheiro configuration.php no site do leantime. A existência deste ficheiro       com as permissões certas indica que o processo de unzip correu bemDocumentação oficial em: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlBo ficheiro /var/www/leantime/config/configuration.php"/config/configuration.php"ficheiroO ficheiro /var/www/leantime/config/configuration.php existe e tem as permissões certas?"ficheiro.stat.existsthat: - ficheiro.stat.exists - ficheiro.stat.isreg - ficheiro.stat.mode == "0755" - ficheiro.stat.pw_name == "www-data"    - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permissões correctas e ficheiro configuration.php existente"  fail_msg: "ERRO: Permissões incorrectas ou ficheiro configuration.php não existente"  # Teste: O ficheiro /var/www/leantime/config/configuration.php necessita de ser alterado.  # As variáveis dbuser, dbDatabase, e dbPassword necessitam de estar configuradas.  # Por simulação o sistema vai determinar se estas estão configuradas com o valor esperado.  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbUser=""' replace: 'dbUser="{{ login_leantime }}"'  check_mode: yesregister: conffailed_when: false  - name: "Teste: O dbUser foi alterado?"    assert: that: - conf is not changed    - conf is not failed  success_msg: "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"fail_msg: "ERRO: O dbUser não foi alterado no ficheiro configuration.php"  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:path: /var/www/leantime/config/configuration.php    ansible.builtin.replace:path: /var/www/leantime/config/configuration.phpregexp: 'dbDatabase=""'replace: 'dbDatabase="leantime_database"'check_mode: yesregister: conffailed_when: false  - name: "Teste: a variável dbDatabase foi alterada?"    assert: that: - conf is not changed - conf is not failed    success_msg: "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"  fail_msg: "ERRO: O dbDatabase não foi alterado no ficheiro configuration.php"  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/replace_module.htmlB- name: "Simulação: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o módulo replace."ansible.builtin.replace:  path: /var/www/leantime/config/configuration.php  regexp: 'dbPassword=""'replace: 'dbPassword="{{ password_leantime }}"'  check_mode: yesregister: conffailed_when: false  - name: "Teste: O dbPassword foi alterado?"assert:that:- conf is not changed- conf is not failed success_msg: "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"    fail_msg: "ERRO: O dbPassword não foi alterado no ficheiro configuration.php"  # A configuração do site leantime necessita que seja criado um site através de um ficheiro deB  # A configuração do site leantime necessita que seja criado um site através de um ficheiro de  # configuração, dentro das pasta do apache2. Deve existir um ficheiro de configuração do  # leantime em (/etc/apache2/sites-availableB  # Fonte: https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-available/leantime.conf"stat:path: "/etc/apache2/sites-available/leantime.conf"  register: ficheiro  - name: "Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.isreg- ficheiro.stat.mode == "0777" - ficheiro.stat.pw_name == "root" - ficheiro.stat.gr_name == "www-data"  success_msg: "SUCESSO: Permissões correctas"fail_msg: "ERRO: Permissões incorrectas"  # O site deve estar ativo no apache. Este teste vai verificar se o site se encontra ativo  # https://docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf"stat:path: "/etc/apache2/sites-enabled/leantime.conf"  register: ficheiro  - name: "Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permissões certas?"assert:that:  - ficheiro.stat.exists  - ficheiro.stat.islnk- ficheiro.stat.mode == "0777" - ficheiro.stat.pw_name == "root"- ficheiro.stat.mode == "0777" - ficheiro.stat.pw_name == "root" - ficheiro.stat.gr_name == "root" success_msg: "SUCESSO: Permissões correctas" fail_msg: "ERRO: Permissões incorrectas"  # https//docs.ansible.com/ansible/latest/collections/ansible/builtin/stat_module.htmlB- name: "Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/000-default.conf"stat:path: "/etc/apache2/sites-enabled/000-default.conf"  register: ficheiro  - name: "Teste: O ficheiro /etc/apache2/sites-enabled/000-default.conf NÃO existe?"assert:that:not ficheiro.stat.exists  - name: "Simulação: Activa o módulo mod_rewrite no apache"apache2_module:name: rewritestate: present    check_mode: true    register: estado  - name: "Simulação: Activa o módulo mod_rewrite no apache"apache2_module:  name: rewritestate: present  check_mode: trueregister: estado  - name: "Teste: o mod_rewrite do apache encontra-se ativo?"assert:that:- not estado.changedthat:- not estado.changedsuccess_msg: "SUCESSO: mod_rewrite encontra-se instalado e ativo"fail_msg: "ERRO: mod_rewrite não instalado ou não ativo!"  # Teste: Verificar se o sistema se encontra devidamente instalado e configurado.       Se a base de dados estiver correctamente configurada e se o administrador do  #        sistema estiver configurado, deve ser possível fazer login ao sistema sem problemas.B  #        Este teste tem como objetivo verificar se é possível fazer o login  # Através do BurpSuite (https://portswigger.net/burp), aprendido nas aulas de Testes de Penetração e Desenvolvimento de Exploits  # foi realizado um debug da sessão de login. Com base nessa sessão a fase de Login encontra-se aqui replicada.  # è necessário gravar a cockie de sessão. A página oficial do Ansible contem um erro que é resolvido com a seguinte...  # Fonte: https://stackoverflow.com/questions/63791689/ansible-looses-cookie-contentB- name: "Simulação: Tenta fazer login na aplicação com o utilizador criado"uri:url: http://localhostmethod: POST    body: "username={{ login_website  }}&password={{ password_website  }}&redirectUrl:=/&login=Login"  status_code: 200follow_redirects: trueregister: paginalogin  - name: "Simulação: Obtem a página showMyCalendar para testar uma página com o login efetuado com sucesso"uri:    url: http://localhost/calendar/showMyCalendar  method: GETheaders:  Cookie: "{{ paginalogin.set_cookie }}"  return_content: yespaginawebExiste o texto editCompanySettings na página?""'password' not in paginaweb.content""'password' not in paginaweb.content"- "'editCompanySettings' in paginaweb.content"success_msg: "SUCESSO: Login com sucesso. Utilizador e palavra passe iniciais correctamente criados"fail_msg: "ERRO: Não foi possivel fazer login! O utilizador ou palavra passe não foram criados com sucesso!"assert:- name: "Teste: Existe o texto editCompanySettings na página?"register: paginawebreturn_content: yesCookie: "{{ paginalogin.set_cookie }}"headers:method: GETurl: http://localhost/calendar/showMyCalendaruri:- name: "Simulação: Obtem a página showMyCalendar para testar uma página com o login efetuado com sucesso"register: paginaloginfollow_redirects: truestatus_code: 200body: "username={{ login_website  }}&password={{ password_website  }}&redirectUrl:=/&login=Login"method: POSTurl: http://localhosturi:- name: "Simulação: Tenta fazer login na aplicação com o utilizador criado"  # Fonte: https://stackoverflow.com/questions/63791689/ansible-looses-cookie-contentB  # è necessário gravar a cockie de sessão. A página oficial do Ansible contem um erro que é resolvido com a seguinte...B  # foi realizado um debug da sessão de login. Com base nessa sessão a fase de Login encontra-se aqui replicada.B  # Através do BurpSuite (https://portswigger.net/burp), aprendido nas aulas de Testes de Penetração e Desenvolvimento de ExploitsB          #        Este teste tem como objetivo verificar se é possível fazer o loginB  #        Se a base de dados estiver correctamente configurada e se o administrador do  #        sistema estiver configurado, deve ser possível fazer login ao sistema sem problemas.B  # Teste: Verificar se o sistema se encontra devidamente instalado e configurado.Bfail_msg: "ERRO: mod_rewrite não instalado ou não ativo!"success_msg: "SUCESSO: mod_rewrite encontra-se instalado e ativo"- not estado.changedthat:assert:- name: "Teste: o mod_rewrite do apache encontra-se ativo?"register: estado     BModificadoB ""{{ paginalogin.set_cookie }}"GET
- name: "Teste: Existe o texto editCompanySettings na página?"
assert:
that:
- "'password' not in paginaweb.content"
- "'editCompanySettings' in paginaweb.content"
success_msg: "SUCESSO: Login com sucesso. Utilizador e palavra passe iniciais correctamente criados"
fail_msg: "ERRO: Não foi possivel fazer login! O utilizador ou palavra passe não foram criados com sucesso!"
         BM-DB Formato DOSBM-AB AnexarBBB SegurançaBCB Cancelar           BM-MB Formato MacBM-PB PreporB^TB P/ ficheirosBNome do ficheiro onde escrever: molecule/default/verify.yml                                                                               B B[ A escrever... ]BB          BB[ 368 linhas escritas ]BB^OB GravarB^WB Procurar      B^KB Cortar txt    B^JB Justificar    B^CB Pos cursorBUB Desfazer     BM-AB Marcar txtBXB Sair    B^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB Refazer      BM-6B Copiar txtadmlocal@devOps:~/leantime_ansible$ nano molecule/default/verify.yml molecule lintverify
INFO     default scenario test matrix: verify
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > verify
INFO     Running Ansible Verifier

PLAY [Infraestrutura conduzida por testes] ***********************************************************************************************

TASK [Variáveis] *************************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Atualizar a cache do sistema] *******************************************************************************************
ok: [ubuntu-20.04]

TASK [teste: a cache encontra-se actualizada?] *******************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Atualizar o sistema operativo (equivalente a apt upgrade)] *************************************************************************
ok: [ubuntu-20.04]

TASK [teste: o sistema operativo encontra-se atualizado?] ********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O sistema operativo está atualizado"
}

TASK [Teste: a cache encontra-se atualizada?] ********************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Simulação: testa se as aplicações dependencia do software leantime se encontram instaladas] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: as dependencias encontra-se instaladas?] ************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: As dependencias estavam instaladas"
}

TASK [Simulação: Testar se o serviço apache2 se encontra instalado, iniciado e ativo no arranque] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: O serviço apache2 encontra-se ativo no arranque no sistema, e está iniciado?] ***********************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O serviço apache2 está correctamente instalado e inicia com o arranque do sistema"
}

TASK [Rotina Auxiliar> Procura o caminho do ficheiro php.ini do servidor apache2] ********************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Ativa a opção file_uploads no ficheiro php.ini, utilizando o módulo lineinfile.] ****************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [Teste: As linhas do php.ini encontram-se alteradas ?] ******************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O ficheiro php.ini foi alterado com sucesso"
}

TASK [Simulação: Obtem informação sobre a pastas /var/www/leantime] **********************************************************************
ok: [ubuntu-20.04]

TASK [Teste: A pasta /var/www/leantime existe e tem as permissões certas?] ***************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas no site leantime"
}

TASK [Simulação: Verifica se é necessário criar a base de dados leantime_database] *******************************************************
ok: [ubuntu-20.04]

TASK [Teste: A base de dados leantime_database existe ?] *********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A base de dados leantime_database já se encontra criada"
}

TASK [Simulação e Teste: Verifica se o endereço git para a versão de leantime existe] ****************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Obtem informação sobre o ficheiro /var/www/leantime/config/configuration.php] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /var/www/leantime/config/configuration.php existe e tem as permissões certas?] ***********************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas e ficheiro configuration.php existente"
}

TASK [Simulação: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o módulo replace.] ******************************
ok: [ubuntu-20.04]

TASK [Teste: O dbUser foi alterado?] *****************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: a variável dbDatabase foi alterada?] ****************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: O dbPassword foi alterado?] *************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-available/leantime.conf] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?] ***********************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf] *********************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permissões certas?] *************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/000-default.conf] ******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-enabled/000-default.conf NÃO existe?] *********************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Simulação: Activa o módulo mod_rewrite no apache] **********************************************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Activa o módulo mod_rewrite no apache] **********************************************************************************
ok: [ubuntu-20.04]

TASK [Teste: o mod_rewrite do apache encontra-se ativo?] *********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: mod_rewrite encontra-se instalado e ativo"
}

TASK [Simulação: Tenta fazer login na aplicação com o utilizador criado] *****************************************************************
[WARNING]: The value True (type bool) in a string field was converted to 'True' (type string). If this does not look like what you
expect, quote the entire value to ensure it does not change.
ok: [ubuntu-20.04]

TASK [Simulação: Obtem a página showMyCalendar para testar uma página com o login efetuado com sucesso] **********************************
fatal: [ubuntu-20.04]: FAILED! => {"msg": "The task includes an option with an undefined variable. The error was: 'dict object' has no attribute 'set_cookie'\n\nThe error appears to be in '/home/admlocal/leantime_ansible/molecule/default/verify.yml': line 353, column 5, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n\n  - name: \"Simulação: Obtem a página showMyCalendar para testar uma página com o login efetuado com sucesso\"\n    ^ here\nThis one looks easy to fix. It seems that there is a value started\nwith a quote, and the YAML parser is expecting to see the line ended\nwith the same kind of quote. For instance:\n\n    when: \"ok\" in result.stdout\n\nCould be written as:\n\n   when: '\"ok\" in result.stdout'\n\nOr equivalently:\n\n   when: \"'ok' in result.stdout\"\n"}

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=36   changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0


CRITICAL Ansible return code was 2, command was: ansible-playbook --inventory /home/admlocal/.cache/molecule/leantime_ansible/default/inventory --skip-tags molecule-notest,notest /home/admlocal/leantime_ansible/molecule/default/verify.yml
admlocal@devOps:~/leantime_ansible$ molecule verifynano molecule/default/verify.yml 
BBB[ A ler... ]BB[ 368 linhas lidas ]BB  GNU nano 4.8                                          molecule/default/verify.yml                                                       BB^GB AjudaB^OB GravarB^WB ProcurarB^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtB^XB SairB^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txtB---# Tutorial de inspiração para a infraestrutura conduzida por teste no site# https://www.adictosaltrabajo.com/2020/05/08/ansible-testing-using-molecule-with-ansible-as-verifier/B- name: "Infraestrutura conduzida por testes"hosts: allgather_facts: falsebecome: truetasks:- name: Variáveisinclude_vars:file: ../../vars/main.yml- name: "Simulação: Atualizar a cache do sistema"apt:update_cache: truecache_valid_time: 3600check_mode: trueregister: estado- name: "teste: a cache encontra-se actualizada?"assert:that:- not estado.changedsuccess_msg: "SUCESSO: A cache está atualizada"fail_msg: "ERRO: Existem actualizações pendentes"- name: "Atualizar o sistema operativo (equivalente a apt upgrade)"apt:upgrade: safecheck_mode: trueregister: estado- name: "teste: o sistema operativo encontra-se atualizado?"         In. parágB^YB Prim.linhaB^TB Ir para txtBCB Cancelar           BOB Fim parágBVB Últ. linhaBInsira nº da linha, nº da coluna:                                                                                                         BB3BB5BB3BB,BB5BB^OB GravarProcurar      B^KB Cortar txt    B^JB Justificar    B^CB Pos cursor    BM-UB Desfazer     BM-AB Marcar txtBXB Sair    B^RB CarregarB\B Substituir    B^UB Colar txtBTB Ortografia    B^_B Ir p/ linha   BM-EB RefazerBM-6B Copiar txt  # Teste: Verificar se o sistema se encontra devidamente instalado e configurado.  #        Se a base de dados estiver correctamente configurada e se o administrador do  #        sistema estiver configurado, deve ser possível fazer login ao sistema sem problemas.B  #        Este teste tem como objetivo verificar se é possível fazer o login  # Através do BurpSuite (https://portswigger.net/burp), aprendido nas aulas de Testes de Penetração e Desenvolvimento de Exploits  # foi realizado um debug da sessão de login. Com base nessa sessão a fase de Login encontra-se aqui replicada.  # è necessário gravar a cockie de sessão. A página oficial do Ansible contem um erro que é resolvido com a seguinte...  # Fonte: https://stackoverflow.com/questions/63791689/ansible-looses-cookie-contentB- name: "Simulação: Tenta fazer login na aplicação com o utilizador criado"  uri    url: http://localhost  method: POSTbody: "username={{ login_website  }}&password={{ password_website  }}&redirectUrl:=/&login=Login"status_code: 200    follow_redirects: trueregister: paginalogin  - name: "Simulação: Obtem a página showMyCalendar para testar uma página com o login efetuado com sucesso"uri:url: http://localhost/calendar/showMyCalendarmethod: GETheaders:Cookie: "{{ paginalogin.set_cookie }}"  return_content: yespaginawebTExiste o texto editCompanySettings na página?""'password' not in paginaweb.content"- "'editCompanySettings' in paginaweb.content"  success_msg: "SUCESSO: Login com sucesso. Utilizador e palavra passe iniciais correctamente criados"  fail_msg: "ERRO: Não foi possivel fazer login! O utilizador ou palavra passe não foram criados com sucesso!"    name: "SBModificadoB""imulação: Tenta fazer login na aplicação com o utilizador criado"  - name:  "      body: "u"username={{ login_website  }}&password={{ password_website  }}&redirectUrl:=/&login=Login" "      body: "username={{ login_website  }}&password={{ password_website  - name: ""Simulação: Obtem a página showMyCalendar para testar uma página com o login efetuado com sucesso" " """{{ paginalogin.set_cookie }}""Teste: Existe o texto editCompanySettings na página?" "      - ""'password' not in paginaweb.content" " """'editCompanySettings' in paginaweb.content":: "Simulação: Tenta fazer login na aplicação com o utilizador criado"fail_msg: "ERRO: mod_rewrite não instalado ou não ativo!"success_msg: "SUCESSO: mod_rewrite encontra-se instalado e ativo"- not estado.changedthat:assert:- name: "Teste: o mod_rewrite do apache encontra-se ativo?"register: estadocheck_mode: true  sg: "É necessário gravar a cockie de sessão. A página oficial do Ansible contem um erro que é resolvido com a seguinte...B         BM-DB Formato DOSBM-AB AnexarBBB SegurançaBCB Cancelar           BM-MB Formato MacBM-PB PreporB^TB P/ ficheirosBNome do ficheiro onde escrever: molecule/default/verify.yml                                                                               B B[ A escrever... ]BB          BB[ 368 linhas escritas ]BB^OB GravarB^WB Procurar      B^KB Cortar txt    B^JB Justificar    B^CB Pos cursorBUB Desfazer     BM-AB Marcar txtBXB Sair    B^RB CarregarB^\B Substituir    B^UB Colar txt     B^TB Ortografia    B^_B Ir p/ linha   BM-EB Refazer      BM-6B Copiar txtadmlocal@devOps:~/leantime_ansible$ molecule lint
INFO     default scenario test matrix: dependency, lint
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > dependency
WARNING  Skipping, missing the requirements file.
WARNING  Skipping, missing the requirements file.
INFO     Running default > lint
COMMAND: set -e
yamllint .
ansible-lint

Loading custom .yamllint config file, this extends our internal yamllint config.
admlocal@devOps:~/leantime_ansible$ molecule lintverify
INFO     default scenario test matrix: verify
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > verify
INFO     Running Ansible Verifier

PLAY [Infraestrutura conduzida por testes] ***********************************************************************************************

TASK [Variáveis] *************************************************************************************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Atualizar a cache do sistema] *******************************************************************************************
ok: [ubuntu-20.04]

TASK [teste: a cache encontra-se actualizada?] *******************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Atualizar o sistema operativo (equivalente a apt upgrade)] *************************************************************************
ok: [ubuntu-20.04]

TASK [teste: o sistema operativo encontra-se atualizado?] ********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O sistema operativo está atualizado"
}

TASK [Teste: a cache encontra-se atualizada?] ********************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Simulação: testa se as aplicações dependencia do software leantime se encontram instaladas] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: as dependencias encontra-se instaladas?] ************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: As dependencias estavam instaladas"
}

TASK [Simulação: Testar se o serviço apache2 se encontra instalado, iniciado e ativo no arranque] ****************************************
ok: [ubuntu-20.04]

TASK [Teste: O serviço apache2 encontra-se ativo no arranque no sistema, e está iniciado?] ***********************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O serviço apache2 está correctamente instalado e inicia com o arranque do sistema"
}

TASK [Rotina Auxiliar> Procura o caminho do ficheiro php.ini do servidor apache2] ********************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Ativa a opção file_uploads no ficheiro php.ini, utilizando o módulo lineinfile.] ****************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'})
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'})
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'})
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'})

TASK [Teste: As linhas do php.ini encontram-se alteradas ?] ******************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O ficheiro php.ini foi alterado com sucesso"
}

TASK [Simulação: Obtem informação sobre a pastas /var/www/leantime] **********************************************************************
ok: [ubuntu-20.04]

TASK [Teste: A pasta /var/www/leantime existe e tem as permissões certas?] ***************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas no site leantime"
}

TASK [Simulação: Verifica se é necessário criar a base de dados leantime_database] *******************************************************
ok: [ubuntu-20.04]

TASK [Teste: A base de dados leantime_database existe ?] *********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A base de dados leantime_database já se encontra criada"
}

TASK [Simulação e Teste: Verifica se o endereço git para a versão de leantime existe] ****************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Obtem informação sobre o ficheiro /var/www/leantime/config/configuration.php] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /var/www/leantime/config/configuration.php existe e tem as permissões certas?] ***********************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas e ficheiro configuration.php existente"
}

TASK [Simulação: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o módulo replace.] ******************************
ok: [ubuntu-20.04]

TASK [Teste: O dbUser foi alterado?] *****************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: a variável dbDatabase foi alterada?] ****************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04]

TASK [Teste: O dbPassword foi alterado?] *************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-available/leantime.conf] *******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?] ***********************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf] *********************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permissões certas?] *************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/000-default.conf] ******************************************
ok: [ubuntu-20.04]

TASK [Teste: O ficheiro /etc/apache2/sites-enabled/000-default.conf NÃO existe?] *********************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Simulação: Activa o módulo mod_rewrite no apache] **********************************************************************************
ok: [ubuntu-20.04]

TASK [Simulação: Activa o módulo mod_rewrite no apache] **********************************************************************************
ok: [ubuntu-20.04]

TASK [Teste: o mod_rewrite do apache encontra-se ativo?] *********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: mod_rewrite encontra-se instalado e ativo"
}

TASK [Simulação: Tenta fazer login na aplicação com o utilizador criado] *****************************************************************
[WARNING]: The value True (type bool) in a string field was converted to 'True' (type string). If this does not look like what you
expect, quote the entire value to ensure it does not change.
ok: [ubuntu-20.04]

TASK [Simulação: Obtem a página showMyCalendar para testar uma página com o login efetuado com sucesso] **********************************
fatal: [ubuntu-20.04]: FAILED! => {"msg": "The task includes an option with an undefined variable. The error was: 'dict object' has no attribute 'set_cookie'\n\nThe error appears to be in '/home/admlocal/leantime_ansible/molecule/default/verify.yml': line 353, column 5, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n\n  - name: \"Simulação: Obtem a página showMyCalendar para testar uma página com o login efetuado com sucesso\"\n    ^ here\nThis one looks easy to fix. It seems that there is a value started\nwith a quote, and the YAML parser is expecting to see the line ended\nwith the same kind of quote. For instance:\n\n    when: \"ok\" in result.stdout\n\nCould be written as:\n\n   when: '\"ok\" in result.stdout'\n\nOr equivalently:\n\n   when: \"'ok' in result.stdout\"\n"}

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=36   changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0


CRITICAL Ansible return code was 2, command was: ansible-playbook --inventory /home/admlocal/.cache/molecule/leantime_ansible/default/inventory --skip-tags molecule-notest,notest /home/admlocal/leantime_ansible/molecule/default/verify.yml
admlocal@devOps:~/leantime_ansible$ molecule verify --debug
Usage: molecule verify [OPTIONS]
Try "molecule verify --help" for help.

Error: no such option: --debug
admlocal@devOps:~/leantime_ansible$ molecuule verify --debug-verifyverify verify
DEBUG    Validating schema /home/admlocal/leantime_ansible/molecule/default/molecule.yml.
INFO     default scenario test matrix: verify
INFO     Performing prerun...
INFO     Using .cache/roles/nunomourinho.leantime_ansible symlink to current repository in order to enable Ansible to find the role using its expected full name.
INFO     Added ANSIBLE_ROLES_PATH=~/.ansible/roles:/usr/share/ansible/roles:/etc/ansible/roles:./.cache/roles
INFO     Running default > verify
INFO     Running Ansible Verifier
Using /home/admlocal/.cache/molecule/leantime_ansible/default/ansible.cfg as config file

PLAY [Infraestrutura conduzida por testes] ***********************************************************************************************

TASK [Variáveis] *************************************************************************************************************************
ok: [ubuntu-20.04] => {"ansible_facts": {"login_leantime": "leantimeDBadmin", "login_website": "my_name@my_email.com", "password_leantime": "#S3gr3d0S3cr3t0#", "password_website": "S3cr3tPwd@V3ryS3cret«", "versao_leantime": "v2.1.7"}, "ansible_included_var_files": ["/home/admlocal/leantime_ansible/molecule/default/../../vars/main.yml"], "changed": false}

TASK [Simulação: Atualizar a cache do sistema] *******************************************************************************************
ok: [ubuntu-20.04] => {"ansible_facts": {"discovered_interpreter_python": "/usr/bin/python3"}, "cache_update_time": 1622020250, "cache_updated": false, "changed": false}

TASK [teste: a cache encontra-se actualizada?] *******************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Atualizar o sistema operativo (equivalente a apt upgrade)] *************************************************************************
ok: [ubuntu-20.04] => {"changed": false, "msg": "Reading package lists...\nBuilding dependency tree...\nReading state information...\nCalculating upgrade...\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\n", "stderr": "", "stderr_lines": [], "stdout": "Reading package lists...\nBuilding dependency tree...\nReading state information...\nCalculating upgrade...\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\n", "stdout_lines": ["Reading package lists...", "Building dependency tree...", "Reading state information...", "Calculating upgrade...", "0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded."]}

TASK [teste: o sistema operativo encontra-se atualizado?] ********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O sistema operativo está atualizado"
}

TASK [Teste: a cache encontra-se atualizada?] ********************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A cache está atualizada"
}

TASK [Simulação: testa se as aplicações dependencia do software leantime se encontram instaladas] ****************************************
ok: [ubuntu-20.04] => {"cache_update_time": 1622020250, "cache_updated": false, "changed": false}

TASK [Teste: as dependencias encontra-se instaladas?] ************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: As dependencias estavam instaladas"
}

TASK [Simulação: Testar se o serviço apache2 se encontra instalado, iniciado e ativo no arranque] ****************************************
ok: [ubuntu-20.04] => {"changed": false, "enabled": true, "name": "apache2", "state": "started", "status": {"ActiveEnterTimestamp": "Tue 2021-05-25 23:38:38 UTC", "ActiveEnterTimestampMonotonic": "326035816", "ActiveExitTimestampMonotonic": "0", "ActiveState": "active", "After": "remote-fs.target systemd-tmpfiles-setup.service basic.target network.target sysinit.target nss-lookup.target systemd-journald.socket -.mount system.slice", "AllowIsolate": "no", "AllowedCPUs": "", "AllowedMemoryNodes": "", "AmbientCapabilities": "", "AssertResult": "yes", "AssertTimestamp": "Tue 2021-05-25 23:38:37 UTC", "AssertTimestampMonotonic": "325941816", "Before": "multi-user.target shutdown.target", "BlockIOAccounting": "no", "BlockIOWeight": "[not set]", "CPUAccounting": "no", "CPUAffinity": "", "CPUAffinityFromNUMA": "no", "CPUQuotaPerSecUSec": "infinity", "CPUQuotaPeriodUSec": "infinity", "CPUSchedulingPolicy": "0", "CPUSchedulingPriority": "0", "CPUSchedulingResetOnFork": "no", "CPUShares": "[not set]", "CPUUsageNSec": "[not set]", "CPUWeight": "[not set]", "CacheDirectoryMode": "0755", "CanIsolate": "no", "CanReload": "yes", "CanStart": "yes", "CanStop": "yes", "CapabilityBoundingSet": "cap_chown cap_dac_override cap_dac_read_search cap_fowner cap_fsetid cap_kill cap_setgid cap_setuid cap_setpcap cap_linux_immutable cap_net_bind_service cap_net_broadcast cap_net_admin cap_net_raw cap_ipc_lock cap_ipc_owner cap_sys_module cap_sys_rawio cap_sys_chroot cap_sys_ptrace cap_sys_pacct cap_sys_admin cap_sys_boot cap_sys_nice cap_sys_resource cap_sys_time cap_sys_tty_config cap_mknod cap_lease cap_audit_write cap_audit_control cap_setfcap cap_mac_override cap_mac_admin cap_syslog cap_wake_alarm cap_block_suspend cap_audit_read", "CleanResult": "success", "CollectMode": "inactive", "ConditionResult": "yes", "ConditionTimestamp": "Tue 2021-05-25 23:38:37 UTC", "ConditionTimestampMonotonic": "325941816", "ConfigurationDirectoryMode": "0755", "Conflicts": "shutdown.target", "ControlGroup": "/system.slice/apache2.service", "ControlPID": "0", "DefaultDependencies": "yes", "DefaultMemoryLow": "0", "DefaultMemoryMin": "0", "Delegate": "no", "Description": "The Apache HTTP Server", "DevicePolicy": "auto", "Documentation": "https://httpd.apache.org/docs/2.4/", "DynamicUser": "no", "EffectiveCPUs": "", "EffectiveMemoryNodes": "", "Environment": "APACHE_STARTED_BY_SYSTEMD=true", "ExecMainCode": "0", "ExecMainExitTimestampMonotonic": "0", "ExecMainPID": "28018", "ExecMainStartTimestamp": "Tue 2021-05-25 23:38:38 UTC", "ExecMainStartTimestampMonotonic": "326035787", "ExecMainStatus": "0", "ExecReload": "{ path=/usr/sbin/apachectl ; argv[]=/usr/sbin/apachectl graceful ; ignore_errors=no ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }", "ExecReloadEx": "{ path=/usr/sbin/apachectl ; argv[]=/usr/sbin/apachectl graceful ; flags= ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }", "ExecStart": "{ path=/usr/sbin/apachectl ; argv[]=/usr/sbin/apachectl start ; ignore_errors=no ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }", "ExecStartEx": "{ path=/usr/sbin/apachectl ; argv[]=/usr/sbin/apachectl start ; flags= ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }", "ExecStop": "{ path=/usr/sbin/apachectl ; argv[]=/usr/sbin/apachectl stop ; ignore_errors=no ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }", "ExecStopEx": "{ path=/usr/sbin/apachectl ; argv[]=/usr/sbin/apachectl stop ; flags= ; start_time=[n/a] ; stop_time=[n/a] ; pid=0 ; code=(null) ; status=0/0 }", "FailureAction": "none", "FileDescriptorStoreMax": "0", "FinalKillSignal": "9", "FragmentPath": "/lib/systemd/system/apache2.service", "GID": "[not set]", "GuessMainPID": "yes", "IOAccounting": "no", "IOReadBytes": "18446744073709551615", "IOReadOperations": "18446744073709551615", "IOSchedulingClass": "0", "IOSchedulingPriority": "0", "IOWeight": "[not set]", "IOWriteBytes": "18446744073709551615", "IOWriteOperations": "18446744073709551615", "IPAccounting": "no", "IPEgressBytes": "[no data]", "IPEgressPackets": "[no data]", "IPIngressBytes": "[no data]", "IPIngressPackets": "[no data]", "Id": "apache2.service", "IgnoreOnIsolate": "no", "IgnoreSIGPIPE": "yes", "InactiveEnterTimestampMonotonic": "0", "InactiveExitTimestamp": "Tue 2021-05-25 23:38:37 UTC", "InactiveExitTimestampMonotonic": "325944063", "InvocationID": "bcaf796d984f4659b3246e96f4dde8f2", "JobRunningTimeoutUSec": "infinity", "JobTimeoutAction": "none", "JobTimeoutUSec": "infinity", "KeyringMode": "private", "KillMode": "control-group", "KillSignal": "15", "LimitAS": "infinity", "LimitASSoft": "infinity", "LimitCORE": "infinity", "LimitCORESoft": "0", "LimitCPU": "infinity", "LimitCPUSoft": "infinity", "LimitDATA": "infinity", "LimitDATASoft": "infinity", "LimitFSIZE": "infinity", "LimitFSIZESoft": "infinity", "LimitLOCKS": "infinity", "LimitLOCKSSoft": "infinity", "LimitMEMLOCK": "65536", "LimitMEMLOCKSoft": "65536", "LimitMSGQUEUE": "819200", "LimitMSGQUEUESoft": "819200", "LimitNICE": "0", "LimitNICESoft": "0", "LimitNOFILE": "524288", "LimitNOFILESoft": "1024", "LimitNPROC": "7814", "LimitNPROCSoft": "7814", "LimitRSS": "infinity", "LimitRSSSoft": "infinity", "LimitRTPRIO": "0", "LimitRTPRIOSoft": "0", "LimitRTTIME": "infinity", "LimitRTTIMESoft": "infinity", "LimitSIGPENDING": "7814", "LimitSIGPENDINGSoft": "7814", "LimitSTACK": "infinity", "LimitSTACKSoft": "8388608", "LoadState": "loaded", "LockPersonality": "no", "LogLevelMax": "-1", "LogRateLimitBurst": "0", "LogRateLimitIntervalUSec": "0", "LogsDirectoryMode": "0755", "MainPID": "28018", "MemoryAccounting": "yes", "MemoryCurrent": "17825792", "MemoryDenyWriteExecute": "no", "MemoryHigh": "infinity", "MemoryLimit": "infinity", "MemoryLow": "0", "MemoryMax": "infinity", "MemoryMin": "0", "MemorySwapMax": "infinity", "MountAPIVFS": "no", "MountFlags": "", "NFileDescriptorStore": "0", "NRestarts": "0", "NUMAMask": "", "NUMAPolicy": "n/a", "Names": "apache2.service", "NeedDaemonReload": "no", "Nice": "0", "NoNewPrivileges": "no", "NonBlocking": "no", "NotifyAccess": "none", "OOMPolicy": "stop", "OOMScoreAdjust": "0", "OnFailureJobMode": "replace", "Perpetual": "no", "PrivateDevices": "no", "PrivateMounts": "no", "PrivateNetwork": "no", "PrivateTmp": "yes", "PrivateUsers": "no", "ProtectControlGroups": "no", "ProtectHome": "no", "ProtectHostname": "no", "ProtectKernelLogs": "no", "ProtectKernelModules": "no", "ProtectKernelTunables": "no", "ProtectSystem": "no", "RefuseManualStart": "no", "RefuseManualStop": "no", "ReloadResult": "success", "RemainAfterExit": "no", "RemoveIPC": "no", "Requires": "-.mount system.slice sysinit.target", "RequiresMountsFor": "/tmp /var/tmp", "Restart": "on-abort", "RestartKillSignal": "15", "RestartUSec": "100ms", "RestrictNamespaces": "no", "RestrictRealtime": "no", "RestrictSUIDSGID": "no", "Result": "success", "RootDirectoryStartOnly": "no", "RuntimeDirectoryMode": "0755", "RuntimeDirectoryPreserve": "no", "RuntimeMaxUSec": "infinity", "SameProcessGroup": "no", "SecureBits": "0", "SendSIGHUP": "no", "SendSIGKILL": "yes", "Slice": "system.slice", "StandardError": "inherit", "StandardInput": "null", "StandardInputData": "", "StandardOutput": "journal", "StartLimitAction": "none", "StartLimitBurst": "5", "StartLimitIntervalUSec": "10s", "StartupBlockIOWeight": "[not set]", "StartupCPUShares": "[not set]", "StartupCPUWeight": "[not set]", "StartupIOWeight": "[not set]", "StateChangeTimestamp": "Tue 2021-05-25 23:38:38 UTC", "StateChangeTimestampMonotonic": "326035816", "StateDirectoryMode": "0755", "StatusErrno": "0", "StopWhenUnneeded": "no", "SubState": "running", "SuccessAction": "none", "SyslogFacility": "3", "SyslogLevel": "6", "SyslogLevelPrefix": "yes", "SyslogPriority": "30", "SystemCallErrorNumber": "0", "TTYReset": "no", "TTYVHangup": "no", "TTYVTDisallocate": "no", "TasksAccounting": "yes", "TasksCurrent": "6", "TasksMax": "2344", "TimeoutAbortUSec": "1min 30s", "TimeoutCleanUSec": "infinity", "TimeoutStartUSec": "1min 30s", "TimeoutStopUSec": "1min 30s", "TimerSlackNSec": "50000", "Transient": "no", "Type": "forking", "UID": "[not set]", "UMask": "0022", "UnitFilePreset": "enabled", "UnitFileState": "enabled", "UtmpMode": "init", "WantedBy": "multi-user.target", "WatchdogSignal": "6", "WatchdogTimestampMonotonic": "0", "WatchdogUSec": "0"}}

TASK [Teste: O serviço apache2 encontra-se ativo no arranque no sistema, e está iniciado?] ***********************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O serviço apache2 está correctamente instalado e inicia com o arranque do sistema"
}

TASK [Rotina Auxiliar> Procura o caminho do ficheiro php.ini do servidor apache2] ********************************************************
ok: [ubuntu-20.04] => {"changed": false, "examined": 2021, "files": [{"atime": 1621986020.5731876, "ctime": 1621985964.1089694, "dev": 2049, "gid": 0, "gr_name": "root", "inode": 18, "isblk": false, "ischr": false, "isdir": false, "isfifo": false, "isgid": false, "islnk": false, "isreg": true, "issock": false, "isuid": false, "mode": "0644", "mtime": 1621985964.1089694, "nlink": 1, "path": "/etc/php/7.4/apache2/php.ini", "pw_name": "root", "rgrp": true, "roth": true, "rusr": true, "size": 72940, "uid": 0, "wgrp": false, "woth": false, "wusr": true, "xgrp": false, "xoth": false, "xusr": false}, {"atime": 1621985942.1700056, "ctime": 1621985876.6532636, "dev": 2049, "gid": 0, "gr_name": "root", "inode": 774454, "isblk": false, "ischr": false, "isdir": false, "isfifo": false, "isgid": false, "islnk": false, "isreg": true, "issock": false, "isuid": false, "mode": "0644", "mtime": 1601999276.0, "nlink": 1, "path": "/etc/php/7.4/cli/php.ini", "pw_name": "root", "rgrp": true, "roth": true, "rusr": true, "size": 72539, "uid": 0, "wgrp": false, "woth": false, "wusr": true, "xgrp": false, "xoth": false, "xusr": false}], "matched": 2, "msg": ""}

TASK [Simulação: Ativa a opção file_uploads no ficheiro php.ini, utilizando o módulo lineinfile.] ****************************************
ok: [ubuntu-20.04] => (item={'regexp': '^file_uploads', 'line': 'file_uploads = 1'}) => {"ansible_loop_var": "item", "backup": "", "changed": false, "item": {"line": "file_uploads = 1", "regexp": "^file_uploads"}, "msg": ""}
ok: [ubuntu-20.04] => (item={'regexp': '^upload_max_filesize', 'line': 'upload_max_filesize = 1G'}) => {"ansible_loop_var": "item", "backup": "", "changed": false, "item": {"line": "upload_max_filesize = 1G", "regexp": "^upload_max_filesize"}, "msg": ""}
ok: [ubuntu-20.04] => (item={'regexp': '^max_file_uploads', 'line': 'max_file_uploads = 20'}) => {"ansible_loop_var": "item", "backup": "", "changed": false, "item": {"line": "max_file_uploads = 20", "regexp": "^max_file_uploads"}, "msg": ""}
ok: [ubuntu-20.04] => (item={'regexp': '^post_max_size', 'line': 'post_max_size = 2G'}) => {"ansible_loop_var": "item", "backup": "", "changed": false, "item": {"line": "post_max_size = 2G", "regexp": "^post_max_size"}, "msg": ""}
ok: [ubuntu-20.04] => (item={'regexp': '^memory_limit', 'line': 'memory_limit = 2G'}) => {"ansible_loop_var": "item", "backup": "", "changed": false, "item": {"line": "memory_limit = 2G", "regexp": "^memory_limit"}, "msg": ""}
ok: [ubuntu-20.04] => (item={'regexp': '^max_input_time', 'line': 'max_input_time = 3600'}) => {"ansible_loop_var": "item", "backup": "", "changed": false, "item": {"line": "max_input_time = 3600", "regexp": "^max_input_time"}, "msg": ""}

TASK [Teste: As linhas do php.ini encontram-se alteradas ?] ******************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O ficheiro php.ini foi alterado com sucesso"
}

TASK [Simulação: Obtem informação sobre a pastas /var/www/leantime] **********************************************************************
ok: [ubuntu-20.04] => {"changed": false, "stat": {"atime": 1621985965.1694996, "attr_flags": "e", "attributes": ["extents"], "block_size": 4096, "blocks": 8, "charset": "binary", "ctime": 1621985973.1975117, "dev": 2049, "device_type": 0, "executable": true, "exists": true, "gid": 33, "gr_name": "www-data", "inode": 1280370, "isblk": false, "ischr": false, "isdir": true, "isfifo": false, "isgid": false, "islnk": false, "isreg": false, "issock": false, "isuid": false, "mimetype": "inode/directory", "mode": "0755", "mtime": 1621985973.1975117, "nlink": 8, "path": "/var/www/leantime", "pw_name": "www-data", "readable": true, "rgrp": true, "roth": true, "rusr": true, "size": 4096, "uid": 33, "version": "2814010018", "wgrp": false, "woth": false, "writeable": true, "wusr": true, "xgrp": true, "xoth": true, "xusr": true}}

TASK [Teste: A pasta /var/www/leantime existe e tem as permissões certas?] ***************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas no site leantime"
}

TASK [Simulação: Verifica se é necessário criar a base de dados leantime_database] *******************************************************
ok: [ubuntu-20.04] => {"changed": false, "cmd": "mysql -u root -e 'use leantime_database'", "delta": "0:00:00.027427", "end": "2021-05-26 09:28:55.149819", "failed_when_result": false, "rc": 0, "start": "2021-05-26 09:28:55.122392", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [Teste: A base de dados leantime_database existe ?] *********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: A base de dados leantime_database já se encontra criada"
}

TASK [Simulação e Teste: Verifica se o endereço git para a versão de leantime existe] ****************************************************
ok: [ubuntu-20.04] => {"accept_ranges": "bytes", "age": "129", "changed": false, "connection": "close", "content_disposition": "attachment; filename=Leantime-v2.1.7.zip", "content_length": "29635461", "content_type": "application/octet-stream", "cookies": {}, "cookies_string": "", "date": "Wed, 26 May 2021 09:28:56 GMT", "elapsed": 2, "etag": "\"2f38e583171fbf2cbfcab5381b900ec9\"", "last_modified": "Sat, 06 Feb 2021 04:55:33 GMT", "msg": "OK (29635461 bytes)", "redirected": true, "server": "AmazonS3", "status": 200, "strict_transport_security": "max-age=31536000", "url": "https://github-releases.githubusercontent.com/29745084/a199b200-680d-11eb-9f71-1d481f70a225?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20210526%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20210526T092646Z&X-Amz-Expires=300&X-Amz-Signature=ec2f005ebb222fb09876feb3e2b419f89a088078724241f4e47ed533ce4281be&X-Amz-SignedHeaders=host&actor_id=0&key_id=0&repo_id=29745084&response-content-disposition=attachment%3B%20filename%3DLeantime-v2.1.7.zip&response-content-type=application%2Foctet-stream", "via": "1.1 varnish, 1.1 varnish", "x_amz_id_2": "MANlIkCq7QsYNpsBCeQPvkDmHIbSHcI9HSALB+ZRWfBMcx5loQ662ZVSVOuPv0Hj7jVv2Anm3wg=", "x_amz_request_id": "E2TJEN94SJ017CNF", "x_cache": "MISS, HIT", "x_cache_hits": "0, 0", "x_fastly_request_id": "64ff8596b77103b513fc147413bb0a9bfeca73ed", "x_served_by": "cache-dca17781-DCA, cache-mad22046-MAD"}

TASK [Simulação: Obtem informação sobre o ficheiro /var/www/leantime/config/configuration.php] *******************************************
ok: [ubuntu-20.04] => {"changed": false, "stat": {"atime": 1621986033.7277615, "attr_flags": "e", "attributes": ["extents"], "block_size": 4096, "blocks": 16, "charset": "us-ascii", "checksum": "3e32b92314445eebee7c73294775ba7577dc5e15", "ctime": 1621985977.0914576, "dev": 2049, "device_type": 0, "executable": true, "exists": true, "gid": 33, "gr_name": "www-data", "inode": 774462, "isblk": false, "ischr": false, "isdir": false, "isfifo": false, "isgid": false, "islnk": false, "isreg": true, "issock": false, "isuid": false, "mimetype": "text/x-php", "mode": "0755", "mtime": 1621985977.0914576, "nlink": 1, "path": "/var/www/leantime/config/configuration.php", "pw_name": "www-data", "readable": true, "rgrp": true, "roth": true, "rusr": true, "size": 5724, "uid": 33, "version": "260453957", "wgrp": false, "woth": false, "writeable": true, "wusr": true, "xgrp": true, "xoth": true, "xusr": true}}

TASK [Teste: O ficheiro /var/www/leantime/config/configuration.php existe e tem as permissões certas?] ***********************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas e ficheiro configuration.php existente"
}

TASK [Simulação: Testa se o dbuser foi alterado no ficheiro configuration.php utilizando o módulo replace.] ******************************
ok: [ubuntu-20.04] => {"changed": false, "failed_when_result": false, "msg": ""}

TASK [Teste: O dbUser foi alterado?] *****************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbUser foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbDatabase foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04] => {"changed": false, "failed_when_result": false, "msg": ""}

TASK [Teste: a variável dbDatabase foi alterada?] ****************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbDatabase foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Testa se o dbPassword foi alterado no ficheiro configuration.php utilizando o módulo replace.] **************************
ok: [ubuntu-20.04] => {"changed": false, "failed_when_result": false, "msg": ""}

TASK [Teste: O dbPassword foi alterado?] *************************************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: O dbPassword foi alterado no ficheiro configuration.php"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-available/leantime.conf] *******************************************
ok: [ubuntu-20.04] => {"changed": false, "stat": {"atime": 1621985979.8768497, "attr_flags": "e", "attributes": ["extents"], "block_size": 4096, "blocks": 8, "charset": "us-ascii", "checksum": "589a794e2832307500d22bf7df4b52d92282f318", "ctime": 1621985978.8403316, "dev": 2049, "device_type": 0, "executable": true, "exists": true, "gid": 33, "gr_name": "www-data", "inode": 774463, "isblk": false, "ischr": false, "isdir": false, "isfifo": false, "isgid": false, "islnk": false, "isreg": true, "issock": false, "isuid": false, "mimetype": "text/plain", "mode": "0777", "mtime": 1621985977.5997117, "nlink": 1, "path": "/etc/apache2/sites-available/leantime.conf", "pw_name": "root", "readable": true, "rgrp": true, "roth": true, "rusr": true, "size": 320, "uid": 0, "version": "3389268433", "wgrp": true, "woth": true, "writeable": true, "wusr": true, "xgrp": true, "xoth": true, "xusr": true}}

TASK [Teste: O ficheiro /etc/apache2/sites-available/leantime.conf existe e tem as permissões certas?] ***********************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/leantime.conf] *********************************************
ok: [ubuntu-20.04] => {"changed": false, "stat": {"atime": 1621985979.8768497, "attr_flags": "", "attributes": [], "block_size": 4096, "blocks": 0, "charset": "binary", "ctime": 1621985978.4601417, "dev": 2049, "device_type": 0, "executable": true, "exists": true, "gid": 0, "gr_name": "root", "inode": 1033827, "isblk": false, "ischr": false, "isdir": false, "isfifo": false, "isgid": false, "islnk": true, "isreg": false, "issock": false, "isuid": false, "lnk_source": "/etc/apache2/sites-available/leantime.conf", "lnk_target": "/etc/apache2/sites-available/leantime.conf", "mimetype": "inode/symlink", "mode": "0777", "mtime": 1621985978.4601417, "nlink": 1, "path": "/etc/apache2/sites-enabled/leantime.conf", "pw_name": "root", "readable": true, "rgrp": true, "roth": true, "rusr": true, "size": 42, "uid": 0, "version": null, "wgrp": true, "woth": true, "writeable": true, "wusr": true, "xgrp": true, "xoth": true, "xusr": true}}

TASK [Teste: O ficheiro /etc/apache2/sites-enabled/leantime.conf existe e tem as permissões certas?] *************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: Permissões correctas"
}

TASK [Simulação: Obtem informação sobre o ficheiro /etc/apache2/sites-enabled/000-default.conf] ******************************************
ok: [ubuntu-20.04] => {"changed": false, "stat": {"exists": false}}

TASK [Teste: O ficheiro /etc/apache2/sites-enabled/000-default.conf NÃO existe?] *********************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [Simulação: Activa o módulo mod_rewrite no apache] **********************************************************************************
ok: [ubuntu-20.04] => {"changed": false, "result": "Module rewrite enabled"}

TASK [Simulação: Activa o módulo mod_rewrite no apache] **********************************************************************************
ok: [ubuntu-20.04] => {"changed": false, "result": "Module rewrite enabled"}

TASK [Teste: o mod_rewrite do apache encontra-se ativo?] *********************************************************************************
ok: [ubuntu-20.04] => {
    "changed": false,
    "msg": "SUCESSO: mod_rewrite encontra-se instalado e ativo"
}

TASK [Simulação: Tenta fazer login na aplicação com o utilizador criado] *****************************************************************
[WARNING]: The value True (type bool) in a string field was converted to 'True' (type string). If this does not look like what you
expect, quote the entire value to ensure it does not change.
ok: [ubuntu-20.04] => {"accept_ranges": "bytes", "changed": false, "connection": "close", "content_length": "10918", "content_type": "text/html", "cookies": {}, "cookies_string": "", "date": "Wed, 26 May 2021 09:29:05 GMT", "elapsed": 0, "etag": "\"2aa6-5c330063848fb\"", "last_modified": "Tue, 25 May 2021 23:38:33 GMT", "msg": "OK (10918 bytes)", "redirected": false, "server": "Apache/2.4.41 (Ubuntu)", "status": 200, "url": "http://localhost", "vary": "Accept-Encoding"}

TASK [Simulação: Obtem a página showMyCalendar para testar uma página com o login efetuado com sucesso] **********************************
fatal: [ubuntu-20.04]: FAILED! => {"msg": "The task includes an option with an undefined variable. The error was: 'dict object' has no attribute 'set_cookie'\n\nThe error appears to be in '/home/admlocal/leantime_ansible/molecule/default/verify.yml': line 353, column 5, but may\nbe elsewhere in the file depending on the exact syntax problem.\n\nThe offending line appears to be:\n\n\n  - name: \"Simulação: Obtem a página showMyCalendar para testar uma página com o login efetuado com sucesso\"\n    ^ here\nThis one looks easy to fix. It seems that there is a value started\nwith a quote, and the YAML parser is expecting to see the line ended\nwith the same kind of quote. For instance:\n\n    when: \"ok\" in result.stdout\n\nCould be written as:\n\n   when: '\"ok\" in result.stdout'\n\nOr equivalently:\n\n   when: \"'ok' in result.stdout\"\n"}

PLAY RECAP *******************************************************************************************************************************
ubuntu-20.04               : ok=36   changed=0    unreachable=0    failed=1    skipped=0    rescued=0    ignored=0


CRITICAL Ansible return code was 2, command was: ansible-playbook --inventory /home/admlocal/.cache/molecule/leantime_ansible/default/inventory --skip-tags molecule-notest,notest /home/admlocal/leantime_ansible/molecule/default/verify.yml
admlocal@devOps:~/leantime_ansible$ exit
exit
